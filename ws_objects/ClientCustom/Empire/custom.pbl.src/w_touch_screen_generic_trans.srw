$PBExportHeader$w_touch_screen_generic_trans.srw
forward
global type w_touch_screen_generic_trans from Window
end type
type rb_2 from radiobutton within w_touch_screen_generic_trans
end type
type cb_at_enter from commandbutton within w_touch_screen_generic_trans
end type
type cb_52 from commandbutton within w_touch_screen_generic_trans
end type
type st_2 from statictext within w_touch_screen_generic_trans
end type
type em_1 from editmask within w_touch_screen_generic_trans
end type
type p_trash from picture within w_touch_screen_generic_trans
end type
type dw_transactions from datawindow within w_touch_screen_generic_trans
end type
type lb_1 from listbox within w_touch_screen_generic_trans
end type
type sle_status from statictext within w_touch_screen_generic_trans
end type
type st_1 from statictext within w_touch_screen_generic_trans
end type
type cb_57 from commandbutton within w_touch_screen_generic_trans
end type
type lb_unit_list from listbox within w_touch_screen_generic_trans
end type
type dw_unit_list from datawindow within w_touch_screen_generic_trans
end type
type cb_55 from commandbutton within w_touch_screen_generic_trans
end type
type cb_51 from commandbutton within w_touch_screen_generic_trans
end type
type dw_new_object from datawindow within w_touch_screen_generic_trans
end type
type ddlb_unit from dropdownlistbox within w_touch_screen_generic_trans
end type
type sle_numberof from singlelineedit within w_touch_screen_generic_trans
end type
type sle_qty from singlelineedit within w_touch_screen_generic_trans
end type
type cb_48 from commandbutton within w_touch_screen_generic_trans
end type
type cb_49 from commandbutton within w_touch_screen_generic_trans
end type
type dw_object from datawindow within w_touch_screen_generic_trans
end type
type rb_1 from radiobutton within w_touch_screen_generic_trans
end type
type sle_lot from singlelineedit within w_touch_screen_generic_trans
end type
type ddlb_parts from dropdownlistbox within w_touch_screen_generic_trans
end type
type sle_operator from singlelineedit within w_touch_screen_generic_trans
end type
type sle_serial from singlelineedit within w_touch_screen_generic_trans
end type
type cb_47 from commandbutton within w_touch_screen_generic_trans
end type
type cb_46 from commandbutton within w_touch_screen_generic_trans
end type
type cb_45 from commandbutton within w_touch_screen_generic_trans
end type
type cb_44 from commandbutton within w_touch_screen_generic_trans
end type
type cb_42 from commandbutton within w_touch_screen_generic_trans
end type
type dw_1 from datawindow within w_touch_screen_generic_trans
end type
type cb_41 from commandbutton within w_touch_screen_generic_trans
end type
type cb_43 from commandbutton within w_touch_screen_generic_trans
end type
type cb_40 from commandbutton within w_touch_screen_generic_trans
end type
type cb_39 from commandbutton within w_touch_screen_generic_trans
end type
type cb_38 from commandbutton within w_touch_screen_generic_trans
end type
type cb_37 from commandbutton within w_touch_screen_generic_trans
end type
type cb_36 from commandbutton within w_touch_screen_generic_trans
end type
type cb_35 from commandbutton within w_touch_screen_generic_trans
end type
type cb_34 from commandbutton within w_touch_screen_generic_trans
end type
type cb_33 from commandbutton within w_touch_screen_generic_trans
end type
type cb_32 from commandbutton within w_touch_screen_generic_trans
end type
type cb_31 from commandbutton within w_touch_screen_generic_trans
end type
type cb_30 from commandbutton within w_touch_screen_generic_trans
end type
type cb_29 from commandbutton within w_touch_screen_generic_trans
end type
type cb_28 from commandbutton within w_touch_screen_generic_trans
end type
type cb_27 from commandbutton within w_touch_screen_generic_trans
end type
type cb_26 from commandbutton within w_touch_screen_generic_trans
end type
type cb_25 from commandbutton within w_touch_screen_generic_trans
end type
type cb_24 from commandbutton within w_touch_screen_generic_trans
end type
type cb_23 from commandbutton within w_touch_screen_generic_trans
end type
type cb_22 from commandbutton within w_touch_screen_generic_trans
end type
type cb_21 from commandbutton within w_touch_screen_generic_trans
end type
type cb_20 from commandbutton within w_touch_screen_generic_trans
end type
type cb_19 from commandbutton within w_touch_screen_generic_trans
end type
type cb_18 from commandbutton within w_touch_screen_generic_trans
end type
type cb_17 from commandbutton within w_touch_screen_generic_trans
end type
type cb_16 from commandbutton within w_touch_screen_generic_trans
end type
type cb_15 from commandbutton within w_touch_screen_generic_trans
end type
type cb_14 from commandbutton within w_touch_screen_generic_trans
end type
type cb_13 from commandbutton within w_touch_screen_generic_trans
end type
type cb_12 from commandbutton within w_touch_screen_generic_trans
end type
type cb_11 from commandbutton within w_touch_screen_generic_trans
end type
type cb_10 from commandbutton within w_touch_screen_generic_trans
end type
type cb_9 from commandbutton within w_touch_screen_generic_trans
end type
type cb_8 from commandbutton within w_touch_screen_generic_trans
end type
type cb_7 from commandbutton within w_touch_screen_generic_trans
end type
type cb_6 from commandbutton within w_touch_screen_generic_trans
end type
type cb_5 from commandbutton within w_touch_screen_generic_trans
end type
type cb_4 from commandbutton within w_touch_screen_generic_trans
end type
type cb_3 from commandbutton within w_touch_screen_generic_trans
end type
type cb_2 from commandbutton within w_touch_screen_generic_trans
end type
type cb_1 from commandbutton within w_touch_screen_generic_trans
end type
type dw_audit_trail from datawindow within w_touch_screen_generic_trans
end type
type sle_title from statictext within w_touch_screen_generic_trans
end type
type cb_audit_popup from commandbutton within w_touch_screen_generic_trans
end type
type gb_qty from groupbox within w_touch_screen_generic_trans
end type
type gb_serial_number from groupbox within w_touch_screen_generic_trans
end type
type gb_unit from groupbox within w_touch_screen_generic_trans
end type
type gb_operator from groupbox within w_touch_screen_generic_trans
end type
type gb_machine from groupbox within w_touch_screen_generic_trans
end type
type gb_numberof from groupbox within w_touch_screen_generic_trans
end type
type gb_parts from groupbox within w_touch_screen_generic_trans
end type
type gb_lot from groupbox within w_touch_screen_generic_trans
end type
type gb_location_from from groupbox within w_touch_screen_generic_trans
end type
type gb_location_to from groupbox within w_touch_screen_generic_trans
end type
type gb_packaging from groupbox within w_touch_screen_generic_trans
end type
type ddlb_machines from dropdownlistbox within w_touch_screen_generic_trans
end type
type gb_new_object from groupbox within w_touch_screen_generic_trans
end type
type sle_combine_serial from singlelineedit within w_touch_screen_generic_trans
end type
type cb_operator_ok from commandbutton within w_touch_screen_generic_trans
end type
type cb_operator_cancel from commandbutton within w_touch_screen_generic_trans
end type
type ddlb_packaging from dropdownlistbox within w_touch_screen_generic_trans
end type
type ddlb_location_to from dropdownlistbox within w_touch_screen_generic_trans
end type
type mle_qc_notes from multilineedit within w_touch_screen_generic_trans
end type
type sle_1 from singlelineedit within w_touch_screen_generic_trans
end type
type gb_qc_notes from groupbox within w_touch_screen_generic_trans
end type
type sle_operator_code from singlelineedit within w_touch_screen_generic_trans
end type
type sle_operator_password from singlelineedit within w_touch_screen_generic_trans
end type
type dw_limit_locs from datawindow within w_touch_screen_generic_trans
end type
type st_operator_title from statictext within w_touch_screen_generic_trans
end type
type cb_operator from commandbutton within w_touch_screen_generic_trans
end type
type dw_current_object from datawindow within w_touch_screen_generic_trans
end type
type gb_current_object from groupbox within w_touch_screen_generic_trans
end type
type cb_50 from commandbutton within w_touch_screen_generic_trans
end type
type gb_dwbox from groupbox within w_touch_screen_generic_trans
end type
type lb_2 from listbox within w_touch_screen_generic_trans
end type
type dw_misc from datawindow within w_touch_screen_generic_trans
end type
end forward

global type w_touch_screen_generic_trans from Window
int X=0
int Y=0
int Width=6679
int Height=3452
boolean TitleBar=true
string Title="Combine"
long BackColor=77897888
boolean ControlMenu=true
boolean MinBox=true
boolean MaxBox=true
boolean Resizable=true
WindowState WindowState=maximized!
WindowType WindowType=popup!
string Icon="mit.ico"
event undo pbm_custom01
event ue_accept pbm_custom02
event ue_cancel pbm_custom03
event ue_close_audit_trail pbm_custom04
event ue_close_uo_note pbm_custom05
event ue_save_note pbm_custom06
rb_2 rb_2
cb_at_enter cb_at_enter
cb_52 cb_52
st_2 st_2
em_1 em_1
p_trash p_trash
dw_transactions dw_transactions
lb_1 lb_1
sle_status sle_status
st_1 st_1
cb_57 cb_57
lb_unit_list lb_unit_list
dw_unit_list dw_unit_list
cb_55 cb_55
cb_51 cb_51
dw_new_object dw_new_object
ddlb_unit ddlb_unit
sle_numberof sle_numberof
sle_qty sle_qty
cb_48 cb_48
cb_49 cb_49
dw_object dw_object
rb_1 rb_1
sle_lot sle_lot
ddlb_parts ddlb_parts
sle_operator sle_operator
sle_serial sle_serial
cb_47 cb_47
cb_46 cb_46
cb_45 cb_45
cb_44 cb_44
cb_42 cb_42
dw_1 dw_1
cb_41 cb_41
cb_43 cb_43
cb_40 cb_40
cb_39 cb_39
cb_38 cb_38
cb_37 cb_37
cb_36 cb_36
cb_35 cb_35
cb_34 cb_34
cb_33 cb_33
cb_32 cb_32
cb_31 cb_31
cb_30 cb_30
cb_29 cb_29
cb_28 cb_28
cb_27 cb_27
cb_26 cb_26
cb_25 cb_25
cb_24 cb_24
cb_23 cb_23
cb_22 cb_22
cb_21 cb_21
cb_20 cb_20
cb_19 cb_19
cb_18 cb_18
cb_17 cb_17
cb_16 cb_16
cb_15 cb_15
cb_14 cb_14
cb_13 cb_13
cb_12 cb_12
cb_11 cb_11
cb_10 cb_10
cb_9 cb_9
cb_8 cb_8
cb_7 cb_7
cb_6 cb_6
cb_5 cb_5
cb_4 cb_4
cb_3 cb_3
cb_2 cb_2
cb_1 cb_1
dw_audit_trail dw_audit_trail
sle_title sle_title
cb_audit_popup cb_audit_popup
gb_qty gb_qty
gb_serial_number gb_serial_number
gb_unit gb_unit
gb_operator gb_operator
gb_machine gb_machine
gb_numberof gb_numberof
gb_parts gb_parts
gb_lot gb_lot
gb_location_from gb_location_from
gb_location_to gb_location_to
gb_packaging gb_packaging
ddlb_machines ddlb_machines
gb_new_object gb_new_object
sle_combine_serial sle_combine_serial
cb_operator_ok cb_operator_ok
cb_operator_cancel cb_operator_cancel
ddlb_packaging ddlb_packaging
ddlb_location_to ddlb_location_to
mle_qc_notes mle_qc_notes
sle_1 sle_1
gb_qc_notes gb_qc_notes
sle_operator_code sle_operator_code
sle_operator_password sle_operator_password
dw_limit_locs dw_limit_locs
st_operator_title st_operator_title
cb_operator cb_operator
dw_current_object dw_current_object
gb_current_object gb_current_object
cb_50 cb_50
gb_dwbox gb_dwbox
lb_2 lb_2
dw_misc dw_misc
end type
global w_touch_screen_generic_trans w_touch_screen_generic_trans

type variables
st_generic_structure 	stParm
Int 			iThisInstance
Int 			iddlbIndex
Int			iHandle
Boolean			bAuditTrail
Boolean			bNoKey
Boolean			bUserNotes
Boolean			bUserOperator
Boolean 			bOperator
Boolean 			bLocationTo
Boolean 			bLocationFrom
Boolean 			bSerialNumber
Boolean 			bUnits
Boolean 			bMachines
Boolean 			bPackaging
Boolean 			bLot
Boolean 			bQty
Boolean 			bNumberOf
Boolean 			bParts
Boolean 			bWriteParent
Boolean 			bZeroParent
Boolean 			bSuper
Boolean 			bNoCheck
Boolean 			bChars, bNumbers
Boolean 			bLoseFocus
Boolean 			bDelete
Boolean 			bEnabled
Boolean 			bLabelNeeded
Boolean 			bCurrentObject
Boolean 			bNewObject
Boolean 			bPopulateParts
Boolean 			bPopulateLocations
Boolean 			bPopulateMachines
Boolean 			bPartsLoseFocus
Boolean 			bExit
Boolean 			bMessageBox
Boolean 			bMandatoryLot
Boolean 			bRequired
Boolean 			bClicked
Boolean 			bModified
Boolean 			bBreakoutMore
Boolean 			bDifferentPart
Boolean 			bInvalidCombineSerial
Boolean 			bStagedObject
Boolean 			bCombineSameSerial
Boolean 			bCombineDifferentStatus
Boolean 			bIssueMoreQuantity
Boolean 			bDifferentStatus
Boolean 			bStatusSame
Boolean 			bInvalidSuperObject
Boolean 			bExternalMessage
Boolean 			bOpen
Boolean 			bNoClickCheck
Boolean 			bButton
Boolean 			bBack
Boolean 			bCombineSerial
Boolean 			bCB48
Boolean 			bMessage
Boolean 			bSetToThis
Boolean 			bTab
Boolean 			bAction
Boolean 			bQCNotes
Boolean 			bMandatoryQCNotes
Boolean			bJCNumberOfMode
Boolean			bJCLotMode
Boolean			bJCQtyMode
Boolean			bJCUnitMode
Boolean			bMIUnitMode
Boolean			bBONumberOfMode
Boolean			bBOUnitMode 
Boolean			bDeleteScrap
Boolean			bSetBack
Boolean			bLabel, &
			ib_Scale, &
			ib_PopupScaleInterface, &
			ib_ScaleOpen, &
			ib_Auto, &
			ib_Password, &
			ib_Notes
String 			szOperator
String 			szTo
String 			szLocation
String 			szNewLoc
String 			szRemarks
String 			cType
String 			cObjectType
String 			szMessage
String 			szPart
String 			szLot
String 			szStatus
String 			szPoNumber
String 			szUnit
String 			cStatus
String 			szWorkOrder
String 			szTextCheck
String 			szField
String 			szSelectedText
String 			szRealityText
String 			cCharacterTouched
String 			cIssueType, &
			is_Notes,&
			is_UserStatus
DateTime 		dtToday
DateTime 		dDateTime
Date 			dToday
Time 			tTime
Dec 			dQuantity
Dec 			dWeight
Dec 			dPrice
Dec 			dOnHand, &
			idec_ScaleWeight
Long	 		lParent
Long 			lSerial
Long 			lLoop
Long 			lRow
Long 			lColumn
Long 			lSerialParm
Long			il_AuditRow
DataWindow 		dwObject

st_dda_parmlist_mit_sf            st_prmlst
string                                       szdimensionqtystring 
string                                       szparentqty
string                                       szparentdimqtystr
string                                       s_org_str[]
decimal                                   d_org_value[]
long                                         llnonconstantdim
end variables

forward prototypes
public subroutine disable_chars ()
public subroutine enable_chars ()
public subroutine disable_numbers ()
public subroutine enable_numbers ()
public subroutine wf_key_pressed (string ccharacter)
public subroutine wf_setup_screen ()
public subroutine wf_set_rb_position (radiobutton rb, int x, int y, string text)
public subroutine wf_set_dw_position (datawindow dw, int x, int y, int height, int width, string data_object, boolean h_scroll, boolean v_scroll)
public subroutine wf_set_gb_position (groupbox group_box, int x, int y, string text, int height, int width)
public subroutine wf_reset_indicators ()
public function string wf_location_of_super_object (long lserial)
public subroutine wf_transfer_update_object ()
public subroutine wf_transfer_update_objects ()
public subroutine wf_transfer_super_object (dropdownlistbox ddlbname)
public subroutine wf_set_em_position (editmask em, int x, int y, boolean spin_control)
public subroutine wf_get_location_tos ()
public subroutine wf_get_machines ()
public subroutine wf_get_parts ()
public subroutine wf_enable_screen ()
public subroutine wf_disable_screen ()
public subroutine wf_set_sle_position (singlelineedit sle, int x, int y, integer taborder)
public subroutine wf_set_ddlb_position (ref dropdownlistbox ddlb, int x, int y, integer taborder)
public subroutine wf_show_transfer_help ()
public subroutine wf_hide_transfer_help ()
public function boolean wf_modified ()
public subroutine wf_set_focus ()
public subroutine wf_get_unit_list (string szpartnumber, string szoriginalunit)
public subroutine wf_loop_for_avail_units (string szunit, int iorder)
public subroutine wf_reset_colors ()
public subroutine wf_change_color_focus ()
public function string wf_get_character ()
public function boolean wf_valid_key ()
public function boolean wf_packaging (string part, string previous_type)
public subroutine wf_show_message ()
public subroutine wf_hide_message ()
public function boolean wf_job_complete ()
public function boolean wf_material_issue ()
public function boolean wf_delete_audit_trail (long ll_serial)
public function boolean wf_create_object (long ll_serial, datetime ldt_date, string ls_operator)
public subroutine wf_operator_attrib (boolean bmode)
public function boolean wf_update_onhand (long ll_serial, string ls_mode)
public function boolean wf_breakout ()
public function boolean wf_delete_object (long ll_serial)
public function boolean wf_add_to_object (long ll_serial, decimal ld_qty, decimal ld_stdqty, decimal ld_objectqty, decimal ld_objectstdqty, string ls_operator)
public subroutine wf_check_for_scale ()
public subroutine wf_popup_scale ()
public subroutine wf_disable_except_buttons ()
public subroutine wf_enable_except_buttons ()
end prototypes

on undo;String			ls_Part
String 			ls_Type
String			ls_Operator
Long				ll_Serial
Long				ll_Dummy
Long				ll_Temp
Int				iCounter
DateTime			ldt_Date
str_progress 	stProgressParm
Dec				ld_Qty
Dec				ld_StdQty
Dec				ld_NewOnHand
Dec				ld_ObjectQty
Dec				ld_ObjectStdQty

//  Initialize variables

il_AuditRow = u_audit_trail.dw_audit_trail.GetRow ( )

ls_Type 		= u_audit_trail.dw_audit_trail.GetItemString ( il_AuditRow, "type" )
ldt_Date		= u_audit_trail.dw_audit_trail.GetItemDateTime ( il_AuditRow, "date_stamp" )
ll_Serial 	= u_audit_trail.dw_audit_trail.GetItemNumber ( il_AuditRow, "serial" )
ld_Qty 		= u_audit_trail.dw_audit_trail.GetItemNumber ( il_AuditRow, "quantity" )
ld_StdQty 	= u_audit_trail.dw_audit_trail.GetItemNumber ( il_AuditRow, "std_quantity" )
ls_Part		= u_audit_trail.dw_audit_trail.GetItemString ( il_AuditRow, "part" )

//  Prompt for operator and loop until value returned

bFinish = False

ls_Operator = sle_operator_code.Text

Choose Case ls_Type

	Case "M"

		stProgressParm.Title = "Undo Material Issue"
		stProgressParm.Cancel_window = This

		OpenWithParm ( w_progress, stProgressParm )

		iCounter++
		w_progress.wf_progress ( iCounter / 4, "Searching for object..." )

		SELECT object.quantity,
				 object.std_quantity
		  INTO :ld_ObjectQty,
				 :ld_ObjectStdQty
		  FROM object  
		 WHERE object.serial = :ll_Serial   ;

		iCounter++
		w_progress.wf_progress ( iCounter / 4, "Reconciling object..." )

		If SQLCA.SQLCode = 0 Then
			If Not wf_add_to_object ( ll_Serial, ld_Qty, ld_StdQty, ld_ObjectQty, ld_ObjectStdQty, ls_Operator ) Then
				RollBack ;
				Close ( w_progress )
				MessageBox ( "Error", "Unable to return object to inventory!", StopSign! )
				Return
			End if
		Else
			If Not wf_create_object ( ll_Serial, ldt_Date, ls_Operator ) Then
				RollBack ;
				Close ( w_progress )
				MessageBox ( "Error", "Unable to re-create object in inventory!", StopSign! )
				Return
			End if
		End if

		iCounter++
		w_progress.wf_progress ( iCounter / 4, "Updating on hand..." )

		ld_NewOnHand = f_update_onhand ( ls_Part, ld_StdQty, "+*" )
		If ld_NewOnHand = -1 Then
			RollBack ;
			Close ( w_progress )
			MessageBox ( "Error", "Unable to update on hand!", StopSign! )
			Return
		End if

		iCounter++
		w_progress.wf_progress ( iCounter / 4, "Deleting audit trail..." )

		DELETE FROM audit_trail  
		 WHERE ( serial = :ll_Serial ) AND  
		       ( date_stamp = :ldt_Date )   ;

		If SQLCA.SQLCode <> 0 Then
			RollBack ;
			Close ( w_progress )
			MessageBox ( "Error", "Unable to delete audit trail!", StopSign! )
			Return
		End if

		Commit ;

		Close ( w_progress )

	Case "B"
	Case "C"
	Case "T"
	Case "J"

		stProgressParm.Title = "Undo Completion"
		stProgressParm.Cancel_window = This

		OpenWithParm ( w_progress, stProgressParm )

		iCounter++
		w_progress.wf_progress ( iCounter / 3, "Updating Onhand Balance..." )

		If wf_update_onhand ( ll_Serial, "-" ) Then

			iCounter++
			w_progress.wf_progress ( iCounter / 3, "Deleting Object..." )

			If wf_delete_object ( ll_Serial ) Then

				iCounter++
				w_progress.wf_progress ( iCounter / 3, "Deleting Audit Trail..." )

				If wf_delete_audit_trail ( ll_Serial ) Then
					Commit ;
				Else
					RollBack ;
				End if
			Else
				RollBack ;
			End if
		Else
			RollBack ;
		End if

		Close ( w_progress )

	Case "Q"

End Choose

u_audit_trail.dw_audit_trail.SetTransObject ( sqlca )

If stParm.Value1 = "JobComplete" Then
	u_audit_trail.dw_audit_trail.Retrieve ( dtToday, ls_Type, ddlb_machines.Text )
Elseif stParm.Value1 = "Material Issue" Then
	If u_audit_trail.dw_audit_trail.DataObject = "d_generic_audit_trail_undo_mi" Then
		u_audit_trail.dw_audit_trail.Retrieve ( "M", ll_Serial )
	Else
		u_audit_trail.dw_audit_trail.Retrieve ( dtToday, ls_Type, ddlb_machines.Text )
	End if
Else
	u_audit_trail.dw_audit_trail.Retrieve ( dtToday, ls_Type )
End if

u_audit_trail.SetRedraw ( TRUE )
end on

on ue_accept;ib_ScaleOpen = FALSE
If Left ( szReturnedString, 1 ) = "W" Then
	idec_ScaleWeight = Dec ( Right ( szReturnedString, Len ( szReturnedString ) - 1 ) )
	sle_qty.Text = "1"
Elseif Left ( szReturnedString, 1 ) = "A" Then
	idec_ScaleWeight = Dec ( Right ( szReturnedString, Len ( szReturnedString ) - 1 ) )
	sle_qty.Text = "1"
	ib_Auto = TRUE
Elseif Left ( szReturnedString, 1 ) = "N" Then
	idec_ScaleWeight = Dec ( Right ( szReturnedString, Len ( szReturnedString ) - 1 ) )
	sle_qty.Text = "1"
	ib_Auto = TRUE
	cb_48.PostEvent ( clicked! )
	Return
Else
	sle_qty.Text = szReturnedString
End if
sle_qty.SetFocus ( )
end on

on ue_cancel;ib_PopupScaleInterface = FALSE
ib_Auto = FALSE
sle_qty.Text = ""
sle_qty.SetFocus ( )
end on

on ue_close_audit_trail;bAuditTrail = FALSE
CloseUserObject ( u_audit_trail )
wf_enable_screen ( )
wf_set_focus ( )
end on

on ue_close_uo_note;This.CloseUserObject ( u_generic_it_note )
wf_enable_except_buttons ( )
wf_set_focus ( )
ib_Notes = FALSE
end on

on ue_save_note;is_Notes = u_generic_it_note.mle_note.Text
This.CloseUserObject ( u_generic_it_note )
wf_enable_except_buttons ( )
wf_set_focus ( )
ib_Notes = FALSE
end on

public subroutine disable_chars ();bChars = False
cb_1.Enabled = False
cb_2.Enabled = False
cb_3.Enabled = False
cb_4.Enabled = False
cb_5.Enabled = False
cb_6.Enabled = False
cb_7.Enabled = False
cb_8.Enabled = False
cb_9.Enabled = False
cb_10.Enabled = False
cb_11.Enabled = False
cb_12.Enabled = False
cb_13.Enabled = False
cb_14.Enabled = False
cb_15.Enabled = False
cb_16.Enabled = False
cb_17.Enabled = False
cb_18.Enabled = False
cb_19.Enabled = False
cb_20.Enabled = False
cb_21.Enabled = False
cb_22.Enabled = False
cb_23.Enabled = False
cb_24.Enabled = False
cb_31.Enabled = False
cb_32.Enabled = False
cb_40.Enabled = False
cb_41.Enabled = False
If bSerialNumber Then cb_43.Enabled = False
cb_55.Enabled = False


end subroutine

public subroutine enable_chars ();bChars = True

cb_1.Enabled = True
cb_2.Enabled = True
cb_3.Enabled = True
cb_4.Enabled = True
cb_5.Enabled = True
cb_6.Enabled = True
cb_7.Enabled = True
cb_8.Enabled = True
cb_9.Enabled = True
cb_10.Enabled = True
cb_11.Enabled = True
cb_12.Enabled = True
cb_13.Enabled = True
cb_14.Enabled = True
cb_15.Enabled = True
cb_16.Enabled = True
cb_17.Enabled = True
cb_18.Enabled = True
cb_19.Enabled = True
cb_20.Enabled = True
cb_21.Enabled = True
cb_22.Enabled = True
cb_23.Enabled = True
cb_24.Enabled = True
cb_31.Enabled = True
cb_32.Enabled = True
cb_40.Enabled = True
cb_41.Enabled = True
cb_43.Enabled = True
cb_55.Enabled = True

end subroutine

public subroutine disable_numbers ();bNumbers = False
cb_25.Enabled = False
cb_26.Enabled = False
cb_27.Enabled = False
cb_28.Enabled = False
cb_29.Enabled = False
cb_33.Enabled = False
cb_34.Enabled = False
cb_35.Enabled = False
cb_36.Enabled = False
cb_39.Enabled = False

end subroutine

public subroutine enable_numbers ();bNumbers = True
cb_25.Enabled = True
cb_26.Enabled = True
cb_27.Enabled = True
cb_28.Enabled = True
cb_29.Enabled = True
cb_33.Enabled = True
cb_34.Enabled = True
cb_35.Enabled = True
cb_36.Enabled = True
cb_39.Enabled = True

end subroutine

public subroutine wf_key_pressed (string ccharacter);String szSerial
String szPreviousText

wf_hide_message ( )


/*  Initialize Variables  */

IF ib_Password THEN
	u_audit_trail.sle_operator_password.Text = u_audit_trail.sle_operator_password.Text + cCharacter
ELSEIF ib_Notes THEN
	u_generic_it_note.mle_note.Text = u_generic_it_note.mle_note.Text + cCharacter
ELSEIF bAuditTrail THEN
	u_audit_trail.em_serial.Text = u_audit_trail.em_serial.Text + cCharacter
ELSE
	If bOperator Then
		sle_operator.Text = sle_operator.Text + cCharacter
		sle_operator.SetFocus ( )
	Elseif bSerialNumber Then
		sle_serial.Text = sle_serial.Text + cCharacter
		sle_serial.SetFocus ( )
	Elseif bLocationTo Then
		ddlb_location_to.Text = ddlb_location_to.Text + cCharacter
		szPreviousText = ddlb_location_to.Text
		ddlb_location_to.SetFocus ( )
		iddlbIndex = ddlb_location_to.FindItem ( ddlb_location_to.SelectedText ( ), 1 )
		If iddlbIndex <> -1 Then
			iddlbIndex = ddlb_location_to.SelectItem ( iddlbIndex )
			szSelectedText = ddlb_location_to.SelectedText ( )
			ddlb_location_to.Text = szPreviousText
		Else
			szSelectedText = ""
		End if
	Elseif bMachines Then
		ddlb_machines.Text = ddlb_machines.Text + cCharacter
		szPreviousText = ddlb_machines.Text
		ddlb_machines.SetFocus ( )
		iddlbIndex = ddlb_machines.FindItem ( ddlb_machines.SelectedText ( ), 1 )
		If iddlbIndex <> -1 Then
			iddlbIndex = ddlb_machines.SelectItem ( iddlbIndex )
			szSelectedText = ddlb_machines.SelectedText ( )
			ddlb_machines.Text = szPreviousText
		Else
			szSelectedText = ""
		End if
	Elseif bPackaging Then
		ddlb_packaging.Text = ddlb_packaging.Text + cCharacter
		szPreviousText = ddlb_packaging.Text
		ddlb_packaging.SetFocus ( )
		iddlbIndex = ddlb_packaging.FindItem ( ddlb_packaging.SelectedText ( ), 1 )
		If iddlbIndex <> -1 Then
			iddlbIndex = ddlb_packaging.SelectItem ( iddlbIndex )
			szSelectedText = ddlb_packaging.SelectedText ( )
			ddlb_packaging.Text = szPreviousText
		Else
			szSelectedText = ""
		End if
	Elseif bParts Then
		ddlb_parts.Text = ddlb_parts.Text + cCharacter
		szPreviousText = ddlb_parts.Text
		ddlb_parts.SetFocus ( )
		iddlbIndex = ddlb_parts.FindItem ( ddlb_parts.SelectedText ( ), 1 )
		If iddlbIndex <> -1 Then
			iddlbIndex = ddlb_parts.SelectItem ( iddlbIndex )
			szSelectedText = ddlb_parts.SelectedText ( )
			ddlb_parts.Text = szPreviousText
		Else
			szSelectedText = ""
		End if
	Elseif bUnits Then
		ddlb_unit.Text = ddlb_unit.Text + cCharacter
		ddlb_unit.SetFocus ( )
	Elseif bQty Then
		sle_qty.Text = sle_qty.Text + cCharacter
		sle_qty.SetFocus ( )
	Elseif bNumberOf Then
		sle_numberof.Text = sle_numberof.Text + cCharacter
		sle_numberof.SetFocus ( )
	Elseif bLot Then
		sle_lot.Text = sle_lot.Text + cCharacter
		sle_lot.SetFocus ( )
	Elseif bCurrentObject Then
		szSerial = dw_current_object.GetText ( )
		szSerial = szSerial + cCharacter
		dw_current_object.SetItem ( 1, "serial", Long ( szSerial ) )
	Elseif bCombineSerial Then
		sle_combine_serial.Text = sle_combine_serial.Text + cCharacter
		sle_combine_serial.SetFocus ( )
	Elseif bQCNotes Then
		mle_qc_notes.Text = mle_qc_notes.Text + cCharacter
		mle_qc_notes.SetFocus ( )
	End if
END IF
end subroutine

public subroutine wf_setup_screen ();/*  Declare Variables  */

dw_misc.SetTransObject ( sqlca )

String 	szNull
String 	cPopParts
String	cPopLocations
String	cPopMachines
String	cMandatoryQCNotes
String	cJCNumberOfMode
String	cJCQtyMode
String	cJCLotMode
String	cJCUnitMode
String	cMIUnitMode
String	cBONumberOfMode
String	cBOUnitMode
String	cDeleteScrap
Int		iTabSeq

SetNull ( szNull )


SELECT populate_parts,   
       populate_locations,   
       populate_machines,
		 mandatory_qc_notes
  INTO :cPopParts,   
       :cPopLocations,   
       :cPopMachines,
		 :cMandatoryQCNotes  
  FROM parameters  ;

If cPopParts = 'Y' Then bPopulateParts = True
If cPopLocations = 'Y' Then bPopulateLocations = True
If cPopMachines = 'Y' Then bPopulateMachines = True
If cMandatoryQCNotes = 'Y' Then bMandatoryQCNotes = True

bOpen = True

SELECT inventory_parameters.jc_number_of,   
       inventory_parameters.jc_qty,   
       inventory_parameters.jc_unit,   
       inventory_parameters.jc_material_lot,   
       inventory_parameters.mi_unit,   
       inventory_parameters.bo_number_of,   
       inventory_parameters.bo_unit  
  INTO :cJCNumberOfMode,   
       :cJCQtyMode,   
       :cJCUnitMode,   
       :cJCLotMode,   
       :cMIUnitMode,   
       :cBONumberOfMode,   
       :cBOUnitMode  
  FROM inventory_parameters  ;

If cJCNumberOfMode = 'R' Then bJCNumberOfMode = True
If cJCLotMode = 'R' Then bJCLotMode = True
If cJCQtyMode = 'R' Then bJCQtyMode = True
If cJCUnitMode = 'R' Then bJCUnitMode = True
If cMIUnitMode = 'R' Then bMIUnitMode = True
If cBONumberOfMode = 'R' Then bBONumberOfMode = True
If cBOUnitMode = 'R' Then bBOUnitMode = True

/*  Main  */

Choose Case stParm.Value1

	Case "Transfer"

		dw_audit_trail.DataObject = "d_generic_audit_trail"

		wf_set_gb_position ( gb_operator,74,225,szNull,0,0 )
		wf_set_gb_position ( gb_serial_number,74,865,szNull,0,0 )
		wf_set_gb_position ( gb_location_to,74,545,szNull,0,0 )
		gb_dwbox.Text = "Super Object Serials"
		gb_dwbox.Visible = False

		wf_set_sle_position ( sle_operator, 110, 289, 10 )
		wf_set_sle_position ( sle_serial, 110, 929, 30 )

		ddlb_location_to.Visible = True
		ddlb_location_to.TabOrder = 20

		wf_set_rb_position ( rb_1, 110, 545, "Location" )
		wf_set_rb_position ( rb_2, 586, 545, "Super" )

		dw_misc.Visible = False
		dw_misc.VScrollBar = True
		dw_misc.HScrollBar = True
		dw_misc.LiveScroll = True

		sle_serial.Text = stParm.Value2

		sle_operator.SetFocus ( )

		cb_44.Text = "Help"
		cb_44.Enabled = True

	Case "JobComplete"

		dw_audit_trail.DataObject = "d_generic_audit_trail_by_machine"

		String cMandatoryLot
	
		SELECT parameters.mandatory_lot_inventory  
		  INTO :cMandatoryLot  
		  FROM parameters  ;
		
		If Upper ( cMandatoryLot ) = 'Y' Then bMandatoryLot = True

		wf_set_gb_position ( gb_machine,37,193,szNull,0,0 )
		wf_set_gb_position ( gb_parts,37,417,szNull,0,0 )
		wf_set_gb_position ( gb_qty,878,865,"Object Qty",0,0 )
		wf_set_gb_position ( gb_unit,1719,865,szNull,0,0 )
		wf_set_gb_position ( gb_location_to,878,193,szNull,0,0 )
		wf_set_gb_position ( gb_packaging,37,641,szNull,0,0 )
		wf_set_gb_position ( gb_lot,37,865,szNull,0,0 )
		wf_set_gb_position ( gb_operator,878,417,szNull,0,0 )
		wf_set_gb_position ( gb_dwbox,1719,193,"Part Info",449,695 )
		wf_set_gb_position ( gb_numberof,878,641,"Number of Objects",0,0 )

		iTabSeq = 0
		If szMachineParm = "" Then
			iTabSeq = iTabSeq + 10
			wf_set_ddlb_position ( ddlb_machines,74,257, iTabSeq )
		Else
			bPopulateMachines = False
			wf_set_ddlb_position ( ddlb_machines,74,257, 0 )
		End if
		iTabSeq = iTabSeq + 10
		wf_set_ddlb_position ( ddlb_parts,74,481, iTabSeq )
		iTabSeq = iTabSeq + 10
		wf_set_ddlb_position ( ddlb_packaging,74,705, iTabSeq )
		If bJCLotMode Then
			iTabSeq = iTabSeq + 10
			wf_set_sle_position ( sle_lot,74,929, iTabSeq )
		Else
			wf_set_sle_position ( sle_lot,74,929, 0 )
		End if
		iTabSeq = iTabSeq + 10
		wf_set_ddlb_position ( ddlb_location_to,915,257, iTabSeq )
		iTabSeq = iTabSeq + 10
		wf_set_sle_position ( sle_operator,915,481, iTabSeq )
		If bJCNumberOfMode Then
			iTabSeq = iTabSeq + 10
			wf_set_sle_position ( sle_numberof,915,705, iTabSeq )
		Else
			wf_set_sle_position ( sle_numberof,915,705, 0 )
		End if
		If bJCQtyMode Then
			iTabSeq = iTabSeq + 10
			wf_set_sle_position ( sle_qty,915,929, iTabSeq )
		Else
			wf_set_sle_position ( sle_numberof,915,705, 0 )
		End if
		If bJCUnitMode Then
			iTabSeq = iTabSeq + 10
			ddlb_unit.TabOrder = iTabSeq
		Else
			ddlb_unit.TabOrder = 0
		End if
		ddlb_unit.Show ( )
		cb_48.Enabled = True
		cb_48.Text = "Complete"
		iTabSeq = iTabSeq + 10
		cb_48.TabOrder = iTabSeq

		cb_46.Enabled = True
		
		sle_numberof.Text = "1"

		wf_set_dw_position ( dw_misc,1756,257,353,622,"d_part_info_jc",False,False )

		If szMachineParm = "" Then
			ddlb_machines.SetFocus ( )
		Else
			ddlb_machines.Text = szMachineParm
			ddlb_parts.SetFocus ( )
		End if

	Case "BreakOut"

		dw_audit_trail.DataObject = "d_generic_audit_trail"

		wf_set_gb_position ( gb_qty,988,865,"Qty Broken Out",0,0 )
		wf_set_gb_position ( gb_unit,1829,865,szNull,0,0 )
		wf_set_gb_position ( gb_operator,147,193,szNull,0,0 )
		wf_set_gb_position ( gb_dwbox,1207,193,"Object Info",577,1100 )
		wf_set_gb_position ( gb_numberof,147,865,"Objects Broken Out",0,0 )
		wf_set_gb_position ( gb_serial_number,147,417,szNull,0,0 )
		wf_set_gb_position ( gb_packaging, 147, 641, szNull, 0, 0 )

		iTabSeq = 10
		wf_set_sle_position ( sle_operator,183,257, iTabSeq )
		iTabSeq = iTabSeq + 10
		wf_set_sle_position ( sle_serial,183,481, iTabSeq )
		iTabSeq = iTabSeq + 10
		ddlb_packaging.TabOrder = iTabSeq
		ddlb_packaging.Show ( )
		If bBONumberOfMode Then
			iTabSeq = iTabSeq + 10
			wf_set_sle_position ( sle_numberof,183,929, iTabSeq )
		Else
			wf_set_sle_position ( sle_numberof,183,929, 0 )
		End if
		iTabSeq = iTabSeq + 10
		wf_set_sle_position ( sle_qty,1024,929, iTabSeq )
		If bBOUnitMode Then
			iTabSeq = iTabSeq + 10
	 		wf_set_ddlb_position ( ddlb_unit,1866,929, iTabSeq )
		Else
	 		wf_set_ddlb_position ( ddlb_unit,1866,929, 0 )
		End if

		cb_48.Enabled = True
		cb_48.Text = "BreakOut"
		iTabSeq = iTabSeq + 10
		cb_48.TabOrder = iTabSeq

		cb_46.Enabled = True

		wf_set_dw_position ( dw_misc,1244,257,481,1026,"d_object_info_bo",False,False )

		sle_serial.Text = stParm.Value2
		sle_serial.TriggerEvent ( Modified! )

		sle_operator.SetFocus ( )

	Case "Material Issue"

		dw_audit_trail.DataObject = "d_generic_audit_trail_by_machine_mi"

		wf_set_gb_position ( gb_qty,74,897,szNull,0,0 )
		wf_set_gb_position ( gb_unit,915,897,szNull,0,0 )
		wf_set_gb_position ( gb_operator,74,449,szNull,0,0 )
		wf_set_gb_position ( gb_dwbox,1134,225,"Object Info",577,1100 )
		wf_set_gb_position ( gb_serial_number,74,673,szNull,0,0 )
		wf_set_gb_position ( gb_machine,74,225,szNull,0,0 )

		iTabSeq = 0
		ddlb_machines.Visible = True
		If szMachineParm = "" Then
			iTabSeq = iTabSeq + 10
			ddlb_machines.TabOrder = iTabSeq
		Else
			bPopulateMachines = False
			ddlb_machines.TabOrder = 0
		End if
		iTabSeq = iTabSeq + 10
		wf_set_sle_position ( sle_operator,110,513, iTabSeq )
		iTabSeq = iTabSeq + 10
		wf_set_sle_position ( sle_serial,110,737, iTabSeq )
		iTabSeq = iTabSeq + 10
		wf_set_sle_position ( sle_qty,110,961, iTabSeq )
		If bMIUnitMode Then
			iTabSeq = iTabSeq + 10
	 		wf_set_ddlb_position ( ddlb_unit,951,961, iTabSeq )
		Else
	 		wf_set_ddlb_position ( ddlb_unit,951,961, 0 )
		End if
		cb_48.Enabled = True
		cb_48.Text = "Issue"
		iTabSeq = iTabSeq + 10
		cb_48.TabOrder = iTabSeq

		wf_set_dw_position ( dw_misc,1177,289,481,1026,"d_object_info_bo",False,False )

		sle_serial.Text = stParm.Value2
		sle_serial.TriggerEvent ( Modified! )

		If szMachineParm = "" Then
			ddlb_machines.SetFocus ( )
		Else
			ddlb_machines.Text = szMachineParm
			sle_operator.SetFocus ( )
		End if

	Case "Quality Control"

		dw_audit_trail.DataObject = "d_generic_audit_trail"

		SELECT parameters.delete_scrapped_objects  
		  INTO :cDeleteScrap  
		  FROM parameters  ;

		If f_get_string_value ( cDeleteScrap ) = 'Y' Then bDeleteScrap = True

		wf_set_gb_position ( gb_operator,74,257,szNull,0,0 )
		wf_set_gb_position ( gb_serial_number,74,895,szNull,0,0 )
		wf_set_gb_position ( gb_dwbox,915,257,"Choose Object's New Status",865,1500 )
		wf_set_gb_position ( gb_qc_notes,74,481,szNull,0,0 )

		wf_set_sle_position ( sle_operator,110,321, 10 )
		mle_qc_notes.TabOrder = 20
		wf_set_sle_position ( sle_serial,110,959, 30 )

		mle_qc_notes.y = 545
		mle_qc_notes.Show ( )
		
		dw_misc.Enabled = True
		wf_set_dw_position ( dw_misc,951,321,769,1427,"d_status_list",False,False )
		dw_misc.VScrollBar = TRUE
		dw_misc.SetTransObject ( sqlca )
		dw_misc.Retrieve ( )
		//wf_set_dw_position ( dw_misc,951,321,769,1427,"d_external_object_status",False,False )
		//dw_misc.InsertRow ( 1 )
		//dw_misc.SetItem ( 1, "status", "A" )
		sle_serial.Text = stParm.Value2

		sle_operator.SetFocus ( )

	Case "Combine"

		dw_audit_trail.DataObject = "d_generic_audit_trail"

		cb_44.Text = "Label"
		cb_44.Enabled = True
		
		gb_operator.Visible = True
		gb_new_object.Visible = True
		gb_current_object.Visible = True

		dw_current_object.SetTransObject ( sqlca )
		dw_new_object.SetTransObject ( sqlca )
		dw_current_object.Reset ( )
		dw_current_object.InsertRow ( 1 )
		dw_new_object.Reset ( )
		If dw_new_object.Retrieve ( Long ( stParm.Value2 ) ) < 1 Then
			dw_new_object.Reset ( )
			dw_new_object.InsertRow ( 1 )
		End if

		sle_operator.Visible = True
		dw_current_object.Visible = True
		dw_new_object.Visible = True
		sle_operator.TabOrder = 10
		sle_combine_serial.TabOrder = 20
		sle_1.Visible = True
		sle_1.TabOrder = 30

		sle_combine_serial.Show ( )
		sle_combine_serial.SetFocus ( )

		sle_operator.SetFocus ( )

End Choose


end subroutine

public subroutine wf_set_rb_position (radiobutton rb, int x, int y, string text);rb.x = x
rb.y = y
rb.Text = text
rb.Visible = True
end subroutine

public subroutine wf_set_dw_position (datawindow dw, int x, int y, int height, int width, string data_object, boolean h_scroll, boolean v_scroll);dw.DataObject = data_object
dw.x = x
dw.y = y
dw.Height = height
dw.Width = width
dw.VScrollBar = v_scroll
dw.HScrollBar = h_scroll
dw.Visible = True
end subroutine

public subroutine wf_set_gb_position (groupbox group_box, int x, int y, string text, int height, int width);group_box.x = x
group_box.y = y
If Not IsNull ( text ) Then group_box.text = text
If height > 0 Then group_box.height = height
If width > 0 Then group_box.width = width
group_box.Visible = True
end subroutine

public subroutine wf_reset_indicators ();bOperator 		= False
bSerialNumber 	= False
bLocationTo 	= False
bLocationFrom 	= False
bParts 			= False
bMachines 		= False
bQty 				= False
bLot 				= False
bNumberOf 		= False
bUnits 			= False
bPackaging 		= False
bCombineSerial = False
bCB48 			= False
bQCNotes 		= False

wf_reset_colors ( )
end subroutine

public function string wf_location_of_super_object (long lserial);String szLocation


 DECLARE get_location_of_super_object CURSOR FOR  
  SELECT object.location  
    FROM object  
   WHERE object.parent_serial = :lSerial   ;

Open get_location_of_super_object ;

Fetch get_location_of_super_object into :szLocation ;

Close get_location_of_super_object ;

szLocation = f_get_string_value ( szLocation )

Return szLocation
end function

public subroutine wf_transfer_update_object ();//	Declare variables
Int iRtnCode
Int iLoop
String szVendor
String szShipper
String szCost
String szPlant
Dec dCost

//	Grab all of the part info
lRow = dw_object.GetRow ( )
If lRow < 1 Then Return

lSerial = f_get_value ( Long ( sle_serial.Text ) )
szPart = f_get_string_value ( dw_object.GetItemString ( 1, "Part" ) )
szLot = f_get_string_value ( dw_object.GetItemString ( 1, "Lot" ) )
szStatus = f_get_string_value ( dw_object.GetItemString ( 1, "Status" ) )
dQuantity = f_get_value ( dw_object.GetItemNumber ( 1, "Quantity" ) )
dWeight = f_get_value ( dw_object.GetItemNumber ( 1, "weight" ) )
dPrice = f_get_value ( dw_object.GetItemNumber ( 1, "cost" ) )
szPoNumber = f_get_String_value ( dw_object.GetItemString ( 1, "po_number" ) )
szUnit = f_get_string_value ( dw_object.GetItemString ( 1, "unit_measure" ) )
szLocation = f_get_string_value ( dw_object.GetItemString ( 1, "location" ) )
If rb_1.Checked = True Then
	szNewLoc = f_get_string_value ( ddlb_location_to.Text ) 
Else
	szNewLoc = wf_location_of_super_object ( Long ( ddlb_location_to.Text ) )
End if
dToday = Today ( )
tTime = now ( )
dDateTime = DateTime ( Today ( ), Now ( ) )
	
SELECT location.plant  
  INTO :szPlant  
  FROM location  
 WHERE location.code = :szNewLoc   ;

SELECT audit_trail.vendor,   
       audit_trail.shipper
  INTO :szVendor,   
       :szShipper
  FROM audit_trail  
 WHERE ( audit_trail.serial = :lSerial ) AND  
       ( audit_trail.type = 'R' )   ;

//	Update Object File
If bWriteParent Then

	dw_object.SetItem ( lRow, "parent_serial", lParent )

Elseif bZeroParent Then

	dw_object.SetItem ( lRow, "parent_serial", 0 )

End if

dw_object.SetItem ( lRow, "last_date", dToday )
dw_object.SetItem ( lRow, "last_time", tTime )
dw_object.SetItem ( lRow, "location", szNewLoc )
dw_object.SetItem ( lRow, "plant", szPlant )
dw_object.SetItem ( lRow, "operator", szOperator )

iRtnCode = dw_object.Update ( )

If iRtnCode <> 1 Then

	ROLLBACK ;
	f_beep ( 5 )
	sle_serial.Text = ""

Else 
	//	Create audit trail

	SELECT	part_online.on_hand  
	INTO	:dOnHand  
	FROM	part_online  
	WHERE	part_online.part = :szPart   ;
	
	dOnHand = f_get_value ( dOnHand )

	If Not f_create_audit_trail ( lSerial, "T", szLocation, szNewLoc, szVendor, szShipper, szPlant, "", "", "", "", "" ) Then


		f_beep ( 5 )
		sle_serial.Text = ""
		Return

	Else

		COMMIT ;
		f_beep ( 1 )
		wf_show_message ( )
		sle_serial.Text = ""
		Return

	End if

End if

end subroutine

public subroutine wf_transfer_update_objects ();//	Declare variables
Int iRtnCode
Int iLoop
String szVendor
String szShipper
String szCost
String szPlant
Dec dCost

//	Grab all of the part info

For lRow = 1 to dw_misc.RowCount ( )

	lSerial = f_get_value ( dw_misc.GetItemNumber ( lRow, "serial" ) )
	szPart = f_get_string_value ( dw_misc.GetItemString ( lRow, "Part" ) )
	szLot = f_get_string_value ( dw_misc.GetItemString ( lRow, "Lot" ) )
	szStatus = f_get_string_value ( dw_misc.GetItemString ( lRow, "Status" ) )
	dQuantity = f_get_value ( dw_misc.GetItemNumber ( lRow, "Quantity" ) )
	dWeight = f_get_value ( dw_misc.GetItemNumber ( lRow, "weight" ) )
	dPrice = f_get_value ( dw_misc.GetItemNumber ( lRow, "cost" ) )
	szPoNumber = f_get_String_value ( dw_misc.GetItemString ( lRow, "po_number" ) )
	szUnit = f_get_string_value ( dw_misc.GetItemString ( lRow, "unit_measure" ) )
	szLocation = f_get_string_value ( dw_misc.GetItemString ( lRow, "location" ) )
	szNewLoc   = f_get_string_value ( ddlb_location_to.Text )
	dToday = Today ( )
	tTime = now ( )
	dDateTime = DateTime ( Today ( ), Now ( ) )

	SELECT location.plant  
	  INTO :szPlant  
	  FROM location  
	 WHERE location.code = :szNewLoc   ;

	//	Update Object File
	If bWriteParent Then

		dw_misc.SetItem ( lRow, "parent_serial", lParent )

	Elseif bZeroParent Then

		dw_misc.SetItem ( lRow, "parent_serial", 0 )

	End if

	dw_misc.SetItem ( lRow, "plant", szPlant )
	dw_misc.SetItem ( lRow, "location", szNewLoc )
	dw_misc.SetItem ( lRow, "last_date", dToday )
	dw_misc.SetItem ( lRow, "last_time", tTime )
	dw_misc.SetItem ( lRow, "operator", szOperator )
	iRtnCode = dw_misc.Update ( )

	If iRtnCode <> 1 Then

		ROLLBACK ;
		f_beep ( 5 )
		sle_serial.Text = ""
	
	Else 
		//	Create audit trail
		SELECT audit_trail.vendor,   
		       audit_trail.shipper
		  INTO :szVendor,   
		       :szShipper
		  FROM audit_trail  
		 WHERE ( audit_trail.serial = :lSerial ) AND  
		       ( audit_trail.type = 'R' )   ;
	
		szCost = f_get_string_value ( String ( dCost ) )

		If Not f_create_audit_trail ( lSerial, "T", szLocation, szNewLoc, szVendor, szShipper, szPlant, "", "", "", "", "" ) Then

			f_beep ( 5 )
			sle_serial.Text = ""
			Return
	
		Else
			COMMIT ;
			f_beep ( 1 )
			wf_show_message ( )
			sle_serial.Text = ""
	
		End if
	
	End if
	
Next	

end subroutine

public subroutine wf_transfer_super_object (dropdownlistbox ddlbname);SetPointer ( HourGlass! )

Long lSerial

 DECLARE super_objects CURSOR FOR  
  SELECT object.serial  
    FROM object  
   WHERE object.type = 'S'   
ORDER BY object.serial ASC  ;

Open super_objects ;

ddlbName.Reset ( )

Do

	FETCH super_objects Into :lSerial ;

	If ddlbName.FindItem ( String ( lSerial ), 1 ) < 1 Then &
		ddlbName.AddItem ( String ( lSerial ) )

Loop While SQLCA.SQLCode = 0

Close super_objects ;

SetPointer ( Arrow! )

end subroutine

public subroutine wf_set_em_position (editmask em, int x, int y, boolean spin_control);em.x = x
em.y = y
em.Spin = spin_control
em.Visible = True
end subroutine

public subroutine wf_get_location_tos ();wf_disable_screen ( )

SetPointer ( HourGlass! )

String 	szCode
String 	szPreviousText
String	cLimitLocations

If dw_limit_locs.RowCount ( ) > 0 Then
	DECLARE location_list_limited CURSOR FOR  
	 SELECT location_code 
	   FROM location_limits  
	  WHERE trans_code = Left ( :stParm.Value1, 1 )   
  ORDER BY location_code ASC  ;
Else
    DECLARE location_list CURSOR FOR  
	  SELECT location.code
	    FROM location  ;
End if

szPreviousText = f_get_string_value ( ddlb_location_to.Text )

If szPreviousText <> "" Then &
	szSelectedText = szPreviousText

ddlb_location_to.Reset ( )

If dw_limit_locs.RowCount ( ) > 0  Then
	Open location_list_limited ;
Else
	Open location_list ;
End if

Do

	If dw_limit_locs.RowCOunt ( ) > 0 Then
		Fetch location_list_limited Into :szCode ;
	Else
		Fetch location_list Into :szCode ;
	End if

	If ddlb_location_to.FindItem ( szCode, 1 ) < 1 Then &
		ddlb_location_to.AddItem ( szCode )

Loop While SQLCA.SQLCode = 0

If szPreviousText <> "" Then &
	ddlb_location_to.Text = szPreviousText

If dw_limit_locs.RowCount ( ) > 0 Then
	Close location_list_limited ;
Else
	Close location_list ;
End if

SetPointer ( Arrow! )

wf_enable_screen ( )
wf_set_focus ( )
end subroutine

public subroutine wf_get_machines ();wf_disable_screen ( )

String 	szCode
String	cLimitLocations

If dw_limit_locs.RowCount ( ) > 0 Then


 DECLARE machine_list_limited CURSOR FOR  
  SELECT location_limits.location_code  
    FROM location,   
         location_limits  
   WHERE ( location.code = location_limits.location_code ) and  
         ( ( location_limits.trans_code = Left ( :stParm.Value1, 1 ) ) AND  
         ( location.type = 'MC' ) )   
ORDER BY location_limits.location_code ASC  ;

	Open machine_list_limited ;

Else

	 DECLARE machine_list CURSOR FOR  
	  SELECT machine.machine_no  
	    FROM machine
	ORDER BY machine.machine_no ASC  ;

	Open machine_list ;

End if



Do

	If dw_limit_locs.RowCount ( ) > 0 Then
		Fetch machine_list_limited Into :szCode ;
	Else
		Fetch machine_list Into :szCode ;
	End if

	If ddlb_machines.FindItem ( szCode, 1 ) < 1 Then &
		ddlb_machines.AddItem ( szCode )

Loop While SQLCA.SQLCode = 0

If dw_limit_locs.RowCount ( ) > 0 Then
	Close machine_list_limited ;
Else
	Close machine_list ;
End if

wf_enable_screen ( )
wf_set_focus ( )
end subroutine

public subroutine wf_get_parts ();wf_disable_screen ( )

String 	szPartNumber
String 	szTemp
String	cPartsMode

SELECT inventory_parameters.jc_parts_mode  
  INTO :cPartsMode  
  FROM inventory_parameters  ;

If cPartsMode = 'N' Then

	 DECLARE part_list CURSOR FOR  
	  SELECT number,   
	         class  
	    FROM part  
	   WHERE class = 'M'   
	ORDER BY class ASC  ;

	Open part_list ;

Else

	 DECLARE parts_top_level_flow_router_list CURSOR FOR  
	  SELECT DISTINCT part,
				parent_part  
	    FROM activity_router  
	   WHERE sequence = 1   ;

	Open parts_top_level_flow_router_list ;

End if

Do

	If cPartsMode = 'N' Then
		Fetch part_list Into :szPartNumber, :szTemp ;
	Else
		Fetch parts_top_level_flow_router_list Into :szPartNumber, :szTemp ;
	End if

	If ddlb_parts.FindItem ( szPartNumber, 1 ) < 1 Then &
		ddlb_parts.AddItem ( szPartNumber )

Loop While SQLCA.SQLCode = 0

If cPartsMode = 'N' Then
	Close part_list ;
Else
	Close parts_top_level_flow_router_list ;
End if

wf_enable_screen ( )
wf_set_focus ( )
end subroutine

public subroutine wf_enable_screen ();cb_1.Enabled = True
cb_2.Enabled = True
cb_3.Enabled = True
cb_4.Enabled = True
cb_5.Enabled = True
cb_6.Enabled = True
cb_7.Enabled = True
cb_8.Enabled = True
cb_9.Enabled = True
cb_10.Enabled = True
cb_11.Enabled = True
cb_12.Enabled = True
cb_13.Enabled = True
cb_14.Enabled = True
cb_15.Enabled = True
cb_16.Enabled = True
cb_17.Enabled = True
cb_18.Enabled = True
cb_19.Enabled = True
cb_20.Enabled = True
cb_21.Enabled = True
cb_22.Enabled = True
cb_23.Enabled = True
cb_24.Enabled = True
cb_31.Enabled = True
cb_32.Enabled = True
cb_40.Enabled = True
cb_41.Enabled = True
cb_25.Enabled = True
cb_26.Enabled = True
cb_27.Enabled = True
cb_28.Enabled = True
cb_29.Enabled = True
cb_33.Enabled = True
cb_34.Enabled = True
cb_35.Enabled = True
cb_36.Enabled = True
cb_39.Enabled = True
cb_42.Enabled = True
cb_44.Enabled = True
cb_45.Enabled = True
If stParm.Value1 = "JobComplete" Or stParm.Value1 = "BreakOut" Or stParm.Value1 = "Material Issue" Then &
	cb_46.Enabled = True
cb_47.Enabled = True
cb_48.Enabled = True
cb_43.Enabled = True
cb_30.Enabled = True
cb_37.Enabled = True
cb_38.Enabled = True
cb_55.Enabled = True
cb_57.Enabled = True
//cb_51.Enabled = True


//  Common Stuff
sle_operator.Enabled = True
dw_misc.Enabled = True

//If stParm.Value1 = "Transfer" Or stParm.Value1 = "JobComplete" Then
	ddlb_location_to.Enabled = True
//End if

//If stParm.Value1 = "Transfer" Then
	sle_serial.Enabled = True
//End if

//If stParm.Value1 = "JobComplete" Then
	ddlb_machines.Enabled = True
	ddlb_parts.Enabled = True
	sle_qty.Enabled = True
	ddlb_unit.Enabled = True
	sle_lot.Enabled = True
	ddlb_packaging.Enabled = True
	sle_numberof.Enabled = True
//End if

bNoKey = False
end subroutine

public subroutine wf_disable_screen ();bNoKey = True
cb_1.Enabled = False
cb_2.Enabled = False
cb_3.Enabled = False
cb_4.Enabled = False
cb_5.Enabled = False
cb_6.Enabled = False
cb_7.Enabled = False
cb_8.Enabled = False
cb_9.Enabled = False
cb_10.Enabled = False
cb_11.Enabled = False
cb_12.Enabled = False
cb_13.Enabled = False
cb_14.Enabled = False
cb_15.Enabled = False
cb_16.Enabled = False
cb_17.Enabled = False
cb_18.Enabled = False
cb_19.Enabled = False
cb_20.Enabled = False
cb_21.Enabled = False
cb_22.Enabled = False
cb_23.Enabled = False
cb_24.Enabled = False
cb_31.Enabled = False
cb_32.Enabled = False
cb_40.Enabled = False
cb_41.Enabled = False
cb_25.Enabled = False
cb_26.Enabled = False
cb_27.Enabled = False
cb_28.Enabled = False
cb_29.Enabled = False
cb_33.Enabled = False
cb_34.Enabled = False
cb_35.Enabled = False
cb_36.Enabled = False
cb_39.Enabled = False
cb_42.Enabled = False
cb_44.Enabled = False
cb_45.Enabled = False
cb_46.Enabled = False
cb_47.Enabled = False
cb_48.Enabled = False
cb_43.Enabled = False
cb_30.Enabled = False
cb_37.Enabled = False
cb_38.Enabled = False
cb_55.Enabled = False
cb_57.Enabled = False
//cb_51.Enabled = False

//  Common Stuff
sle_operator.Enabled = False
dw_misc.Enabled = False

//If stParm.Value1 = "Transfer" Or stParm.Value1 = "JobComplete" Then
	ddlb_location_to.Enabled = False
//End if

//If stParm.Value1 = "Transfer" Then
	sle_serial.Enabled = False
//End if

//If stParm.Value1 = "JobComplete" Then
	ddlb_machines.Enabled = False
	ddlb_parts.Enabled = False
	sle_qty.Enabled = False
	ddlb_unit.Enabled = False
	sle_lot.Enabled = False
	ddlb_packaging.Enabled = False
	sle_numberof.Enabled = False
//End if

end subroutine

public subroutine wf_set_sle_position (singlelineedit sle, int x, int y, integer taborder);sle.x = x
sle.y = y
sle.Visible = True
sle.taborder = taborder
end subroutine

public subroutine wf_set_ddlb_position (ref dropdownlistbox ddlb, int x, int y, integer taborder);ddlb.x = x
ddlb.y = y
ddlb.Visible = True
ddlb.TabOrder = taborder
end subroutine

public subroutine wf_show_transfer_help ();wf_disable_screen ( )

cb_50.Show ( )
cb_51.Show ( )
lb_2.Show ( )
end subroutine

public subroutine wf_hide_transfer_help ();wf_enable_screen ( )
cb_50.Hide ( )
cb_51.Hide ( )
lb_2.Hide ( )
end subroutine

public function boolean wf_modified ();If bButton Then Return True

/*  Declare Variables  */

String 	ls_Temp
String	ls_Type
String 	ls_TempPackaging
String 	ls_OriginalUnit
String 	ls_TempStatus
String 	ls_NewStatus
String 	ls_PartNumber
String	ls_LimitLocs
String	ls_ShowInInventory, &
			s_ScaleAttached
Int 		iRtnCode
Int 		iLoop
Dec 		dStdPack
Dec 		dAddedQty, dTotalQty
Dec 		dStdQuantity, dNewObjectQty
Dec 		dStdQty
Boolean 	bCheckLocation
Long 		lNewSerial
Long 		lTempShipper
Long 		lTemp
Date 		dToday
Time 		tNow	

dToday = Today ( )
tNow   = Now ( )


/*  Main  */

If bMachines Then

	If bPopulateMachines Then ddlb_machines.Text = szSelectedText

	If Not bBack Then

		ls_Temp = ddlb_machines.Text

		If dw_limit_locs.RowCount ( ) > 0 Then

		  SELECT code  
		    INTO :ls_Temp  
		    FROM location,   
		         location_limits  
		   WHERE ( code = location_code ) and  
		         ( ( location_code = :ls_Temp ) AND  
		         ( trans_code = Left ( :stParm.Value1, 1 ) ) AND  
		         ( type = 'MC' ) )   ;

		Else

		  SELECT code  
		    INTO :ls_Temp  
		    FROM location  
		   WHERE ( code = :ls_Temp ) AND  
		         ( type = 'MC' )   ;

		End if
	
		If SQLCA.SQLCode <> 0 Then

			f_beep ( 5 )
	
			If Not bPopulateMachines Then
				iRtnCode = MessageBox ( "Error", "A valid machine is required! Would you like to use drop down list?", Question!, YesNo!, 1 )
				If iRtnCode = 1 Then
					bPopulateMachines = True
					ddlb_machines.ShowList = True
					If ddlb_machines.TotalItems ( ) < 1 Then wf_get_machines ( )
				End if
			Else
				MessageBox ( "Error", "A valid machine is required!  Please select a valid one from list.", StopSign! )
			End if
			ddlb_machines.Text = ""
			szRealityText = ""
			szSelectedText = ""
			ddlb_machines.SetFocus ( )
			Return False
	
		Else
	
			ddlb_location_to.Text = ddlb_machines.Text
	
			SELECT machine_policy.scale_attached   
			  INTO :s_ScaleAttached   
			  FROM machine_policy  
			 WHERE machine_policy.machine = :ddlb_machines.Text   ;

			If SQLCA.SQLCode = 0 Then
				If s_ScaleAttached = 'Y' Then &
					ib_Scale = TRUE
			End if

		End if
	
	End if

Elseif bParts Then
	
	If bPopulateParts Then ddlb_parts.Text = szSelectedText
	ddlb_parts.Text = Upper ( ddlb_parts.Text )
	
	If Not bBack Then

	   SELECT part.class  
	     INTO :ls_Temp
	     FROM part  
            WHERE part.part = :ddlb_parts.Text  ;
	
		If SQLCA.SQLCode <> 0 Or ls_Temp <> 'M' Or ddlb_parts.Text = "" Then
	
			f_beep ( 5 )
		
			If Not bPopulateParts Then
				iRtnCode = MessageBox ( "Error", "Invalid part number! Would you like to use drop down list?", Question!, YesNo!, 1 )
				If iRtnCode = 1 Then
					bPopulateParts = True
					ddlb_parts.ShowList = True
					If ddlb_parts.TotalItems ( ) < 1 Then wf_get_parts ( )
				End if
			Else
				MessageBox ( "Error", "Invalid part number!  Please select a valid one from the list.", StopSign! )
			End if
			ddlb_parts.Text = ""
			szRealityText = ""
			szSelectedText = ""
			ddlb_parts.SetFocus ( )
			ddlb_packaging.ShowList = False
			Return False
		
		Else
		
			dw_misc.SetTransObject ( sqlca )
		
			If dw_misc.Retrieve ( ddlb_parts.Text ) < 1 Then 
				ddlb_parts.SetFocus ( ) 
				ddlb_packaging.ShowList = False
				Return False
			End if
			
			dw_misc.SetItem ( 1, "standard_pack", "" )
		
			ddlb_parts.ShowList = False
		
			wf_get_unit_list ( ddlb_parts.Text, "" )
	
			ls_TempPackaging = ""
			If ddlb_packaging.Text <> "" Then ls_TempPackaging = ddlb_packaging.Text
			
			If wf_packaging ( ddlb_parts.Text, ls_TempPackaging ) Then
				ddlb_packaging.Text = ls_TempPackaging
			End if
		
			If ib_Scale Then wf_check_for_scale ( )

		End if
		
	End if

Elseif bLocationTo Then
	
	If bPopulateLocations Then ddlb_location_to.Text = szSelectedText

	If Not bBack Then

		If stParm.Value1 = "Transfer" Then
	
			If rb_2.Checked Then
	
				dw_misc.Retrieve ( Long ( ddlb_location_to.Text ) )
		
			Else
	
				bCheckLocation = True
	
			End if
	
		End if
	
		If stParm.Value1 <> "Transfer" Or bCheckLocation Then
	
			ls_Temp = ddlb_location_to.Text
	
			If dw_limit_locs.RowCount ( ) > 0 Then

			  SELECT location_code
			    INTO :ls_Temp  
			    FROM location_limits  
			   WHERE ( trans_code = Left ( :stParm.Value1, 1 ) ) AND  
			         ( location_code = :ls_Temp )   ;

			Else

			  SELECT code
			    INTO :ls_Temp  
			    FROM location 
			   WHERE code = :ls_Temp   ;

			End if
	
			If SQLCA.SQLCode <> 0 Then
	
				f_beep ( 5 )
		
				If Not bPopulateLocations Then
					iRtnCode = MessageBox ( "Error", "Invalid location! Would you like to use drop down list?", Question!, YesNo!, 1 )
					If iRtnCode = 1 Then
						bPopulateLocations = True
						ddlb_location_to.ShowList = True
						If ddlb_location_to.TotalItems ( ) < 1 Then wf_get_location_tos ( )
					End if
				Else
					MessageBox ( "Error", "Invalid location!  Please select a valid one from the list.", StopSign! )
				End if
				ddlb_location_to.Text = ""
				szRealityText = ""
				szSelectedText = ""
				ddlb_location_to.SetFocus ( )
				Return False

			End if
		
		End if 

	End if

Elseif bPackaging Then

	If ddlb_packaging.Text <> "" And Not bBack Then
	
		ddlb_packaging.Text = szSelectedText
		If stParm.Value1 <> "JobComplete" Then
			ls_PartNumber = dw_misc.GetItemString ( 1, "part" )
		Else
			ls_PartNumber = ddlb_parts.Text
		End if

		SELECT part_packaging.quantity  
		  INTO :dStdPack  
		  FROM part_packaging  
		 WHERE ( part_packaging.part = :ls_PartNumber ) AND  
		       ( part_packaging.code = :ddlb_packaging.Text )   ;
		
		If SQLCA.SQLCode <> 0 Then
	
			f_beep ( 5 )

			MessageBox ( "Error", "Invalid package type!", StopSign! )
			ddlb_packaging.Text = ""
			szRealityText = ""
			szSelectedText = ""
			ddlb_packaging.SetFocus ( )
			Return False
	
		Else

			If stParm.Value1 = "JobComplete" Then
				dw_misc.SetItem ( 1, "standard_pack", dStdPack )
				If f_get_string_value ( sle_qty.Text ) = "" Then &
					sle_qty.Text = String ( dStdPack )
				If ib_Scale Then wf_check_for_scale ( )
			Else
				If dw_object.GetItemNumber ( 1, "quantity" ) > dStdPack Then
					If f_get_string_value ( sle_qty.Text ) = "" Then &
						sle_qty.Text = String ( dStdPack )
				Else
					sle_qty.Text = String ( dw_object.GetItemNumber ( 1, "quantity" ) )
				End if
			End if

		End if

	End if

Elseif bLot Then

	If f_get_string_value ( sle_lot.Text ) = "" And Not bBack Then

		f_beep ( 5 )

		iRtnCode = MessageBox ( "Error", "A material lot number is required to continue!", StopSign! )
		sle_lot.SetFocus ( )

		Return False

	End if

Elseif bOperator Then

	If Not bBack Then

		szOperator = ""

		SELECT employee.operator_code  
		  INTO :szOperator  
		  FROM employee  
		 WHERE employee.password = :sle_operator.Text   ;

		szOperator = f_get_string_value ( szOperator )

		If SQLCA.SQLCode = 0 Then
	
			gb_operator.Text = "Operator - " + szOperator

		Else

			f_beep ( 5 )

			gb_operator.Text = "Operator -"
			MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
			sle_operator.Text = ""
			sle_operator.SetFocus ( )
			Return False

		End if

	End if

Elseif bQty Then

	If ib_PopupScaleInterface Then Return TRUE

	If stParm.Value1 = "Material Issue" Or stParm.Value1 = "BreakOut" Then
		If cIssueType = "U" And Dec ( sle_qty.Text ) <= 0 And Not bBack Then
			f_beep ( 5 )
			MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
			sle_qty.SetFocus ( )
			Return False
		End if
	ElseIf Dec ( sle_qty.Text ) <= 0 And Not bBack Then
		f_beep ( 5 )
		MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
		sle_qty.SetFocus ( )
		Return False
	End if

Elseif bNumberOf Then

	If Dec ( sle_numberof.Text ) < 1 And Not bBack Then
		f_beep ( 5 )
		MessageBox ( "Error", "Number of objects must be greater than 0!", StopSign! )
		sle_numberof.SetFocus ( )
		Return False
	End if

Elseif bSerialNumber Then

	/*  Main  */

	//If Not bLoseFocus And Not bBack Then
	If Not bBack Then

		If Upper ( Left ( sle_serial.Text, 1 ) ) = 'S' Then
			sle_serial.Text = Right ( sle_serial.Text, Len ( sle_serial.Text ) - 1 )
		Elseif Not IsNumber ( Left ( sle_serial.Text, 1 ) ) Then
			f_beep ( 5 )
			sle_serial.Text = ""
			MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
			sle_serial.SetFocus ( )
			Return False
		End if
	
		lSerial = f_get_value ( Long ( sle_serial.Text ) )

		If lSerial < 1 Then 
			f_beep ( 5 )
			sle_serial.Text = ""
			MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
			sle_serial.SetFocus ( )
			Return False
		End if
	
		SELECT object.serial,
				 object.shipper,
				 object.status
		  INTO :lTemp,
				 :lTempShipper,
				 :ls_TempStatus
		  FROM object  
		 WHERE object.serial = :lSerial   ;
	
		If SQLCA.SQLCode <> 0 Then
			f_beep ( 5 )
			MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
			sle_serial.Text = ""
			sle_serial.SetFocus ( )
			Return False
		Elseif f_get_string_value ( ls_TempStatus ) <> "A" And stParm.Value1 = "Material Issue" Then
			f_beep ( 5 )
			MessageBox ( "Error", "You cannot perform this transaction on an object with status other than approved!", StopSign! )
			sle_serial.Text = ""
			sle_serial.SetFocus ( )
			Return False
		Elseif f_get_value ( lTempShipper ) > 0 Then
			f_beep ( 5 )
			MessageBox ( "Error", "You cannot perform this transaction on a staged object!", StopSign! )
			sle_serial.Text = ""
			sle_serial.SetFocus ( )
			Return False
		End if
	
		If stParm.Value1 = "Transfer" Then
	
			If KeyDown ( keyTab! ) And Not KeyDown ( keyEnter! ) Then Return False

			/*  Check for operator  */
	
			If szOperator = "" Then
				f_beep ( 5 )
				MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
				bOperator = True
				wf_set_focus ( )
				Return False
			End if

			If ddlb_location_to.Text = "" Then
				If rb_1.Checked Then
					f_beep ( 5 )
					If Not bPopulateLocations Then
						iRtnCode = MessageBox ( "Error", "Invalid location! Would you like to use drop down list?", Question!, YesNo!, 1 )
						If iRtnCode = 1 Then
							bPopulateLocations = True
							ddlb_location_to.ShowList = True
							wf_get_location_tos ( )
						End if
					Else
						MessageBox ( "Error", "Invalid location!  Please select a valid one from the list.", StopSign! )
					End if
					ddlb_location_to.Text = ""
					ddlb_location_to.SetFocus ( )
					Return False
				Else
					f_beep ( 5 )
					MessageBox ( "Error", "Invalid super object!  Please enter a valid one.", StopSign! )
					ddlb_location_to.SetFocus ( )
					Return False
				End if

			End if

			dw_object.SetTransObject ( sqlca )
			dw_object.Retrieve ( lSerial )
			
			/*
			Figure out From and To Locations
			*/
			
			cObjectType = f_get_string_value ( &
				dw_object.GetItemString ( 1, "type" ) )
			lParent = f_get_value ( &
				dw_object.GetItemNumber ( 1, "parent_serial" ) )
			
			szNewLoc     = f_get_string_value ( ddlb_location_to.Text )
			bSuper       = False
			bZeroParent  = False
			bNoCheck     = False
			bWriteParent = False
		
			szMessage = "message"

			If cObjectType = "S" Then	  // Object is a super one

				/*
				Super Object can only be transfered to a location and not another
				super object.
				*/
		
				If rb_2.Checked = True Then     
			
					MessageBox ( "Error", "You cannot transfer a super object to another super object!", StopSign! )
					sle_serial.Text = ""
					sle_serial.SetFocus ( )
					Return False
				
				End if
			
				szLocation = wf_location_of_super_object ( lSerial )

				szMessage = "You cannot transfer super " + &
								"object to the same location!"

				bSuper = True

		 	Else   // Just a normal object
		
				szLocation = f_get_string_value ( &
					dw_object.GetItemString ( 1, "Location" ) )
		
				If lParent > 0 Then     //  Object is attached to a super object

					/*
					Object attached to a Super-object -> location
					*/
					If rb_1.Checked Then  

						szLocation = wf_location_of_super_object ( lSerial )
						szMessage = "You cannot transfer to the same location!"
						bZeroParent = True
				
					/*
					Object attached to a Super-object -> Super-object
					*/
					Else        //  Normal object
	
						szLocation = String ( lParent )
						szMessage = "You cannot transfer an object " + &
										"to the same Super Object!"
						bWriteParent = True
		  
					End if
		
				/*
				Object
				*/
				Else
				
					/*
					Object -> Location
					*/
					If rb_1.Checked Then

						szMessage = "You cannot transfer to the same location!"

					/*
					Object -> Super-object
					*/
					Else

						bNoCheck = True
						bWriteParent = True

					End if
						
				End if

			End if


			If Not bNoCheck Then

				If szLocation = szNewLoc Then

					f_beep ( 5 )
					MessageBox ( "Error", szMessage, StopSign! )
					sle_serial.Text = ''	
					sle_serial.SetFocus ( )
					Return False

				End if

			End if
	
			If bSuper Then

				dw_misc.SetTransObject ( sqlca )
				dw_misc.Retrieve ( lSerial )
		
				wf_transfer_update_objects ( )

			Else

				lParent = Long ( ddlb_location_to.Text )
				dwObject = dw_object
				wf_transfer_update_object ( )
	
			End if
	
			If rb_2.Checked Then &
				dw_misc.Retrieve ( lParent )	

		ElseIf stParm.Value1 = "BreakOut" Then
	
			bLoseFocus = True
	
			dw_misc.SetTransObject ( sqlca )
			dw_misc.Retrieve ( lSerial )
	
			szPart = dw_misc.GetItemString ( 1, "part" )
			ls_OriginalUnit = dw_misc.GetItemString ( 1, "unit" )
	
			dw_object.SetTransObject ( sqlca )
			dw_object.Retrieve ( lSerial )
	
			wf_get_unit_list ( szPart, ls_OriginalUnit )
	
			ddlb_unit.Text = ls_OriginalUnit

			ls_TempPackaging = ""
			If ddlb_packaging.Text <> "" Then ls_TempPackaging = ddlb_packaging.Text
			
			If wf_packaging ( szPart, ls_TempPackaging ) Then
				ddlb_packaging.Text = ls_TempPackaging
			End if

		Elseif stParm.Value1 = "Material Issue" Then
	
			bLoseFocus = True
	
			dw_misc.SetTransObject ( sqlca )
			dw_misc.Retrieve ( lSerial )

			szPart = dw_misc.GetItemString ( 1, "part" )
			ls_OriginalUnit = dw_misc.GetItemString ( 1, "unit" )

			SELECT part_inventory.material_issue_type  
			  INTO :cIssueType  
			  FROM part_inventory  
			 WHERE part_inventory.part = :szPart   ;
	
			wf_get_unit_list ( szPart, ls_OriginalUnit )
	
			ddlb_unit.Text = ls_OriginalUnit

			dw_object.SetTransObject ( sqlca )
			dw_object.Retrieve ( lSerial )

			If cIssueType = "U" Then
				gb_qty.Text = "Quantity Used"
				sle_qty.Text = String ( dw_object.GetItemNumber ( 1, "quantity" ) )
			Else
				gb_qty.Text = "Quantity Remaining"
			End if

			szField = "qty"
			wf_set_focus ( )

		Elseif stParm.Value1 = "Quality Control" Then

			dw_object.SetTransObject ( sqlca )

			String cCurrentStatus

			Dec dPrice, dOnHand, dWeight, dQuantity

			lSerial = f_get_value ( Long ( sle_serial.Text ) )
	
			If lSerial < 1 Then Return False

			If dw_object.Retrieve ( lSerial ) < 1 Then
				f_beep ( 5 )
				MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
				sle_serial.Text = ""
				sle_serial.Setfocus ( )
				Return False
			End if

			cCurrentStatus = dw_object.GetItemString ( 1, "status" )
			ls_NewStatus = dw_misc.GetItemString ( 1, "status" )

			If cCurrentStatus = ls_NewStatus Then
				f_beep ( 5 )
				MessageBox ( "Error", "This object is already at the selected status!", StopSign! )
				sle_serial.Text = ""
				sle_serial.SetFocus ( )
				Return False
			End if

			dw_object.SetItem ( 1, "status", ls_NewStatus )
			dw_object.SetItem ( 1, "last_date", dToday )
			dw_object.SetItem ( 1, "last_time", tNow )
			dw_object.SetItem ( 1, "operator", szOperator )

			If dw_object.Update ( ) = -1 Then
				RollBack ;
				sle_serial.Text = ""
				f_beep ( 5 )
				Return False
			Else
			
				If Not f_create_audit_trail ( lSerial, "Q", cCurrentStatus, ls_NewStatus, "", "", "", "", "", "", "", "" ) Then

					Return False

				End if

				f_beep ( 1 )
				wf_show_message ( )	
				sle_serial.SetFocus ( )

			End if

		End if

	Else

		bLoseFocus = False

	End if

Elseif bQCNotes Then

	If bMandatoryQCNotes and f_get_string_value ( mle_qc_notes.Text ) = "" And cStatus <> 'A' Then
		mle_qc_notes.SetFocus ( )
		Return False
	Else
		sle_serial.Setfocus ( )
	End if	

End if
	
Return True


end function

public subroutine wf_set_focus ();Choose Case szField

	Case "machine"
		ddlb_machines.SetFocus ( )

	Case "part"
		ddlb_parts.SetFocus ( )

	Case "location"
		ddlb_location_to.SetFocus ( )

	Case "packaging"
		ddlb_packaging.SetFocus ( )

	Case "unit"
		ddlb_unit.SetFocus ( )

	Case "operator"
		sle_operator.SetFocus ( )

	Case "qty"
		sle_qty.SetFocus ( )

	Case "numberof"
		sle_numberof.SetFocus ( )

	Case "lot"
		sle_lot.SetFocus ( )

	Case "combineserial"
		sle_combine_serial.SetFocus ( )

	Case "serial"
		sle_serial.SetFocus ( )

	Case "qcnotes"
		mle_qc_notes.SetFocus ( )

End Choose


end subroutine

public subroutine wf_get_unit_list (string szpartnumber, string szoriginalunit);//  Declare Variables

Int iPos
Int iLoop

String szTempUnit


//  Initialize Variables

dw_unit_list.DataObject = "d_unit_conversion_list_per_part"
dw_unit_list.SetTransObject ( sqlca )
ddlb_unit.Reset ( )
lb_unit_list.Reset ( )

If IsNull ( szOriginalUnit ) Or szOriginalUnit = "" Then

  SELECT part_inventory.standard_unit  
    INTO :szOriginalUnit  
    FROM part_inventory  
   WHERE part_inventory.part = :szPartNumber   ;

End if

dw_unit_list.Retrieve ( szPartNumber )

If dw_unit_list.RowCount ( ) < 1 Then Goto THE_END

//  Loop through forward and look for chain

wf_loop_for_avail_units ( szOriginalUnit, 1 )


//  Loop through backwards and look for chain

wf_loop_for_avail_units ( szOriginalUnit, 2 )

THE_END:

If lb_unit_list.FindItem ( szOriginalUnit, 1 ) < 1 Then &
	lb_unit_list.AddItem ( szOriginalUnit )

For iLoop = 1 to lb_unit_list.TotalItems ( )

	iLoop = lb_unit_list.SelectItem ( iLoop )
	ddlb_unit.AddItem ( lb_unit_list.SelectedItem ( ) )

Next

ddlb_unit.Text = szOriginalUnit

end subroutine

public subroutine wf_loop_for_avail_units (string szunit, int iorder);//  Declare Variables

String     szCurrentUnit

Long       lCount
Long       lItem


//  Initialize Variables

If iOrder = 1 Then
	dw_unit_list.SetFilter ( "unit1 = ~"" + szUnit + "~"" )
	dw_unit_list.SetSort ( "unit2 A" )
Else
	dw_unit_list.SetFilter ( "unit2 = ~"" + szUnit + "~"" )
	dw_unit_list.SetSort ( "unit1 A" )
End if

dw_unit_list.Filter ( )
dw_unit_list.Sort ( )
 
//  Loop through the possible units and check each one

For lCount = 1 to dw_unit_list.RowCount ( )

	If iOrder = 1 Then
		szCurrentUnit = dw_unit_list.GetItemString ( lCount, "unit2" )
	Else
		szCurrentUnit = dw_unit_list.GetItemString ( lCount, "unit1" )
	End if

	If lb_unit_list.FindItem ( szCurrentUnit, 1 ) < 1 Then
		lb_unit_list.AddItem ( szCurrentUnit )
		wf_loop_for_avail_units ( szCurrentUnit, iOrder )
	End if

	If iOrder = 1 Then
		dw_unit_list.SetFilter ( "unit1 = ~"" + szUnit + "~"" )
		dw_unit_list.SetSort ( "unit2 A" )
	Else
		dw_unit_list.SetFilter ( "unit2 = ~"" + szUnit + "~"" )
		dw_unit_list.SetSort ( "unit1 A" )
	End if
	
	dw_unit_list.Filter ( )
	dw_unit_list.Sort ( )
 
Next


end subroutine

public subroutine wf_reset_colors ();//gb_machine.TextColor = f_get_color_value ( "darkred" )
//gb_location_to.TextColor = f_get_color_value ( "darkred" )
//rb_1.TextColor = f_get_color_value ( "darkred" )
//rb_2.TextColor = f_get_color_value ( "darkred" )
//gb_parts.TextColor = f_get_color_value ( "darkred" )
//gb_packaging.TextColor = f_get_color_value ( "darkred" )
//gb_lot.TextColor = f_get_color_value ( "darkred" )
//gb_operator.TextColor = f_get_color_value ( "darkred" )
//gb_numberof.TextColor = f_get_color_value ( "darkred" )
//gb_qty.TextColor = f_get_color_value ( "darkred" )
//gb_unit.TextColor = f_get_color_value ( "darkred" )
//gb_serial_number.TextColor = f_get_color_value ( "darkred" )
//gb_qc_notes.TextColor = f_get_color_value ( "darkred" )
//
gb_machine.TextColor = f_get_color_value ( "black" )
gb_location_to.TextColor = f_get_color_value ( "black" )
rb_1.TextColor = f_get_color_value ( "black" )
rb_2.TextColor = f_get_color_value ( "black" )
gb_parts.TextColor = f_get_color_value ( "black" )
gb_packaging.TextColor = f_get_color_value ( "black" )
gb_lot.TextColor = f_get_color_value ( "black" )
gb_operator.TextColor = f_get_color_value ( "black" )
gb_numberof.TextColor = f_get_color_value ( "black" )
gb_qty.TextColor = f_get_color_value ( "black" )
gb_unit.TextColor = f_get_color_value ( "black" )
gb_serial_number.TextColor = f_get_color_value ( "black" )
gb_qc_notes.TextColor = f_get_color_value ( "black" )

end subroutine

public subroutine wf_change_color_focus ();//If bMachines Then
//	gb_machine.TextColor = f_get_color_value ( "blue" )
//Elseif bParts Then
//	gb_parts.TextColor = f_get_color_value ( "blue" )
//Elseif bPackaging Then
//	gb_packaging.TextColor = f_get_color_value ( "blue" )
//Elseif bLot Then
//	gb_lot.TextColor = f_get_color_value ( "blue" )
//Elseif bLocationTo Then
//	If stParm.Value1 = "Transfer" Then
//		rb_1.TextColor = f_get_color_value ( "blue" )
//		rb_2.TextColor = f_get_color_value ( "blue" )
//	Else
//		gb_location_to.TextColor = f_get_color_value ( "blue" )
//	End if
//Elseif bOperator Then
//	gb_operator.TextColor = f_get_color_value ( "blue" )
//Elseif bNumberOf Then
//	gb_numberof.TextColor = f_get_color_value ( "blue" )
//Elseif bQty Then
//	gb_qty.TextColor = f_get_color_value ( "blue" )
//Elseif bUnits Then
//	gb_unit.TextColor = f_get_color_value ( "blue" )
//Elseif bSerialNumber Then
//	gb_serial_number.TextColor = f_get_color_value ( "blue" )
//Elseif bQCNotes Then
//	gb_qc_notes.TextColor = f_get_color_value ( "blue" )
//End if
//
If bMachines Then
	gb_machine.TextColor = f_get_color_value ( "black" )
Elseif bParts Then
	gb_parts.TextColor = f_get_color_value ( "black" )
Elseif bPackaging Then
	gb_packaging.TextColor = f_get_color_value ( "black" )
Elseif bLot Then
	gb_lot.TextColor = f_get_color_value ( "black" )
Elseif bLocationTo Then
	If stParm.Value1 = "Transfer" Then
		rb_1.TextColor = f_get_color_value ( "black" )
		rb_2.TextColor = f_get_color_value ( "black" )
	Else
		gb_location_to.TextColor = f_get_color_value ( "black" )
	End if
Elseif bOperator Then
	gb_operator.TextColor = f_get_color_value ( "black" )
Elseif bNumberOf Then
	gb_numberof.TextColor = f_get_color_value ( "black" )
Elseif bQty Then
	gb_qty.TextColor = f_get_color_value ( "black" )
Elseif bUnits Then
	gb_unit.TextColor = f_get_color_value ( "black" )
Elseif bSerialNumber Then
	gb_serial_number.TextColor = f_get_color_value ( "black" )
Elseif bQCNotes Then
	gb_qc_notes.TextColor = f_get_color_value ( "black" )
End if

end subroutine

public function string wf_get_character ();If KeyDown ( keyA! ) Then
	Return "A"
Elseif KeyDown ( keyB! ) Then
	Return "B"
Elseif KeyDown ( keyC! ) Then
	Return "C"
Elseif KeyDown ( keyD! ) Then
	Return "D"
Elseif KeyDown ( keyE! ) Then
	Return "E"
Elseif KeyDown ( keyF! ) Then
	Return "F"
Elseif KeyDown ( keyG! ) Then
	Return "G"
Elseif KeyDown ( keyH! ) Then
	Return "H"
Elseif KeyDown ( keyI! ) Then
	Return "I"
Elseif KeyDown ( keyJ! ) Then
	Return "J"
Elseif KeyDown ( keyK! ) Then
	Return "K"
Elseif KeyDown ( keyL! ) Then
	Return "L"
Elseif KeyDown ( keyM! ) Then
	Return "M"
Elseif KeyDown ( keyN! ) Then
	Return "N"
Elseif KeyDown ( keyO! ) Then
	Return "O"
Elseif KeyDown ( keyP! ) Then
	Return "P"
Elseif KeyDown ( keyQ! ) Then
	Return "Q"
Elseif KeyDown ( keyR! ) Then
	Return "R"
Elseif KeyDown ( keyS! ) Then
	Return "S"
Elseif KeyDown ( keyT! ) Then
	Return "T"
Elseif KeyDown ( keyU! ) Then
	Return "U"
Elseif KeyDown ( keyV! ) Then
	Return "V"
Elseif KeyDown ( keyW! ) Then
	Return "W"
Elseif KeyDown ( keyX! ) Then
	Return "X"
Elseif KeyDown ( keyY! ) Then
	Return "Y"
Elseif KeyDown ( keyZ! ) Then
	Return "Z"
Elseif KeyDown ( key0! ) Then
	Return "0"
Elseif KeyDown ( key1! ) Then
	Return "1"
Elseif KeyDown ( key2! ) Then
	Return "2"
Elseif KeyDown ( key3! ) Then
	Return "3"
Elseif KeyDown ( key4! ) Then
	Return "4"
Elseif KeyDown ( key5! ) Then
	Return "5"
Elseif KeyDown ( key6! ) Then
	Return "6"
Elseif KeyDown ( key7! ) Then
	Return "7"
Elseif KeyDown ( key8! ) Then
	Return "8"
Elseif KeyDown ( key9! ) Then
	Return "9"
Elseif KeyDown ( keyDash! ) Then
	Return "_"
Elseif KeyDown ( keyNumPad0! ) Then
	Return "0"
Elseif KeyDown ( keyNumPad1! ) Then
	Return "1"
Elseif KeyDown ( keyNumPad2! ) Then
	Return "2"
Elseif KeyDown ( keyNumPad3! ) Then
	Return "3"
Elseif KeyDown ( keyNumPad4! ) Then
	Return "4"
Elseif KeyDown ( keyNumPad5! ) Then
	Return "5"
Elseif KeyDown ( keyNumPad6! ) Then
	Return "6"
Elseif KeyDown ( keyNumPad7! ) Then
	Return "7"
Elseif KeyDown ( keyNumPad8! ) Then
	Return "8"
Elseif KeyDown ( keyNumPad9! ) Then
	Return "9"
End if

Return ""

end function

public function boolean wf_valid_key ();If KeyDown ( keyA! ) Or &
   KeyDown ( keyB! ) Or &
   KeyDown ( keyC! ) Or &
   KeyDown ( keyD! ) Or &
   KeyDown ( keyE! ) Or &
   KeyDown ( keyF! ) Or &
   KeyDown ( keyG! ) Or &
   KeyDown ( keyH! ) Or &
   KeyDown ( keyI! ) Or &
   KeyDown ( keyJ! ) Or &
   KeyDown ( keyK! ) Or &
   KeyDown ( keyL! ) Or &
   KeyDown ( keyM! ) Or &
   KeyDown ( keyN! ) Or &
   KeyDown ( keyO! ) Or &
   KeyDown ( keyP! ) Or &
   KeyDown ( keyQ! ) Or &
   KeyDown ( keyR! ) Or &
   KeyDown ( keyS! ) Or &
   KeyDown ( keyT! ) Or &
   KeyDown ( keyU! ) Or &
   KeyDown ( keyV! ) Or &
   KeyDown ( keyW! ) Or &
   KeyDown ( keyX! ) Or &
   KeyDown ( keyY! ) Or &
   KeyDown ( keyZ! ) Or &
   KeyDown ( key0! ) Or &
   KeyDown ( key1! ) Or &
   KeyDown ( key2! ) Or &
   KeyDown ( key3! ) Or &
   KeyDown ( key4! ) Or &
   KeyDown ( key5! ) Or &
   KeyDown ( key6! ) Or &
   KeyDown ( key7! ) Or &
   KeyDown ( key8! ) Or &
   KeyDown ( key9! ) Or &
   KeyDown ( keyDash! ) Or &
   KeyDown ( keyNumPad0! ) Or &
   KeyDown ( keyNumPad1! ) Or &
   KeyDown ( keyNumPad2! ) Or &
   KeyDown ( keyNumPad3! ) Or &
   KeyDown ( keyNumPad4! ) Or &
   KeyDown ( keyNumPad5! ) Or &
   KeyDown ( keyNumPad6! ) Or &
   KeyDown ( keyNumPad7! ) Or &
   KeyDown ( keyNumPad8! ) Or &
   KeyDown ( keyNumPad9! ) Then

	Return True

End if

Return False
end function

public function boolean wf_packaging (string part, string previous_type);wf_disable_screen ( )

String szPackageCode
String szTemp

Boolean bFoundIt

 DECLARE get_packaging CURSOR FOR  
  SELECT part_packaging.code  
    FROM part_packaging  
   WHERE part_packaging.part = :part
ORDER BY part_packaging.code ASC  ;

szTemp = ""
If ddlb_packaging.Text <> "" Then szTemp = ddlb_packaging.Text

ddlb_packaging.Reset ( )

Open get_packaging ;

FETCH get_packaging Into :szPackageCode ;

Do While SQLCA.SQLCode = 0
	ddlb_packaging.AddItem ( szPackageCode )
	FETCH get_packaging Into :szPackageCode ;
	If szPackageCode = previous_type then bFoundIt = True
Loop

Close get_packaging ;

wf_enable_screen ( )

If bFoundIt Then Return True

ddlb_packaging.Text = szTemp

Return False

end function

public subroutine wf_show_message ();bMessage = True
Timer ( .25, This )
end subroutine

public subroutine wf_hide_message ();sle_status.Hide ( )
Timer ( 0 )
bMessage = False
end subroutine

public function boolean wf_job_complete ();///*  Declare Variables  */
//String	cAllowZeroQty
//String	szNotes
//Int 		iRtnCode
//st_generic_structure	str_Parm
//
///*  Check all needed areas  */
//
//If ddlb_machines.Text = "" Then
//	f_beep ( 5 )
//	iRtnCode = MessageBox ( "Error", "A valid machine is required!  Would you like to use drop down list?", Question!, YesNo!, 1 )
//	If iRtnCode = 1 Then
//		bPopulateMachines = True
//		ddlb_machines.ShowList = True
//		wf_get_machines ( )
//	End if
//	ddlb_machines.SetFocus ( )
//	Return False
//End if
//
//If ddlb_parts.Text = "" Then
//	f_beep ( 5 )
//	MessageBox ( "Error", "A valid part number is required to continue!", StopSign! )
//	ddlb_parts.SetFocus ( )
//	//wf_set_focus ( )
//	Return False
//End if
//
//If bJCLotMode And bMandatoryLot And sle_lot.Text = "" Then
//	f_beep ( 5 )
//	MessageBox ( "Error", "A valid material lot number is required to continue!", StopSign! )
//	wf_set_focus ( )
//	Return False
//End if
//
//If ddlb_location_to.Text = "" Then
//	ddlb_location_to.Text = ddlb_machines.Text
//End if
//
//If szOperator = "" Then
//	f_beep ( 5 )
//	MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
//	wf_set_focus ( )
//	Return False
//End if
//
//If Dec ( sle_numberof.Text ) < 1 Then
//	f_beep ( 5 )
//	MessageBox ( "Error", "Number of objects must be greater than 0!", StopSign! )
//	wf_set_focus ( )
//	Return False
//End if
//
//SELECT inventory_parameters.jc_allow_zero_qty  
//  INTO :cAllowZeroQty  
//  FROM inventory_parameters  ;
//
//If cAllowZeroQty <> 'Y' And Dec ( sle_qty.Text ) <= 0 Then
//	f_beep ( 5 )
//	MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
//	wf_set_focus ( )
//	Return False
//End if
//
//If ddlb_unit.Text = "" Then
//	f_beep ( 5 )
//	MessageBox ( "Error", "A valid unit of measure is required to continue!", StopSign! )
//	wf_set_focus ( )
//	Return False
//End if
//
//
////
////  Declare Variables
////
//
//Time tTime
//
//Dec dQuantity, dWeight, dCost, dOnHand
//Dec dStdQuantity
//Dec dTare
//
//String szStatus, szLocationTo, szFromLoc, szPartNumber, szUnit
//String cQA
//String szPackageType
//String szPlant
//
//Long lSerial
//Long lNumberOfObjects
//
//Date dToday
//
//DateTime dDateStamp
//
//Str_progress stParm
//
//Int iCount, iTenTimes
//Int iLoop
//
//
//// 
////  Prime and open progress window
////
//
//stParm.Title = 'Job Completion'
//
//OpenWithParm ( w_progress, stParm )
//
//
////
////  Initialize variables
////
//
//iCount = 0
//tTime = Now ( )
//dQuantity = f_get_value ( Dec ( sle_qty.Text ) )
//dToday = Today ( )
//szLocationTo = f_get_string_value ( ddlb_location_to.Text )
//szPartNumber = f_get_string_value ( ddlb_parts.Text )
//szPackageType = f_get_string_value ( ddlb_packaging.Text )
//szFromLoc = f_get_string_value ( ddlb_machines.Text )
//dDateStamp = DateTime ( Today ( ), Now ( ) )
//szUnit = f_get_string_value ( ddlb_unit.Text )
//lNumberOfObjects = f_get_value ( Long ( sle_numberof.Text ) )
//If szLocationTo = "" Then szLocationTo = szFromLoc
//szNotes = mle_notes.Text
//
//SELECT location.plant  
//  INTO :szPlant  
//  FROM location  
// WHERE location.code = :szLocationTo   ;
//
//
//// grab tare weight from packaging table
//
//  SELECT package_materials.weight  
//    INTO :dTare  
//    FROM package_materials  
//   WHERE package_materials.code = :szPackageType   ;
//
//If SQLCA.SQLCOde <> 0 Then
//	dTare = 0
//End if
//
////
////  grab standard cost from part master
////
//
//SELECT part.quality_alert  
//  INTO :cQA  
//  FROM part  
// WHERE part.part = :szPartNumber   ;
//
//SELECT part_standard.cost  
//  INTO :dCost  
//  FROM part_standard
// WHERE part_standard.part = :szPartNumber   ;
//
//dCost = f_get_value ( dCost )
//cQA = f_get_string_value ( cQA )
//
//If cQA = 'Y' Then
//	szStatus = 'H'
//Else
//	szStatus = 'A'
//End if
//
//
////
////  grab weight from part master
////
//
//If f_get_value ( idec_ScaleWeight ) = 0 Then
//
//	SELECT part_inventory.unit_weight  
//	  INTO :dWeight  
//	  FROM part_inventory
//	 WHERE part_inventory.part = :szPartNumber   ;
//
//	dWeight = f_get_value ( dWeight )
//
//Else
//
//	dWeight = idec_ScaleWeight
//
//End if
//
//For lLoop = 1 to lNumberOfObjects
//
//	dDateStamp = DateTime ( Today ( ), Now ( ) )
//
//	Yield ( )
//
//	//
//	//  Grab next serial number and update parameter file
//	//
//	
//	//For iTenTimes = 1 to 10
//
//		OpenWithParm ( w_get_parm_value, "next_serial" ) 
//
//		lSerial = Message.DoubleParm
//	
//		iCount = iCount + 1
//		w_progress.wf_progress ( iCount / ( 4 * lNumberOfObjects ), "Creating Object..." )
//	
//	
//		//
//		//  Prime unit of measure structure and open conversion window
//		//
//	
//		dStdQuantity = f_get_value ( &
//			f_convert_units ( ddlb_unit.Text, "", szPartNumber, Dec ( sle_qty.Text ) ) )
//	
//	
//		//
//		//  Create object record
//		//
//	
//		INSERT INTO object
//		          ( serial,   
//			         part,   
//		   	      lot,   
//			         location,   
//			         last_date,   
//			         unit_measure,   
//			         operator,   
//			         status,   
//			         destination,   
//			         station,   
//			         origin,   
//			         cost,   
//			         weight,   
//			         parent_serial,   
//			         note,   
//			         po_number,   
//			         quantity,   
//			         last_time,   
//			         date_due,   
//			         customer,
//						package_type,
//						std_quantity,   
//			         sequence,
//						plant,
//						tare_weight )  
//			VALUES ( :lSerial,   
//		    	      :szPartNumber,   
//			         :sle_lot.Text,   
//			         :szLocationTo,   
//			         :dToday,   
//			         :szUnit,   
//			         :szOperator,   
//			         :szStatus,   
//			         null,   
//			         null,   
//			         null,   
//			         :dCost,   
//			         :dWeight,   
//			         null,   
//			         :szNotes,   
//			         null,   
//			         :dQuantity,   
//			         :tTime,   
//			         null,   
//			         null,
//						:szPackageType,
//						:dStdQuantity,   
//			         null,
//						:szPlant,
//						:dTare )  ;
//			
//		If SQLCA.SQLCode = -1 Then
//			RollBack ;
//			f_beep ( 5 )
//		Else
//			
//			iCount = iCount + 1
//			w_progress.wf_progress ( iCount / ( 4 * lNumberOfObjects ), "Updating On Hand..." )
//	
//	
//			//
//			//  update on hand
//			//
//	
//			dOnHand = f_update_onhand ( szPartNumber, dStdQuantity, "+*" )
//	
//			iCount = iCount + 1
//			w_progress.wf_progress ( iCount / ( 4 * lNumberOfObjects ), "Creating Audit Trail..." )
//	
//	
//			//
//			//  Create audit trail
//			//
//
//			If Not f_create_audit_trail ( lSerial, "J", "", String ( dCost ), ddlb_machines.Text, "Normal", szWorkOrder, String ( dOnHand ), "", "", "", "No Commit" ) Then
//
//				RollBack ;
//				f_beep ( 5 )
//
//			Else
//				iCount = iCount + 1
//				w_progress.wf_progress ( iCount / ( 4 * lNumberOfObjects ), "Printing Label..." )
//
//	
//				//
//				//  print label
//				//
//
//				Commit ;
//
//				f_beep ( 1 )
//				wf_show_message ( )
//				str_Parm.Value1 = String ( lSerial )
//				f_print_label ( str_Parm )
//
//				//iTenTimes = 10
//
//			End if
//
//		End if
//
//		//If w_progress.bCancel Then
//		//	iTenTimes = 10
//		//	lLoop = lNumberOfObjects
//		//End if
//
//	//Next 
//
//Next
//
//
//Close ( w_progress )
//
Return True
end function

public function boolean wf_material_issue ();//
//  Declare Variables
//

st_unit_conversion stParm
str_progress stProgressParm
st_generic_structure	str_Parm

Time tTime

Dec dQuantity, dWeight, dCost, dOnHand, dIssuedQty
Dec dConvertedObjectQty
Dec dNewObjectQty
Dec dStdQty
Dec dStdQuantity
Dec dObjectsQuantity

String 	szStatus, szLocationTo, szFromLoc
String 	szStockUnit
String 	szLot
String 	szLocationFrom
String 	szVendor
String 	szShipper
String 	szPlant
String 	szTempUnit
String	szCustom1
String	szCustom2
String	szCustom3
String	szCustom4
String	szCustom5
String	cSafetyPart
String	cCheck1
String	cCheck2
String	cCheck3
String	cCheck4
String	cCheck5
String	cCheckLot
String	szPartNumber
String	szMessage
String	szTemp

Boolean 	bChanged

Long lRow

Date dToday

DateTime dDateStamp

Int iCount
Int iLoop

//
//  Check all needed areas
//

Int iRtnCode

lSerial = f_get_value ( Long ( sle_serial.Text ) )

If ddlb_machines.Text = "" Then
	f_beep ( 5 )
	iRtnCode = MessageBox ( "Error", "A valid machine is required!  Would you like to use drop down list?", Question!, YesNo!, 1 )
	If iRtnCode = 1 Then
		bPopulateMachines = True
		ddlb_machines.ShowList = True
		wf_get_machines ( )
	End if
	bMachines = False
	ddlb_machines.SetFocus ( )
	Return False
End if

If szOperator = "" Then
	f_beep ( 5 )
	MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
	bOperator = False
	sle_operator.SetFocus ( )
	Return False
End if

If lSerial < 1 Or sle_serial.Text = "" Then
	f_beep ( 5 )
	MessageBox ( "Error", "A valid serial number is required to continue!", StopSign! )
	bSerialNumber = False
	sle_serial.SetFocus ( )
	Return False
End if

If ddlb_unit.Text = "" Then
	f_beep ( 5 )
	MessageBox ( "Error", "A valid unit of measure is required to continue!", StopSign! )
	bUnits = False	
	ddlb_unit.SetFocus ( )
	Return False
End if

If cIssueType = "U" And Dec ( sle_qty.Text ) <= 0 Then
	f_beep ( 5 )
	MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
	sle_qty.Text = ""
	bQty = False
	sle_qty.SetFocus ( )
	Return False
End if

dConvertedObjectQty = f_convert_units ( ddlb_unit.Text, dw_misc.GetItemString ( 1, "unit" ), dw_misc.GetItemString ( 1, "part" ), Dec ( sle_qty.Text ) )
dObjectsQuantity = f_get_value ( dw_misc.GetItemNumber ( 1, "quantity" ) )

If dConvertedObjectQty > dObjectsQuantity Then
	f_beep ( 5 )
	MessageBox ( "Error", "Quantity must be less than original object's quantity!", StopSign! )
	sle_qty.Text = ""
	bQty = False
	sle_qty.SetFocus ( )
	Return False
End if

/////////////////////////////////////////////////////////////////////
//  Check for lot control
//

SELECT part,
		 custom1,
		 custom2,
		 custom3,
		 custom4,
		 custom5,
		 lot
  INTO :szPartNumber,
		 :szCustom1,
		 :szCustom2,
		 :szCustom3,
		 :szCustom4,
		 :szCustom5,
		 :szLot
  FROM object  
 WHERE serial = :lSerial   ;

SELECT safety_part  
  INTO :cSafetyPart  
  FROM part_inventory
 WHERE part = :szPartNumber   ;

If cSafetyPart = 'Y' Then

	dw_transactions.SetTransObject ( sqlca )
	dw_transactions.Retrieve ( szPartNumber, ddlb_machines.Text )

	If dw_transactions.RowCount ( ) > 0 Then

	   SELECT shop_floor_check_u1,   
	          shop_floor_check_u2,   
	          shop_floor_check_u3,   
	          shop_floor_check_u4,   
	          shop_floor_check_u5,   
	          shop_floor_check_lot  
	     INTO :cCheck1,   
	          :cCheck2,   
	          :cCheck3,   
	          :cCheck4,   
	          :cCheck5,   
	          :cCheckLot  
	     FROM parameters  ;
	
		If cCheck1 = 'Y' Then
			szTemp = dw_transactions.GetItemString ( 1, "custom1" )
			If szCustom1 <> szTemp Then &
				bChanged = True
		End if
		If cCheck2 = 'Y' And Not bChanged Then
			If szCustom2 <> dw_transactions.GetItemString ( 1, "custom2" ) Then &
				bChanged = True
		End if
		If cCheck3 = 'Y' And Not bChanged Then
			If szCustom3 <> dw_transactions.GetItemString ( 1, "custom3" ) Then &
				bChanged = True
		End if
		If cCheck4 = 'Y' And Not bChanged Then
			If szCustom4 <> dw_transactions.GetItemString ( 1, "custom4" ) Then &
				bChanged = True
		End if
		If cCheck5 = 'Y' And Not bChanged Then
			If szCustom5 <> dw_transactions.GetItemString ( 1, "custom5" ) Then &
				bChanged = True
		End if
		If cCheckLot = 'Y' And Not bChanged Then
			If szLot <> dw_transactions.GetItemString ( 1, "lot" ) Then &
				bChanged = True
		End if

		If bChanged Then
			SELECT parameters.lot_control_message  
			  INTO :szMessage  
			  FROM parameters  ;
			MessageBox ( "Lot Control", szMessage, StopSign! )
		End if

	End if

End if

/////////////////////////////////////////////////////////////////////


//
//  Initialize variables
//

dw_object.SetTransObject ( sqlca )
dw_object.Retrieve ( lSerial )

tTime = Now ( )
dQuantity = Dec ( sle_qty.Text )
//dWeight = dw_object.GetItemNumber ( 1, "weight" )
dCost = dw_object.GetItemNumber ( 1, "cost" )
dToday = Today ( )
szLocationFrom = f_get_string_value ( dw_object.GetItemString ( 1, "location" ) )
szLocationTo   = ddlb_machines.Text
szPart = dw_misc.GetItemString ( 1, "part" )
dDateStamp = DateTime ( Today ( ), Now ( ) )
lSerial = Long ( sle_serial.Text )
iCount = 0

SELECT location.plant  
  INTO :szPlant  
  FROM location  
 WHERE location.code = :szLocationTo   ;


//
//  Make sure issued quantity is not greater 
//  than object qty.
//

SELECT part_inventory.material_issue_type  
  INTO :cIssueType  
  FROM part_inventory  
 WHERE part_inventory.part = :szPart   ;

If cIssueType = 'U' Then
	If dConvertedObjectQty <= 0 Then
		f_beep ( 5 )
		MessageBox ( "Error", "Invalid quantity!  Please enter a value greater than 0!", StopSign! )
		sle_qty.Text = ""
		bQty = False
		sle_qty.SetFocus ( )
		Return False
	ElseIf dConvertedObjectQty > dObjectsQuantity Then 
		f_beep ( 5 )
		MessageBox ( "Error", "You can not issue more than the object's quantity!", StopSign! )
		bQty = False
		sle_qty.SetFocus ( )
		Return False
	End if
	dIssuedQty = dConvertedObjectQty
	dNewObjectQty = dObjectsQuantity - dIssuedQty  
Elseif cIssueType = 'R' Then
	If dConvertedObjectQty < 0 Then
		f_beep ( 5 )
		MessageBox ( "Error", "Invalid quantity!  Please enter a value greater than or equal to 0!", StopSign! )
		sle_qty.Text = ""
		bQty = False
		sle_qty.SetFocus ( )
		Return False
	Elseif dConvertedObjectQty >= dObjectsQuantity Then
		f_beep ( 5 )
		MessageBox ( "Error", "Invalid quantity!  Quantity remaining must be less than the object's original quantity!", StopSign! )
		sle_qty.Text = ""
		bQty = False
		sle_qty.SetFocus ( )
		Return False
	End if
	dIssuedQty = dObjectsQuantity - dConvertedObjectQty  
	dNewObjectQty = Dec ( sle_qty.Text )
End if


stProgressParm.Title = 'Material Issue'

OpenWithParm ( w_progress, stProgressParm )


//
//  Grab Stock Unit from part master
//

SELECT part_inventory.standard_unit
  INTO :szStockUnit
  FROM part_inventory  
 WHERE part_inventory.part = :szPart   ;


//
//  Convert to Stock Unit
//

dStdQty = f_convert_units ( dw_misc.GetItemString ( 1, "unit" ), "", szPart, dIssuedQty )

iCount = iCount + 1
w_progress.wf_progress ( iCount / 4, "Updating On Hand..." )

dOnHand = f_update_onhand ( szPart, dStdQty, "-*" )

iCount = iCount + 1
w_progress.wf_progress ( iCount / 4, "Updating Object Quantity..." )

If dNewObjectQty > 0 Then

	If cIssueType = "U" Then
		szTempUnit = dw_misc.GetItemString ( 1, "unit" )
	Else
		szTempUnit = ddlb_unit.Text
	End if

	dStdQuantity = f_get_value ( &
		f_convert_units ( szTempUnit, "", szPart, dNewObjectQty ) )

  	UPDATE object
	   SET quantity = :dNewObjectQty,
			 std_quantity = :dStdQuantity,
			 last_date = :dDateStamp,
			 last_time = :dDateStamp,
			 operator  = :szOperator,
			 unit_measure = :szTempUnit
    WHERE serial = :lSerial   ;

Else

	bDelete = True

End if

If SQLCA.SQLCode = -1 Then
	RollBack ;
	Close ( w_progress )
	wf_enable_screen ( )
	f_beep ( 5 )
	Return False
Else
		

	iCount = iCount + 1
	w_progress.wf_progress ( iCount / 4, "Creating Audit Trail..." )

	//
	//  Convert Qty back to issued/left unit
	//

	dIssuedQty = f_convert_units ( dw_misc.GetItemString ( 1, "unit" ), ddlb_unit.Text, szPart, dIssuedQty )

	szPart  = f_get_string_value ( szPart )
	dIssuedQty = f_get_value ( dIssuedQty )
	dCost   = f_get_value ( dCost )
	sle_operator.Text = f_get_string_value ( sle_operator.Text )
	szOperator = sle_operator.Text
	dOnHand = f_get_value ( dOnHand )
	szLot = f_get_string_value ( dw_object.GetItemString ( 1, "lot" ) )
//	dWeight = f_get_value ( dWeight )
	szStatus = f_get_string_value ( szStatus )
	ddlb_unit.Text = f_get_string_value ( ddlb_unit.Text )

   SELECT audit_trail.vendor,   
          audit_trail.shipper  
     INTO :szVendor,   
          :szShipper  
     FROM audit_trail  
    WHERE ( audit_trail.serial = :lSerial ) AND  
          ( audit_trail.type = 'R' )   ;

	stTransParm.Value1 = is_Notes

	If Not f_create_audit_trail ( lSerial, "M", String ( dIssuedQty ), String ( dStdQty ), ddlb_unit.Text, ddlb_machines.Text, szVendor, szShipper, szPlant, szWorkOrder, szOperator, "No Commit" ) Then

		RollBack ;
		wf_enable_screen ( )
		f_beep ( 5 )

	Else

		If bDelete Then

			DELETE FROM object
			WHERE serial = :lSerial   ;
			sle_serial.Text = ""
			dw_object.Reset ( )
			dw_misc.Reset ( )
			bDelete = False

		End if

		Commit ;
		
		If dNewObjectQty > 0 Then
			iCount = iCount + 1
			w_progress.wf_progress ( iCount / 4, "Printing Label..." )
			str_Parm.Value1 = String ( lSerial )
			f_print_label ( str_Parm )
		Else
			iCount = iCount + 1
			w_progress.wf_progress ( iCount / 4, "No Label To Print..." )
		End if

		f_beep ( 1 )
		wf_show_message ( )

	End if

	Close ( w_progress )

End if

dw_misc.Retrieve ( lSerial )

wf_enable_screen ( )

Return True
end function

public function boolean wf_delete_audit_trail (long ll_serial);DELETE FROM audit_trail
 WHERE serial = :ll_Serial   ;

If SQLCA.SQLCode <> 0 Then
	Return False
Else
	Return True
End if


end function

public function boolean wf_create_object (long ll_serial, datetime ldt_date, string ls_operator);// Declare Variables

String	ls_type
String	ls_part
String	ls_remarks
String	ls_salesman
String	ls_customer
String	ls_vendor
String	ls_po
String	ls_from
String	ls_to
String	ls_lot
String	ls_status
String	ls_flag
String	ls_activity
String	ls_unit
String	ls_workorder
String	ls_controlnumber
String	ls_custom1
String	ls_custom2
String	ls_custom3
String	ls_custom4
String	ls_custom5
String	ls_plant
String	ls_notes
String	ls_glaccount
String	ls_package_type
Long		ll_invoicenumber
Dec		ld_cost
Dec		ld_onhand
Dec		ld_weight
Dec		ld_quantity
Dec		ld_price
Dec		ld_std_qty
Dec		ld_tare_weight
Dec		ldec_std_cost
Date		ld_today
Time		lt_now
DateTime	dDateStamp

//  Grab audit trail record

SELECT type,   
       part,   
       quantity,   
       remarks,   
       price,   
       salesman,   
       customer,   
       vendor,   
       po_number,   
       operator,   
       from_loc,   
       to_loc,   
       on_hand,   
       lot,   
       weight,   
       status,   
       flag,   
       activity,   
       unit,   
       workorder,   
       std_quantity,   
       cost,   
       control_number,   
       custom1,   
       custom2,   
       custom3,   
       custom4,   
       custom5,   
       plant,   
       invoice_number,   
       notes,   
       gl_account,
		 package_type,
		 std_cost
  INTO :ls_type,   
       :ls_part,   
       :ld_quantity,   
       :ls_remarks,   
       :ld_price,   
       :ls_salesman,   
       :ls_customer,   
       :ls_vendor,   
       :ls_po,   
       :ls_operator,   
       :ls_from,   
       :ls_to,   
       :ld_onhand,   
       :ls_lot,   
       :ld_weight,   
       :ls_status,   
       :ls_flag,   
       :ls_activity,   
       :ls_unit,   
       :ls_workorder,   
       :ld_quantity,   
       :ld_cost,   
       :ls_controlnumber,   
       :ls_custom1,   
       :ls_custom2,   
       :ls_custom3,   
       :ls_custom4,   
       :ls_custom5,   
       :ls_plant,   
       :ll_invoicenumber,   
       :ls_notes,   
       :ls_glaccount,
		 :ls_package_type,
		 :ldec_std_cost  
  FROM audit_trail  
 WHERE ( audit_trail.serial = :ll_Serial ) AND  
       ( audit_trail.date_stamp = :ldt_Date ) AND
		 ( audit_trail.type = 'M' ) ;


//  Error checking

If SQLCA.SQLCode <> 0 Then

	MessageBox ( "Error", "Unable to open audit trail history!", StopSign! )
	Return	False

Else

	//  Prime needed values

	ld_today = Today ( )
	lt_now	= Now ( )
	dDateStamp = DateTime(Today(),Now())

//	SELECT package_materials.weight  
//	  INTO :ld_tare_weight  
//	  FROM package_materials  
//	 WHERE package_materials.code = :ls_package_type   ;
//
//	ld_tare_weight = f_get_value ( ld_tare_weight )

	ld_std_qty = f_convert_units ( ls_unit, "", ls_part, ld_quantity )

	//  Add object

	INSERT INTO object  
	          ( serial,   
	            part,   
	            location,   
	            last_date,   
	            unit_measure,   
	            operator,   
	            status,   
	            destination,   
	            station,   
	            origin,   
	            cost,   
  	            weight,   
	            parent_serial,   
	            note,   
	            quantity,   
	            last_time,   
	            date_due,   
	            customer,   
	            sequence,   
	            shipper,   
	            lot,   
	            type,   
	            po_number,   
	            name,   
	            plant,   
	            start_date,   
	            std_quantity,   
	            package_type,   
	            field1,   
	            field2,   
	            custom1,   
	            custom2,   
	            custom3,   
	            custom4,   
	            custom5,   
	            show_on_shipper,   
 	            tare_weight,
					std_cost )  
	   VALUES ( :ll_serial,   
	            :ls_part,   
	            :ls_to,   
	            :dDateStamp,   
	            :ls_unit,   
	            :ls_operator,   
	            :ls_status,   
	            null,   
	            null,   
	            null,   
	            :ld_cost,   
	            :ld_weight,   
	            null,   
 	            :ls_notes,   
 	            :ld_quantity,   
	            :dDateStamp,   
	            null,   
	            :ls_customer,   
	            null,   
	            null,   
	            :ls_lot,   
	            null,   
	            :ls_po,   
	            null,   
	            :ls_plant,   
	            null,   
	            :ld_std_qty,   
	            :ls_package_type,   
 	            null,   
	            null,   
	            :ls_custom1,   
	            :ls_custom2,   
	            :ls_custom3,   
	            :ls_custom4,   
	            :ls_custom5,   
	            null,   
	            :ld_tare_weight,
					:ldec_std_cost )  ;
	 	
	If SQLCA.SQLCode <> 0 Then
		
		MessageBox ( "Error", "Unable to create object:~r" + SQLCA.SQLErrText, StopSign! )
		Return	False

	End if

End if

Return True
end function

public subroutine wf_operator_attrib (boolean bmode);If bMode Then
	bUserOperator = True
	cb_operator.Show ( )
	cb_operator_ok.Show ( )
	cb_operator_cancel.Show ( )
	st_operator_title.Show ( )
	sle_operator_password.Text = ""
	sle_operator_password.Show ( )
	sle_operator_code.Text = ""
	sle_operator_code.Show ( )
	sle_operator_password.SetFocus ( )
Else
	bUserOperator = False
	cb_operator_ok.Hide ( )
	cb_operator_cancel.Hide ( )
	st_operator_title.Hide ( )
	sle_operator_password.Hide ( )
	sle_operator_code.Hide ( )
	cb_operator.Hide ( )
End if
end subroutine

public function boolean wf_update_onhand (long ll_serial, string ls_mode);String	ls_Part
Dec		ld_Std_qty

  SELECT object.part,   
         object.std_quantity
    INTO :ls_Part,   
         :ld_Std_qty  
    FROM object  
   WHERE object.serial = :ll_Serial   ;

f_update_onhand ( ls_Part, ld_Std_qty, ls_mode + "*" )

Return True
end function

public function boolean wf_breakout ();SetPointer ( HourGlass! )

//  Declare Variables
str_progress stProgress
st_generic_structure str_Parm

String szObjectUnit
String szStandardUnit
String szVendor
String szShipper
String szPlant
String szNewPackage
String szNotes

Dec dObjectQty
Dec dStdQuantity
Dec dConvObjectQty
Dec dLowestQty
Dec dCost
Dec dNewQty
Dec dStdObjectQty
Dec dNewStdQty
Dec dTareWeight

Time tLastTime

Date dLastDate

DateTime dtRightNow

Long lSerialCheck
Long lParentSerial
Long lSuffix
long	l_l_serial[]
long ll_serial

Boolean bProgress
Boolean bNoChange

Int iCount
Int iCounter
Int iLoop

//  Check required fields
If szOperator = "" Then
	f_beep ( 5 )
	MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
	bOpen = True
	bOperator = False
	sle_operator.SetFocus ( )
	Return False
End if

If sle_serial.Text = "" Then
	f_beep ( 5 )
	MessageBox ( "Error", "Invalid serial number!", StopSign! )
	bSerialNumber = False
	sle_serial.SetFocus ( )
	Return False
End if

If Dec ( sle_numberof.Text ) < 1 Then
	f_beep ( 5 )
	MessageBox ( "Error", "Number of objects must be greater than 0!", StopSign! )
	sle_numberof.Text = ""
	bNumberOf = False
	szField = "numberof"
	wf_set_focus ( )
	Return False
End if

If Dec ( sle_qty.Text ) <= 0 Then
	f_beep ( 5 )
	MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
	sle_qty.Text = ""
	bQty = False
	szField = "qty"
	wf_set_focus ( )
	Return False
End if

If ddlb_unit.Text = "" Then
	f_beep ( 5 )
	MessageBox ( "Error", "A valid unit of measure is required to continue!", StopSign! )
	bUnits = True
	ddlb_unit.SetFocus ( )
	Return False
End if

//  Convert to object's quantity
SetPointer ( HourGlass! )

szPart = dw_misc.GetItemString ( 1, "part" )

dConvObjectQty = f_get_value ( &
	f_convert_units ( ddlb_unit.Text, dw_misc.GetItemString ( 1, "unit" ), szPart, Dec ( sle_qty.Text ) ) )

SetPointer ( HourGlass! )

//  Convert to standard unit
dLowestQty = f_get_value ( &
	f_convert_units ( ddlb_unit.Text, "", szPart, Dec ( sle_qty.Text ) ) )

SetPointer ( HourGlass! )

//  Check to see if they are trying to break out more than the object
If ( dConvObjectQty * f_get_value ( Dec ( sle_numberof.Text ) ) ) > f_get_value ( dw_misc.GetItemNumber ( 1, "quantity" ) ) Then
	f_beep ( 5 )
	MessageBox ( "Error", "You can not breakout more than the original objects quantity!", StopSign! )
	sle_numberof.Text = ""
	sle_qty.Text = ""
	bNumberOf = False
	szField = "numberof"
	wf_set_focus ( )
	Return False
End if


lParentSerial = f_get_value ( Long ( sle_serial.Text ) )
dQuantity = f_get_value ( Dec ( sle_qty.Text ) )
szNotes = is_Notes

//  Prime and show progress window

stProgress.Title = 'Break Out Objects'

bProgress = True

OpenWithParm ( w_progress, stProgress )

iCount = 0
iCounter = 0

//  Create new objects and update original object
dw_object.SetTransObject ( sqlca )

iCount++

For lLoop = 1 to Dec ( sle_numberof.Text )

	//  Get Time Stamp

	tLastTime = Now ( )
	dLastDate = Today ( )
	dtRightNow = DateTime(Today(),Now())
	Yield ( )

	//  Grab next serial number and update parameter file

	iCounter++
	w_progress.wf_progress ( iCounter / ( Dec ( sle_numberof.Text ) * 4 ), "Updating Parm File..." )

	dw_object.SetTransObject ( sqlca )

	dw_object.Retrieve ( lParentSerial )

	szPart = f_get_string_value ( dw_object.GetItemString ( 1, "part" ) )
	szLot  = f_get_string_value ( dw_object.GetItemString ( 1, "lot" ) )
	szStatus = f_get_string_value ( dw_object.GetItemString ( 1, "status" ) )
	szPoNumber = f_get_string_value ( dw_object.GetItemString ( 1, "po_number" ) )
	szLocation = f_get_string_value ( dw_object.GetItemString ( 1, "location" ) )
//	dWeight    = f_get_value ( dw_object.GetItemNumber ( 1, "weight" ) )
	dCost      = f_get_value ( dw_object.GetItemNumber ( 1, "cost" ) )
	dStdObjectQty = f_get_value ( dw_object.GetItemNumber ( 1, "std_quantity" ) )
	szPlant = f_get_string_value ( dw_object.GetItemString ( 1, "plant" ) )	
	dStdQuantity = f_convert_units ( ddlb_unit.Text, "", szPart, dQuantity )
	szNewPackage = f_get_string_value ( ddlb_packaging.Text )
	lSuffix			= f_get_value ( dw_object.GetItemNumber ( 1, "suffix" ) )

//   SELECT package_materials.weight 
//     INTO :dTareWeight  
//     FROM package_materials  
//    WHERE package_materials.code = :szNewPackage   ;

	if SQLCA.of_getnextparmvalue ( 'next_serial',ll_serial ) then 
	
		l_l_serial[UpperBound ( l_l_serial ) + 1] = ll_serial
		
		iCounter++
		w_progress.wf_progress ( iCounter / ( Dec ( sle_numberof.Text ) * 4 ), "Breaking Out Object # " + String ( l_l_serial[lLoop] ) )
	
		//  Create object record
		szObjectUnit = f_get_string_value ( ddlb_unit.Text )

		INSERT INTO object  
			( serial,   
			part,   
			location,   
			last_date,   
			unit_measure,   
			operator,   
			status,   
			destination,   
			station,   
			origin,   
			cost,   
			weight,   
			parent_serial,   
			note,   
			quantity,   
			last_time,   
			date_due,   
			customer,   
			sequence,   
			shipper,   
			lot,   
			type,   
			po_number,   
			name,   
			plant,   
			start_date,
			std_quantity,
			package_type,
			tare_weight,
			suffix )  
		VALUES ( :l_l_serial[lLoop],   
			:szPart,   
			:szLocation,   
			:dLastDate,   
			:szObjectUnit,   
			:szOperator,   
			:szStatus,   
			null,   
			null,   
			null,   
			:dCost,   
			:dWeight,   
			null,   
			:szNotes,   
			:dQuantity,   
			:tLastTime,   
			null,   
			null,   
			null,   
			null,   
			:szLot,   
			null,   
			:szPoNumber,   
			null,   
			:szPlant,   
			null,
			:dStdQuantity,
			:szNewPackage,
			:dTareWeight,
			:lSuffix )  ;

		If SQLCA.SQLCode = -1 Then
	
			RollBack ;
			f_beep ( 5 )
	
		Else
	
			iCounter++
			w_progress.wf_progress ( iCounter / ( Dec ( sle_numberof.Text ) * 4 ), "Creating Audit Trail..." )
		
			SELECT	audit_trail.vendor,   
				audit_trail.shipper  
			INTO	:szVendor,   
				:szShipper  
			FROM	audit_trail  
			WHERE	( audit_trail.serial = :lParentSerial ) AND  
				( audit_trail.type = 'R' )   ;
	
			If SQLCA.SQLCode <> 0 Then
				szVendor = ""
				szShipper = ""
			End if
	
			If Not f_create_audit_trail ( l_l_serial[lLoop], "B", String ( lParentSerial ), szVendor, szShipper, "", "", "", "", "", "", "No Commit" ) Then
	
				RollBack ;
				f_beep ( 5 )
	
			Else
				//  Calculate object's new quantity

				dObjectQty = f_convert_units ( ddlb_unit.Text, dw_misc.GetItemString ( 1, "unit" ), szPart, dQuantity ) 
	
				dNewQty = dw_misc.GetItemNumber ( 1, "quantity" ) - dObjectQty
	
	
				//  If new quantity is greater than 0, update object
				iCounter++
				w_progress.wf_progress ( iCounter / ( Dec ( sle_numberof.Text ) * 4 ), "Updating Object # " + String ( lParentSerial ) )
	
				dNewStdQty = dStdObjectQty - dStdQuantity
					
				UPDATE object  
				SET quantity = :dNewQty,
						 std_quantity = :dNewStdQty,
						 last_date = :dLastDate,
						 last_time = :tLastTime,
						 operator = :szOperator
				 WHERE serial = :lParentSerial   ;
	
				If SQLCA.SQLCode = -1 Then
	
					RollBack ;
					f_beep ( 5 )
	
				Else
					Commit ;
					dw_misc.SetItem ( 1, "quantity", dNewQty )
					str_Parm.Value1 = String ( l_l_serial[lLoop] )
					f_print_label ( str_Parm )
	
				End if
	
			End if
	
		End if
	else
		rollback;
	end if 
	If bCancel = True Then
		iCount = Dec ( sle_numberof.Text ) + 1
		bCancel = False
	End if
Next

//  Label printing for original serial, if it's quantity is greater than 0
If dNewQty > 0 Then 

	If Not f_create_audit_trail ( lParentSerial, "B", "", szVendor, szShipper, "Original", "", "", "", "", "", "No Commit" ) Then
		RollBack ;
		f_beep ( 5 )
		Close ( w_progress )
		Goto THE_END
	Else
		Commit ;
		str_Parm.Value1 = String ( lParentSerial )
		f_print_label ( str_Parm )

	End if

Else

	If Not f_create_audit_trail ( lParentSerial, "B", "", szVendor, szShipper, "Original", "", "", "", "", "", "No Commit" ) Then
		RollBack ;
		f_beep ( 5 )
		Close ( w_progress )
		Goto THE_END
	Else

		DELETE FROM object
		WHERE serial = :lParentSerial   ;

		If SQLCA.SQLCode <> 0 Then
			RollBack ;
			f_beep ( 5 )
			Close ( w_progress )
			Goto THE_END
		Else
			Commit ;
		End if

	End if

End if

Close ( w_progress )

f_beep ( 1 )
wf_show_message ( )

THE_END:

bProgress = False

If Not bNoChange Then 
	sle_numberof.Text = ''
	sle_qty.Text = ''
End if

wf_enable_screen ( )

Return True
end function

public function boolean wf_delete_object (long ll_serial);DELETE FROM object  
 WHERE serial = :ll_Serial   ;

If SQLCA.SQLCode <> 0 Then
	Return False
End if

Return True
end function

public function boolean wf_add_to_object (long ll_serial, decimal ld_qty, decimal ld_stdqty, decimal ld_objectqty, decimal ld_objectstdqty, string ls_operator);ld_ObjectQty = ld_ObjectQty + ld_Qty
ld_ObjectStdQty = ld_ObjectStdQty + ld_StdQty

UPDATE object  
   SET quantity 		= :ld_ObjectQty,   
       std_quantity 	= :ld_ObjectStdQty,
		 operator		= :ls_Operator
 WHERE serial = :ll_Serial   ;

If SQLCA.SQLCode <> 0 Then
	Return False
End if
 

Return True
end function

public subroutine wf_check_for_scale ();String	s_ScaleAttached

If Trim ( f_get_string_value ( ddlb_parts.Text ) ) = "" Or &
	Trim ( f_get_string_value ( ddlb_packaging.Text ) ) = "" Then Return

SELECT part_packaging.scale_interface
  INTO :s_ScaleAttached   
  FROM part_packaging  
 WHERE ( part_packaging.part = :ddlb_parts.Text ) AND  
       ( part_packaging.code = :ddlb_packaging.Text )   ;

If SQLCA.SQLCode = 0 Then
	If s_ScaleAttached = 'Y' Then ib_PopupScaleInterface = TRUE
End if
end subroutine

public subroutine wf_popup_scale ();//st_scale		str_Parm
//
//str_Parm.Machine			= ddlb_machines.Text
//str_Parm.Part				= ddlb_Parts.Text
//str_Parm.Package_Type	= ddlb_Packaging.Text
//
//ib_ScaleOpen = TRUE
//
//OpenUserObjectWithParm ( uo_scale_interface, str_Parm, 700, 600 )
//uo_scale_interface.BringToTop = TRUE
end subroutine

public subroutine wf_disable_except_buttons ();cb_42.Enabled = False
cb_44.Enabled = False
cb_46.Enabled = False
cb_47.Enabled = False
cb_48.Enabled = False
cb_38.Enabled = False
sle_operator.Enabled = False
dw_misc.Enabled = False
ddlb_location_to.Enabled = False
sle_serial.Enabled = False
ddlb_machines.Enabled = False
ddlb_parts.Enabled = False
sle_qty.Enabled = False
ddlb_unit.Enabled = False
sle_lot.Enabled = False
ddlb_packaging.Enabled = False
sle_numberof.Enabled = False

end subroutine

public subroutine wf_enable_except_buttons ();cb_42.Enabled = TRUE
cb_44.Enabled = TRUE
IF stParm.Value1 = "BreakOut" OR stParm.Value1 = "Material Issue" THEN &
	cb_46.Enabled = TRUE
cb_47.Enabled = TRUE
cb_48.Enabled = TRUE
cb_38.Enabled = TRUE
sle_operator.Enabled = TRUE
dw_misc.Enabled = TRUE
ddlb_location_to.Enabled = TRUE
sle_serial.Enabled = TRUE
ddlb_machines.Enabled = TRUE
ddlb_parts.Enabled = TRUE
sle_qty.Enabled = TRUE
ddlb_unit.Enabled = TRUE
sle_lot.Enabled = TRUE
ddlb_packaging.Enabled = TRUE
sle_numberof.Enabled = TRUE

end subroutine

on key;If bNoKey Or bUserOperator Or bUserNotes Or bAuditTrail Then Return

/*  Declare Variables  */
DropDownListBox ddlbCurrentObject
String szLeft, szRight

If bMessage Then wf_hide_message ( )


IF ib_Password OR bAuditTrail OR ib_Notes THEN RETURN

/*  Main  */
If KeyDown ( keyEnter! ) And Not KeyDown ( keyTab! ) And &
	( stParm.Value1 = "Transfer" Or stParm.Value1 = "Quality Control" ) And &
	bSerialNumber Then
	sle_serial.TriggerEvent ( "button_clicked" )

Elseif bMachines Or bParts Or bLocationTo Or bPackaging Then

	If ( bMachines And bPopulateMachines ) Or ( bParts And bPopulateParts ) &
		Or ( bLocationTo And bPopulateLocations ) Then

		If Not IsNull ( GetFocus ( ) ) Then &
			ddlbCurrentObject = GetFocus ( )

		If wf_valid_key ( ) Then

			cCharacterTouched = wf_get_character ( )
	
			Timer ( .055, This )

		Elseif KeyDown ( keyBack! ) Then

			ddlbCurrentObject.Text = Left ( ddlbCurrentObject.Text, Len ( ddlbCurrentObject.Text ) - 1 )
			szRealityText = Left ( szRealityText, len ( szRealityText ) - 1 )
			cCharacterTouched = ""
			Timer ( .055, This )

		Elseif KeyDown ( keyDelete! ) Then

			ddlbCurrentObject.Text = Right ( ddlbCurrentObject.Text, Len ( ddlbCurrentObject.Text ) - 1 )
			szRealityText = Right ( szRealityText, len ( szRealityText ) - 1 )
			cCharacterTouched = ""
			Timer ( .055, This )
	
		End if

	End if

Elseif KeyDown ( keyTab! ) Then

	bTab = True

End if

end on

on open;/*  Initialize Variables  */

bChars = True
bNumbers = True

stParm        = Message.PowerObjectParm

lSerialParm   = Long ( stParm.Value2 )
If stParm.Value2 = "0" Then stParm.Value2 = ""
szWorkOrder   = stParm.Value5

dtToday = DateTime ( Today ( ), Now ( ) )

sle_Title.Text = stParm.Value1

/*  Determine type of transaction and prime the dataobject of dw_1  */

dw_unit_list.SetTransObject ( sqlca )

dw_limit_locs.SetTransObject ( sqlca )
dw_limit_locs.Retrieve ( Left ( stParm.Value1, 1 ) )

wf_setup_screen ( )


end on

on timer;//If ib_ScaleOpen Then
//	uo_scale_interface.uf_read_weight ( )
//	Return
//End if

If bMessage Then
	If sle_status.Visible = True Then
		sle_status.Visible = False
	Else
		sle_status.Visible = True
	End if
	Return
End if


/*  Declare Variables  */
DropDownListBox ddlbCurrentObject

/*  main  */
ddlbCurrentObject = GetFocus ( )
szRealityText = szRealityText + cCharacterTouched
iddlbIndex = ddlbCurrentObject.FindItem ( szRealityText, 1 )
iddlbIndex = ddlbCurrentObject.SelectItem ( iddlbIndex )
szSelectedText = ddlbCurrentObject.SelectedText ( )
ddlbCurrentObject.Text = szRealityText

Timer ( 0, This )


end on

on w_touch_screen_generic_trans.create
this.rb_2=create rb_2
this.cb_at_enter=create cb_at_enter
this.cb_52=create cb_52
this.st_2=create st_2
this.em_1=create em_1
this.p_trash=create p_trash
this.dw_transactions=create dw_transactions
this.lb_1=create lb_1
this.sle_status=create sle_status
this.st_1=create st_1
this.cb_57=create cb_57
this.lb_unit_list=create lb_unit_list
this.dw_unit_list=create dw_unit_list
this.cb_55=create cb_55
this.cb_51=create cb_51
this.dw_new_object=create dw_new_object
this.ddlb_unit=create ddlb_unit
this.sle_numberof=create sle_numberof
this.sle_qty=create sle_qty
this.cb_48=create cb_48
this.cb_49=create cb_49
this.dw_object=create dw_object
this.rb_1=create rb_1
this.sle_lot=create sle_lot
this.ddlb_parts=create ddlb_parts
this.sle_operator=create sle_operator
this.sle_serial=create sle_serial
this.cb_47=create cb_47
this.cb_46=create cb_46
this.cb_45=create cb_45
this.cb_44=create cb_44
this.cb_42=create cb_42
this.dw_1=create dw_1
this.cb_41=create cb_41
this.cb_43=create cb_43
this.cb_40=create cb_40
this.cb_39=create cb_39
this.cb_38=create cb_38
this.cb_37=create cb_37
this.cb_36=create cb_36
this.cb_35=create cb_35
this.cb_34=create cb_34
this.cb_33=create cb_33
this.cb_32=create cb_32
this.cb_31=create cb_31
this.cb_30=create cb_30
this.cb_29=create cb_29
this.cb_28=create cb_28
this.cb_27=create cb_27
this.cb_26=create cb_26
this.cb_25=create cb_25
this.cb_24=create cb_24
this.cb_23=create cb_23
this.cb_22=create cb_22
this.cb_21=create cb_21
this.cb_20=create cb_20
this.cb_19=create cb_19
this.cb_18=create cb_18
this.cb_17=create cb_17
this.cb_16=create cb_16
this.cb_15=create cb_15
this.cb_14=create cb_14
this.cb_13=create cb_13
this.cb_12=create cb_12
this.cb_11=create cb_11
this.cb_10=create cb_10
this.cb_9=create cb_9
this.cb_8=create cb_8
this.cb_7=create cb_7
this.cb_6=create cb_6
this.cb_5=create cb_5
this.cb_4=create cb_4
this.cb_3=create cb_3
this.cb_2=create cb_2
this.cb_1=create cb_1
this.dw_audit_trail=create dw_audit_trail
this.sle_title=create sle_title
this.cb_audit_popup=create cb_audit_popup
this.gb_qty=create gb_qty
this.gb_serial_number=create gb_serial_number
this.gb_unit=create gb_unit
this.gb_operator=create gb_operator
this.gb_machine=create gb_machine
this.gb_numberof=create gb_numberof
this.gb_parts=create gb_parts
this.gb_lot=create gb_lot
this.gb_location_from=create gb_location_from
this.gb_location_to=create gb_location_to
this.gb_packaging=create gb_packaging
this.ddlb_machines=create ddlb_machines
this.gb_new_object=create gb_new_object
this.sle_combine_serial=create sle_combine_serial
this.cb_operator_ok=create cb_operator_ok
this.cb_operator_cancel=create cb_operator_cancel
this.ddlb_packaging=create ddlb_packaging
this.ddlb_location_to=create ddlb_location_to
this.mle_qc_notes=create mle_qc_notes
this.sle_1=create sle_1
this.gb_qc_notes=create gb_qc_notes
this.sle_operator_code=create sle_operator_code
this.sle_operator_password=create sle_operator_password
this.dw_limit_locs=create dw_limit_locs
this.st_operator_title=create st_operator_title
this.cb_operator=create cb_operator
this.dw_current_object=create dw_current_object
this.gb_current_object=create gb_current_object
this.cb_50=create cb_50
this.gb_dwbox=create gb_dwbox
this.lb_2=create lb_2
this.dw_misc=create dw_misc
this.Control[]={this.rb_2,&
this.cb_at_enter,&
this.cb_52,&
this.st_2,&
this.em_1,&
this.p_trash,&
this.dw_transactions,&
this.lb_1,&
this.sle_status,&
this.st_1,&
this.cb_57,&
this.lb_unit_list,&
this.dw_unit_list,&
this.cb_55,&
this.cb_51,&
this.dw_new_object,&
this.ddlb_unit,&
this.sle_numberof,&
this.sle_qty,&
this.cb_48,&
this.cb_49,&
this.dw_object,&
this.rb_1,&
this.sle_lot,&
this.ddlb_parts,&
this.sle_operator,&
this.sle_serial,&
this.cb_47,&
this.cb_46,&
this.cb_45,&
this.cb_44,&
this.cb_42,&
this.dw_1,&
this.cb_41,&
this.cb_43,&
this.cb_40,&
this.cb_39,&
this.cb_38,&
this.cb_37,&
this.cb_36,&
this.cb_35,&
this.cb_34,&
this.cb_33,&
this.cb_32,&
this.cb_31,&
this.cb_30,&
this.cb_29,&
this.cb_28,&
this.cb_27,&
this.cb_26,&
this.cb_25,&
this.cb_24,&
this.cb_23,&
this.cb_22,&
this.cb_21,&
this.cb_20,&
this.cb_19,&
this.cb_18,&
this.cb_17,&
this.cb_16,&
this.cb_15,&
this.cb_14,&
this.cb_13,&
this.cb_12,&
this.cb_11,&
this.cb_10,&
this.cb_9,&
this.cb_8,&
this.cb_7,&
this.cb_6,&
this.cb_5,&
this.cb_4,&
this.cb_3,&
this.cb_2,&
this.cb_1,&
this.dw_audit_trail,&
this.sle_title,&
this.cb_audit_popup,&
this.gb_qty,&
this.gb_serial_number,&
this.gb_unit,&
this.gb_operator,&
this.gb_machine,&
this.gb_numberof,&
this.gb_parts,&
this.gb_lot,&
this.gb_location_from,&
this.gb_location_to,&
this.gb_packaging,&
this.ddlb_machines,&
this.gb_new_object,&
this.sle_combine_serial,&
this.cb_operator_ok,&
this.cb_operator_cancel,&
this.ddlb_packaging,&
this.ddlb_location_to,&
this.mle_qc_notes,&
this.sle_1,&
this.gb_qc_notes,&
this.sle_operator_code,&
this.sle_operator_password,&
this.dw_limit_locs,&
this.st_operator_title,&
this.cb_operator,&
this.dw_current_object,&
this.gb_current_object,&
this.cb_50,&
this.gb_dwbox,&
this.lb_2,&
this.dw_misc}
end on

on w_touch_screen_generic_trans.destroy
destroy(this.rb_2)
destroy(this.cb_at_enter)
destroy(this.cb_52)
destroy(this.st_2)
destroy(this.em_1)
destroy(this.p_trash)
destroy(this.dw_transactions)
destroy(this.lb_1)
destroy(this.sle_status)
destroy(this.st_1)
destroy(this.cb_57)
destroy(this.lb_unit_list)
destroy(this.dw_unit_list)
destroy(this.cb_55)
destroy(this.cb_51)
destroy(this.dw_new_object)
destroy(this.ddlb_unit)
destroy(this.sle_numberof)
destroy(this.sle_qty)
destroy(this.cb_48)
destroy(this.cb_49)
destroy(this.dw_object)
destroy(this.rb_1)
destroy(this.sle_lot)
destroy(this.ddlb_parts)
destroy(this.sle_operator)
destroy(this.sle_serial)
destroy(this.cb_47)
destroy(this.cb_46)
destroy(this.cb_45)
destroy(this.cb_44)
destroy(this.cb_42)
destroy(this.dw_1)
destroy(this.cb_41)
destroy(this.cb_43)
destroy(this.cb_40)
destroy(this.cb_39)
destroy(this.cb_38)
destroy(this.cb_37)
destroy(this.cb_36)
destroy(this.cb_35)
destroy(this.cb_34)
destroy(this.cb_33)
destroy(this.cb_32)
destroy(this.cb_31)
destroy(this.cb_30)
destroy(this.cb_29)
destroy(this.cb_28)
destroy(this.cb_27)
destroy(this.cb_26)
destroy(this.cb_25)
destroy(this.cb_24)
destroy(this.cb_23)
destroy(this.cb_22)
destroy(this.cb_21)
destroy(this.cb_20)
destroy(this.cb_19)
destroy(this.cb_18)
destroy(this.cb_17)
destroy(this.cb_16)
destroy(this.cb_15)
destroy(this.cb_14)
destroy(this.cb_13)
destroy(this.cb_12)
destroy(this.cb_11)
destroy(this.cb_10)
destroy(this.cb_9)
destroy(this.cb_8)
destroy(this.cb_7)
destroy(this.cb_6)
destroy(this.cb_5)
destroy(this.cb_4)
destroy(this.cb_3)
destroy(this.cb_2)
destroy(this.cb_1)
destroy(this.dw_audit_trail)
destroy(this.sle_title)
destroy(this.cb_audit_popup)
destroy(this.gb_qty)
destroy(this.gb_serial_number)
destroy(this.gb_unit)
destroy(this.gb_operator)
destroy(this.gb_machine)
destroy(this.gb_numberof)
destroy(this.gb_parts)
destroy(this.gb_lot)
destroy(this.gb_location_from)
destroy(this.gb_location_to)
destroy(this.gb_packaging)
destroy(this.ddlb_machines)
destroy(this.gb_new_object)
destroy(this.sle_combine_serial)
destroy(this.cb_operator_ok)
destroy(this.cb_operator_cancel)
destroy(this.ddlb_packaging)
destroy(this.ddlb_location_to)
destroy(this.mle_qc_notes)
destroy(this.sle_1)
destroy(this.gb_qc_notes)
destroy(this.sle_operator_code)
destroy(this.sle_operator_password)
destroy(this.dw_limit_locs)
destroy(this.st_operator_title)
destroy(this.cb_operator)
destroy(this.dw_current_object)
destroy(this.gb_current_object)
destroy(this.cb_50)
destroy(this.gb_dwbox)
destroy(this.lb_2)
destroy(this.dw_misc)
end on

type rb_2 from radiobutton within w_touch_screen_generic_trans
int X=3109
int Y=992
int Width=512
int Height=64
boolean Visible=false
string Text="none"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;SetPointer ( HourGlass! )
ddlb_location_to.Reset ( )
ddlb_location_to.ShowList = True

rb_1.Checked = False

bPopulateLocations = True

wf_transfer_super_object ( ddlb_location_to )
gb_dwbox.Show ( )
dw_misc.Show ( )
ddlb_location_to.SetFocus ( )
end on

type cb_at_enter from commandbutton within w_touch_screen_generic_trans
int X=1810
int Y=1440
int Width=274
int Height=128
int TabOrder=110
boolean Visible=false
string Text="&Enter"
boolean Default=true
int TextSize=-10
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

event clicked;Long	ll_Serial

If f_get_string_value ( em_1.Text ) = "" Then Return

ll_Serial = Long ( em_1.Text )

dw_audit_trail.DataObject = "d_generic_audit_trail_undo_mi"
dw_audit_trail.Show ( )
dw_audit_trail.SetTransObject ( sqlca )
If dw_audit_trail.Retrieve ( "M", ll_Serial ) < 1 Then
	f_beep ( 5 )
	MessageBox ( "Error", "This object shows no material issue in it's past!  Please check your serial number and try again.", StopSign! )
	em_1.Text = ""
	dw_audit_trail.DataObject = "d_generic_audit_trail_by_machine_mi"
	dw_audit_trail.Show ( )
	dw_audit_trail.SetTransObject ( sqlca )
	dw_audit_trail.Retrieve ( dtToday, "M", ddlb_machines.Text )
	em_1.SetFocus ( )
End if
end event

type cb_52 from commandbutton within w_touch_screen_generic_trans
int X=366
int Y=1440
int Width=274
int Height=128
int TabOrder=90
boolean Visible=false
string Text="&Reset"
int TextSize=-10
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;dw_audit_trail.DataObject = "d_generic_audit_trail_by_machine_mi"
dw_audit_trail.SetTransObject ( sqlca )
dw_audit_trail.Show ( )
dw_audit_trail.Retrieve ( dtToday, "M", ddlb_machines.Text )

end on

type st_2 from statictext within w_touch_screen_generic_trans
int X=622
int Y=3152
int Width=805
int Height=128
boolean Visible=false
boolean Enabled=false
string Text="Scan / Enter Serial Number To Show Audit Trail For Undo:"
Alignment Alignment=Right!
boolean FocusRectangle=false
long TextColor=33554560
long BackColor=12632256
long BorderColor=128
int TextSize=-8
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type em_1 from editmask within w_touch_screen_generic_trans
int X=1445
int Y=3168
int Width=347
int Height=96
int TabOrder=100
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
string Mask="##########"
int TextSize=-8
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type p_trash from picture within w_touch_screen_generic_trans
int X=2103
int Y=3136
int Width=183
int Height=160
boolean Visible=false
string PictureName="trash.bmp"
boolean FocusRectangle=false
end type

on dragdrop;wf_operator_attrib ( True )
end on

type dw_transactions from datawindow within w_touch_screen_generic_trans
int X=517
int Y=1184
int Width=1865
int Height=480
int TabOrder=80
boolean Visible=false
string DataObject="d_audit_trail_by_date"
boolean LiveScroll=true
end type

type lb_1 from listbox within w_touch_screen_generic_trans
int X=2341
int Y=1952
int Width=494
int Height=364
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean VScrollBar=true
long TextColor=33554432
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type sle_status from statictext within w_touch_screen_generic_trans
int X=951
int Y=8
int Width=667
int Height=112
boolean Visible=false
boolean Enabled=false
string Text="Successful"
Alignment Alignment=Center!
boolean FocusRectangle=false
long TextColor=65280
long BackColor=77897888
int TextSize=-20
int Weight=700
string FaceName="MS Sans Serif"
boolean Italic=true
boolean Underline=true
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type st_1 from statictext within w_touch_screen_generic_trans
int X=1746
int Y=8
int Width=1170
int Height=144
boolean Enabled=false
string Text="[Enter Button] / [Tab Key]-Next Field             [Back Button] / [<Shift>Tab]-Previous Field "
Alignment Alignment=Center!
boolean FocusRectangle=false
long TextColor=33554432
long BackColor=77897888
int TextSize=-8
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type cb_57 from commandbutton within w_touch_screen_generic_trans
int X=2194
int Y=1728
int Width=311
int Height=192
string Text="Back"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;If bMessage Then wf_hide_message ( )

IF ib_Password THEN
	u_audit_trail.sle_operator_password.Text = Left ( u_audit_trail.sle_operator_password.Text, Len ( u_audit_trail.sle_operator_password.Text ) - 1 )
ELSEIF ib_Notes THEN
	u_generic_it_note.mle_note.Text = Left ( u_generic_it_note.mle_note.Text, Len ( u_generic_it_note.mle_note.Text ) - 1 )
ELSE
	bButton = True
	bBack = True

	If bMachines Then
		ddlb_machines.TriggerEvent ( "button_clicked" )
	Elseif bParts Then
		ddlb_parts.TriggerEvent ( "button_clicked" )
	Elseif bPackaging Then
		ddlb_packaging.TriggerEvent ( "button_clicked" )
	Elseif bLot Then
		sle_lot.TriggerEvent ( "button_clicked" )
	Elseif bLocationTo Then
		ddlb_location_to.TriggerEvent ( "button_clicked" )
	Elseif bOperator Then
		sle_operator.TriggerEvent ( "button_clicked" )
	Elseif bNumberOf Then
		sle_numberof.TriggerEvent ( "button_clicked" )
	Elseif bQty Then
		sle_qty.TriggerEvent ( "button_clicked" )
	Elseif bUnits Then
		ddlb_unit.TriggerEvent ( "button_clicked" )
	Elseif bSerialNumber Then
		sle_serial.TriggerEvent ( "button_clicked" )
	Elseif bCombineSerial Then
		sle_operator.SetFocus ( )
	Elseif bQCNotes Then
		sle_operator.SetFocus ( )
	Elseif bCB48 Then
		cb_48.TriggerEvent ( "button_clicked" )
	End if
	
END IF	
end on

type lb_unit_list from listbox within w_touch_screen_generic_trans
int X=2505
int Y=640
int Width=402
int Height=656
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean VScrollBar=true
long TextColor=33554432
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type dw_unit_list from datawindow within w_touch_screen_generic_trans
int X=2341
int Y=2672
int Width=494
int Height=364
boolean Visible=false
string DataObject="d_unit_conversion_list_per_part"
boolean LiveScroll=true
end type

type cb_55 from commandbutton within w_touch_screen_generic_trans
int X=1573
int Y=1728
int Width=311
int Height=192
string Text="Space"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( " " )
end on

type cb_51 from commandbutton within w_touch_screen_generic_trans
int X=512
int Y=1568
int Width=329
int Height=128
boolean Visible=false
string Text="Exit"
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_hide_transfer_help ( )
end on

type dw_new_object from datawindow within w_touch_screen_generic_trans
int X=73
int Y=832
int Width=2286
int Height=256
boolean Visible=false
boolean Enabled=false
string DataObject="dw_combine_new_object_info"
boolean Border=false
end type

type ddlb_unit from dropdownlistbox within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=1755
int Y=928
int Width=366
int Height=448
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean VScrollBar=true
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;If Not bBack Then
	cb_48.SetFocus ( )
Else
	If stParm.Value1 = "JobComplete" Then
		If bJCQtyMode Then
			sle_qty.SetFocus ( )
		Elseif bJCNumberOfMode Then
			sle_numberof.SetFocus ( )
		Else
			sle_operator.SetFocus ( )
		End if
	Else
		sle_qty.SetFocus ( )
	End if
End if

end on

on getfocus;If bMessage Then wf_hide_message ( )

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not KeyDown ( keyTab! ) And ddlb_unit.PointerX ( ) <> -1 Then
	If Not bUnits Then wf_set_focus ( )
	Return
End if

If Not bUnits Then

	If Not bButton And Not wf_modified ( ) Then Return

	ddlb_unit.ShowList = True
	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_Numbers ( )
	If Not bUnits Then wf_reset_indicators ( )
	szField = "unit"
	bUnits = True
	bButton = False
	wf_change_color_focus ( )

Else

	bButton = False

End if
end on

type sle_numberof from singlelineedit within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=4553
int Y=368
int Width=731
int Height=128
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoHScroll=false
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;String	cQtyMode
String	cUnitMode

If Not bBack Then

	If Dec ( This.Text ) < 1 Then

		f_beep ( 5 )
		MessageBox ( "Error", "Number of objects must be greater than 0!", StopSign! )
		sle_numberof.SetFocus ( )
		Return

	End if

	If stParm.Value1 = "JobComplete" Then
		If bJCQtyMode Then		
			sle_qty.SetFocus ( )
		Elseif bJCUnitMode Then
			ddlb_unit.SetFocus ( )
		Else
			sle_qty.Text = "0"
			cb_48.SetFocus ( )
		End if
	Else
		sle_qty.SetFocus ( )
	End if

Else

	If stParm.Value1 = "JobComplete" Then
		sle_operator.SetFocus ( )
	Elseif stParm.Value1 = "BreakOut" Then
		//sle_serial.SetFocus ( )
		ddlb_packaging.SetFocus ( )
	End if

End if

end on

on getfocus;If bMessage Then wf_hide_message ( )

If Not bButton And Not KeyDown ( keyTab! ) And sle_numberof.PointerX ( ) <> -1 Then
	If Not bNumberOf Then wf_set_focus ( )
	Return
End if

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bNumberof Then

	If Not bButton And Not wf_modified ( ) Then Return

	If bChars Then Disable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bNumberOf Then wf_reset_indicators ( )
	szField = "numberof"
	bNumberOf = True
	bBack = False
	bButton = False
	wf_change_color_focus ( )

Else

	bButton = False

End If
end on

type sle_qty from singlelineedit within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=3803
int Y=640
int Width=731
int Height=128
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoHScroll=false
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;String	cAllowZeroQty

If Not bBack Then

  SELECT inventory_parameters.jc_allow_zero_qty  
    INTO :cAllowZeroQty  
    FROM inventory_parameters  ;

	If stParm.Value1 = "JobComplete" Then
		If cAllowZeroQty <> 'Y' And Dec ( sle_qty.Text ) <= 0 Then
			f_beep ( 5 )
			MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
			sle_qty.SetFocus ( )
		Else
			If bJCUnitMode Then
				ddlb_unit.SetFocus ( )			
			Else
				cb_48.SetFocus ( )
			End if
		End if
	ElseIf stParm.Value1 = "Material Issue" Then
		If cIssueType = "U" And Dec ( sle_qty.Text ) <= 0 Then
			f_beep ( 5 )
			MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
			sle_qty.SetFocus ( )
		Else
			If bMIUnitMode Then
				ddlb_unit.SetFocus ( )			
			Else
				cb_48.SetFocus ( )
			End if
		End if
	ElseIf stParm.Value1 = "BreakOut" Then
		If Dec ( sle_qty.Text ) <= 0 Then
			f_beep ( 5 )
			MessageBox ( "Error", "Quantity must be greater than 0!", StopSign! )
			sle_qty.SetFocus ( )
		Else
			If bBOUnitMode Then
				ddlb_unit.SetFocus ( )			
			Else
				cb_48.SetFocus ( )
			End if
		End if
	End if
Else

	If stParm.Value1 = "JobComplete" Then
		If bJCNumberOfMode Then
			sle_numberof.SetFocus ( )
		Else
			sle_operator.SetFocus ( )
		End if				
	Elseif stParm.Value1 = "BreakOut" Then
		If bBONumberOfMode Then
			sle_numberof.SetFocus ( )
		Else
			sle_serial.SetFocus ( )
		End if
	Else
		sle_serial.SetFocus ( )
	End if

End if


end on

on getfocus;If bMessage Then wf_hide_message ( )

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not ib_Auto And Not bButton And Not KeyDown ( keyTab! ) And sle_qty.PointerX ( ) <> -1 Then
	If Not bQty Then wf_set_focus ( )
	Return
End if

If Not bQty Then

	If Not ib_Auto And Not bButton And Not wf_modified ( ) Then Return

	If bChars Then Disable_chars ( )
	If Not bNumbers Then Enable_Numbers ( )
	If Not bQty Then wf_reset_indicators ( )
	szField = "qty"
	bQty = True
	bButton = False
	bBack = False
	wf_change_color_focus ( )

	If ib_PopupScaleInterface Then &
		wf_popup_scale ( )

Else

	bButton = False

	If ib_PopupScaleInterface Then &
		wf_popup_scale ( )

End if
end on

type cb_48 from commandbutton within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=2450
int Y=480
int Width=475
int Height=160
boolean Enabled=false
int TextSize=-12
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;If bMessage Then wf_hide_message ( )

If Not bBack Then
	cb_48.TriggerEvent ( clicked! )
Else
	If stParm.Value1 = "JobComplete" Then
		If bJCUnitMode Then
			ddlb_unit.SetFocus ( )
		Elseif bJCQtyMode Then
			sle_qty.SetFocus ( )
		Elseif bJCNumberOfMode Then
			sle_numberof.SetFocus ( )
		Else
			sle_operator.SetFocus ( )
		End if
	Elseif stParm.Value1 = "Material Issue" Then
		If bMIUnitMode Then
			ddlb_unit.SetFocus ( )
		Else
			sle_qty.SetFocus ( )
		End if
	Elseif stParm.Value1 = "BreakOut" Then
		If bBOUnitMode Then
			ddlb_unit.SetFocus ( )
		Else
			sle_qty.SetFocus ( )
		End if
	End if
End if
end on

on clicked;SetPointer ( HourGlass! )

bAction = True

wf_disable_screen ( )

If stParm.Value1 = "JobComplete" Then

	wf_reset_indicators ( )
	If wf_job_complete ( ) And Not ib_Auto Then
		szField = "part"
		ddlb_parts.Text = ""
		ddlb_packaging.Text = ""
		ddlb_packaging.Reset ( )
		sle_numberof.Text = ""
		sle_qty.Text = ""
		bOpen = True
		ddlb_parts.Setfocus ( )
	Elseif ib_Auto Then
		wf_enable_screen ( )
		bAction = False
		is_Notes = ""		
		szField = ""
		sle_qty.SetFocus ( )
		ib_Auto = FALSE
		Return
	End if

Elseif stParm.Value1 = "Transfer" Then

	wf_reset_indicators ( )
	sle_serial.TriggerEvent ( modified! )

Elseif stParm.Value1 = "BreakOut" Then

	wf_reset_indicators ( )
	If wf_breakout ( ) Then
		szField = "serial"
		sle_serial.Text = ""
		sle_qty.Text = ""
		sle_numberof.Text = ""
		wf_set_focus ( )
		dw_misc.Reset ( )
	End if

Elseif stParm.Value1 = "Material Issue" Then

	wf_reset_indicators ( )
	If wf_material_issue ( ) Then
		//bSerialNumber = True
		szField = "serial"
		sle_serial.Text = ""
		sle_qty.Text = ""
		wf_set_focus ( )
		dw_misc.Reset ( )
	End if

End if

wf_enable_screen ( )

bAction = False

is_Notes = ""
end on

on getfocus;wf_reset_indicators ( )
bCB48 = True
end on

type cb_49 from commandbutton within w_touch_screen_generic_trans
int X=73
int Y=1440
int Width=274
int Height=128
boolean Visible=false
string Text="E&xit"
int TextSize=-10
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;cb_52.Visible 				= False
cb_49.Visible 				= False
em_1.Visible 				= False
st_2.Visible 				= False
dw_audit_trail.Visible 	= False
p_trash.Visible 			= False
cb_audit_popup.Visible 	= False
cb_at_enter.Visible     = False

If stParm.Value1 = "Material Issue" Then
	dw_audit_trail.DataObject = "d_generic_audit_trail_by_machine_mi"
	dw_audit_trail.SetTransObject ( sqlca )
End if

wf_enable_screen ( )

If Not bChars Then
	disable_chars ( )
End if
If Not bNumbers Then
	disable_numbers ( )
End if

If bSerialNumber Then
	sle_serial.SetFocus ( )
Elseif bParts Then
	ddlb_parts.SetFocus ( )
Elseif bLocationTo Then
	ddlb_location_to.SetFocus ( )
Elseif bMachines Then
	ddlb_machines.SetFocus ( )
Elseif bOperator Then
	sle_operator.SetFocus ( )
Elseif bQty Then
	sle_qty.SetFocus ( )
Elseif bNumberOf Then
	sle_numberof.SetFocus ( )
Elseif bPackaging Then
	ddlb_packaging.SetFocus ( )
Elseif bLot Then
	sle_lot.SetFocus ( )
Elseif bUnits Then
	ddlb_unit.SetFocus ( )
End if
bAuditTrail = False
end on

type dw_object from datawindow within w_touch_screen_generic_trans
int X=2341
int Y=2320
int Width=494
int Height=364
boolean Visible=false
string DataObject="d_object_data"
boolean LiveScroll=true
end type

type rb_1 from radiobutton within w_touch_screen_generic_trans
int X=3109
int Y=928
int Width=439
int Height=64
boolean Visible=false
string Text="none"
BorderStyle BorderStyle=StyleLowered!
boolean Checked=true
long TextColor=128
long BackColor=12632256
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;SetPointer ( HourGlass! )

ddlb_location_to.Reset ( )

rb_2.Checked = False

gb_dwbox.Hide ( )
dw_misc.Hide ( )

If bPopulateLocations Then
	wf_get_location_tos ( )
End if
		

end on

type sle_lot from singlelineedit within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=1993
int Y=144
int Width=731
int Height=128
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;Int iRtnCode


If Not bBack Then

	If f_get_string_value ( sle_lot.Text ) = "" Then

		f_beep ( 5 )

		iRtnCode = MessageBox ( "Error", "A material lot number is required to continue!", StopSign! )
		sle_lot.SetFocus ( )

		Return

	End if

	ddlb_location_to.SetFocus ( )

Else

	ddlb_packaging.SetFocus ( )

End if

end on

on getfocus;If Not bAction And bMessage Then wf_hide_message ( )

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not KeyDown ( keyTab! ) And sle_lot.PointerX ( ) <> -1 Then 
	If Not bLot Then wf_set_focus ( )
	Return
End if

If Not bLot Then

	If Not bButton And Not wf_modified ( ) Then Return

	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bLot Then wf_reset_indicators ( )
	szField = "lot"
	bLot = True
	bButton = False
	bBack = False
	wf_change_color_focus ( )

Else

	bButton = False

End If
end on

type ddlb_parts from dropdownlistbox within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=110
int Y=48
int Width=731
int Height=544
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoHScroll=true
boolean VScrollBar=true
boolean AllowEdit=true
int Limit=25
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=400
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;String 	szTemp
String 	szTempUnit
String 	szTempPackaging
String	ls_PrimaryLocation

Int iRtnCode
Int iLoop

If bPopulateParts Then ddlb_parts.Text = szSelectedText

If Not bBack Then

	ddlb_parts.Text = Upper ( ddlb_parts.Text )
	
          SELECT part.part  
	    INTO :szTemp
	    FROM part  
           WHERE part.part = :ddlb_parts.Text  ;
	
	If SQLCA.SQLCode <> 0 Or ddlb_parts.Text = "" Then
	
		f_beep ( 5 )
	
		If Not bPopulateParts Then
			iRtnCode = MessageBox ( "Error", "Invalid part number! Would you like to use drop down list?", Question!, YesNo!, 1 )
			If iRtnCode = 1 Then
				bPopulateParts = True
				ddlb_parts.ShowList = True
				If ddlb_parts.TotalItems ( ) < 1 Then wf_get_parts ( )
			End if
		Else
			MessageBox ( "Error", "Invalid part number!  Please select valid one from list.", StopSign! )
		End if
		ddlb_parts.Text = ""
		ddlb_parts.SetFocus ( )
		
	Else
		
		dw_misc.SetTransObject ( sqlca )
	
		If dw_misc.Retrieve ( ddlb_parts.Text ) < 1 Then 
			ddlb_parts.SetFocus ( ) 
			Return
		End if
			
		dw_misc.SetItem ( 1, "standard_pack", "" )
		
		ddlb_parts.ShowList = False
		
		wf_get_unit_list ( ddlb_parts.Text, "" )
	
		szTempPackaging = ""
		If ddlb_packaging.Text <> "" Then szTempPackaging = ddlb_packaging.Text
			
		If wf_packaging ( ddlb_parts.Text, szTempPackaging ) Then
			ddlb_packaging.Text = szTempPackaging
		End if
		
		SELECT primary_location
		  INTO :ls_PrimaryLocation  
	     FROM part_inventory
	    WHERE part = :ddlb_parts.Text   ;

		If SQLCA.SQLCode = 0 And f_get_string_value ( ls_PrimaryLocation ) <> "" Then
			ddlb_location_to.Text = ls_PrimaryLocation
		End if

		If ib_Scale Then wf_check_for_scale ( )

		ddlb_packaging.SetFocus ( )

	End if

Else

	If szMachineParm = "" Then
		ddlb_machines.SetFocus ( )
	Else
		wf_set_focus ( )
	End if
	
End if	
end on

on getfocus;If Not bAction And bMessage Then wf_hide_message ( )

If bPopulateParts Then ddlb_parts.ShowList = True

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not bOpen And Not bParts And Not KeyDown ( keyTab! ) And ddlb_parts.PointerX ( ) <> -1 Then 
	If Not bParts Then wf_set_focus ( )
	Return
End if

If Not bParts Then

	If Not bButton And Not wf_modified ( ) Then Return

	bPartsLoseFocus = False
	If bPopulateParts Then ddlb_parts.ShowList = True
	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bParts Then wf_reset_indicators ( )
	szField = "part"
	bParts = True
	bOpen = False
	bButton = False
	bBack = False
	wf_change_color_focus ( )
	szRealityText = ""
	If ddlb_parts.Text <> "" Then
		szSelectedText = ddlb_parts.Text
	Else
		szSelectedText = ""
	End if
	
	If bPopulateParts And ddlb_parts.TotalItems ( ) < 1 Then
		wf_get_parts ( )
		ddlb_parts.ShowList = True
	End if		

Else

	bButton = False

End if
end on

on losefocus;ddlb_parts.ShowList = False


end on

on selectionchanged;If bPopulateParts And Not KeyDown ( keyTab! ) And Not KeyDown ( keyEnter! ) Then
	szSelectedText = ddlb_parts.Text
	This.TriggerEvent ( "button_clicked" )
End if
end on

type sle_operator from singlelineedit within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=73
int Y=264
int Width=731
int Height=128
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoHScroll=false
boolean PassWord=true
int Limit=5
TextCase TextCase=Upper!
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;String	cNumberOfMode
String	cQtyMode
String	cUnitMode

szOperator = ""

If Not bBack Then

	SELECT employee.operator_code  
	  INTO :szOperator  
	  FROM employee  
	 WHERE employee.password = :sle_operator.Text   ;
	
	szOperator = f_get_string_value ( szOperator )
	
	If SQLCA.SQLCode = 0 Then
	
		gb_operator.Text = "Operator - " + szOperator

		If stParm.Value1 = "JobComplete" Then

			If bJCNumberOfMode Then
				sle_numberof.SetFocus ( )
			Elseif bJCQtyMode Then
				sle_numberof.Text = "1"
				sle_qty.SetFocus ( )
			Elseif bJCUnitMode Then
				sle_numberof.Text = "1"
				sle_qty.Text = "0"
				ddlb_unit.SetFocus ( )
			Else
				sle_numberof.Text = "1"
				sle_qty.Text = "0"
				cb_48.SetFocus ( )
			End if

		ElseIf stParm.Value1 =  "Material Issue" Or stParm.Value1 = "BreakOut" Then
			sle_serial.SetFocus ( )
		ElseIf stParm.Value1 =  "Transfer" Then
			ddlb_location_to.SetFocus ( )
		ElseIf stParm.Value1 =  "Combine" Then
			sle_combine_serial.SetFocus ( )
		ElseIf stParm.Value1 =  "Quality Control" Then
			mle_qc_notes.SetFocus ( )
		End if

	Else

		f_beep ( 5 )
		gb_operator.Text = "Operator -"
		MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
		sle_operator.Text = ""
		sle_operator.SetFocus ( )
		Return
	
	End if

Else

	If stParm.Value1 = "JobComplete" Then
		ddlb_location_to.SetFocus ( )
	Elseif stParm.Value1 = "Material Issue" Then
		If szMachineParm = "" Then
			ddlb_machines.SetFocus ( )
		Else
			wf_set_focus ( )
		End if
	Elseif stParm.Value1 = "BreakOut" Or stParm.Value1 = "Transfer" Or stParm.Value1 = "Combine" Or stParm.Value1 = "Quality" Then
		sle_operator.SetFocus ( )
	End if
	
End if

end on

event getfocus;If Not bAction And bMessage Then wf_hide_message ( )

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not bOpen And Not KeyDown ( keyTab! ) And sle_operator.PointerX ( ) <> -1 Then 
	If Not bOperator Then 
		wf_set_focus ( )
	else
		Return
	end if
End if

If Not bOperator Then

	If Not bButton And Not wf_modified ( ) Then Return

	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bOperator Then wf_reset_indicators ( )
	szField = "operator"
	bOperator = True
	bOpen = False
	bButton = False
	bBack = False
	wf_change_color_focus ( )

Else

	bButton = False

End if
end event

type sle_serial from singlelineedit within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=3931
int Y=496
int Width=731
int Height=128
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoHScroll=false
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

event button_clicked;/*  Declare Variables  */

String szOriginalUnit
String cTempStatus
String cNewStatus
String szTempPackaging
String ls_CurrentUserDefinedStatus
String ls_DefectCode
String ls_Part
String ls_Machine
	
Long lTemp
Long lTempShipper
	
Date dToday
	
Time tNow
		
Int iRtnCode
Int iLoop

/*  Initialize Variables  */

dToday = Today ( )
tNow   = Now ( )

/*  Main  */

If Not bBack Then

	If Upper ( Left ( sle_serial.Text, 1 ) ) = 'S' Then
		sle_serial.Text = Right ( sle_serial.Text, Len ( sle_serial.Text ) - 1 )
	Elseif Not IsNumber ( Left ( sle_serial.Text, 1 ) ) Then
		f_beep ( 5 )
		sle_serial.Text = ""
		MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
		sle_serial.SetFocus ( )
		Return
	End if
		
	lSerial = f_get_value ( Long ( sle_serial.Text ) )
	If lSerial < 1 Then 
		f_beep ( 5 )
		MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
		sle_serial.SetFocus ( )
		Return
	End if
	
	SELECT object.serial,
			 object.shipper,
			 object.status
	  INTO :lTemp,
			 :lTempShipper,
			 :cTempStatus
	  FROM object  
	 WHERE object.serial = :lSerial   ;
		
	If SQLCA.SQLCode <> 0 Then
		f_beep ( 5 )
		MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
		sle_serial.Text = ""
		sle_serial.SetFocus ( )
		Return
	Elseif f_get_string_value ( cTempStatus ) <> "A" And stParm.Value1 = "Material Issue" Then
		f_beep ( 5 )
		MessageBox ( "Error", "You cannot perform this transaction on an object with status other than approved!", StopSign! )
		sle_serial.Text = ""
		sle_serial.SetFocus ( )
		Return
	Elseif f_get_value ( lTempShipper ) > 0 Then
		f_beep ( 5 )
		MessageBox ( "Error", "You cannot perform this transaction on a staged object!", StopSign! )
		sle_serial.Text = ""
		sle_serial.SetFocus ( )
		Return
	End if
		
	If stParm.Value1 = "Transfer" Then
		
		/*  Check for operator  */
	
		If szOperator = "" Then
			f_beep ( 5 )
			MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
			bOperator = True
			wf_set_focus ( )
			Return
		End if

		If ddlb_location_to.Text = "" Then
			f_beep ( 5 )
			If rb_1.Checked Then
				iRtnCode = MessageBox ( "Error", "Invalid location! Would you like to use drop down list?", Question!, YesNo!, 1 )
				ddlb_location_to.Text = ""
				If iRtnCode = 1 Then
					bPopulateLocations = True
					ddlb_location_to.ShowList = True
					wf_get_location_tos ( )
				End if
				ddlb_location_to.SetFocus ( )
				Return
			Else
				MessageBox ( "Error", "Invalid super object!  Please enter a valid one.", StopSign! )
				ddlb_location_to.Text = ""
				ddlb_location_to.SetFocus ( )
				Return
			End if
	
		End if
	
	
		dw_object.SetTransObject ( sqlca )
		dw_object.Retrieve ( lSerial )
				

		//	Figure out From and To Locations
				
		cObjectType = f_get_string_value ( &
			dw_object.GetItemString ( 1, "type" ) )
		lParent = f_get_value ( &
			dw_object.GetItemNumber ( 1, "parent_serial" ) )
				
		szNewLoc     = f_get_string_value ( ddlb_location_to.Text )
		bSuper       = False
		bZeroParent  = False
		bNoCheck     = False
		bWriteParent = False
			
		If cObjectType = "S" Then	  // Object is a super one
	
			//	Super Object can only be transfered to a location and not another super object.
			
			If rb_2.Checked = True Then     
			
				f_beep ( 5 )
				MessageBox ( "Error", "You cannot transfer a super object to another super object!", StopSign! )
				sle_serial.Text = ""
				sle_serial.SetFocus ( )
				Return
				
			End if
			
			szLocation = wf_location_of_super_object ( lSerial )
		
			bSuper = True

	 	Else   // Just a normal object
		
			szLocation = f_get_string_value ( &
				dw_object.GetItemString ( 1, "Location" ) )
		
			If lParent > 0 Then     //  Object is attached to a super object

				//	Object attached to a Super-object -> location
				If rb_1.Checked Then  

					szLocation = wf_location_of_super_object ( lSerial )
					szMessage = "You cannot transfer to the same location!"
					bZeroParent = True
				
				//	Object attached to a Super-object -> Super-object
				Else        //  Normal object

					szLocation = String ( lParent )
					szMessage = "You cannot transfer an object " + &
									"to the same Super Object!"
					bWriteParent = True
		  
				End if
		
			//	Object
			Else
				
				//	Object -> Location
				If rb_1.Checked Then

					szMessage = "You cannot transfer to the same location!"

				//	Object -> Super-object
				Else
					bNoCheck = True
					bWriteParent = True
				End if
						
			End if

		End if

		If Not bNoCheck Then

			If szLocation = szNewLoc Then

				f_beep ( 5 )
				MessageBox ( "Error", szMessage, StopSign! )
				sle_serial.Text = ''	
				sle_serial.SetFocus ( )
				Return

			End if

		End if
	
		If bSuper Then

			dw_misc.SetTransObject ( sqlca )
			dw_misc.Retrieve ( lSerial )
			wf_transfer_update_objects ( )
			sle_serial.SetFocus ( )

		Else

			lParent = Long ( ddlb_location_to.Text )
			dwObject = dw_object
			wf_transfer_update_object ( )
			sle_serial.SetFocus ( )

		End if
	
		wf_show_message ( )

		If rb_2.Checked Then &
			dw_misc.Retrieve ( lParent )	
	
		sle_serial.SetFocus ( )

	ElseIf stParm.Value1 = "BreakOut" Then

		bLoseFocus = True
	
		dw_misc.SetTransObject ( sqlca )
		dw_misc.Retrieve ( lSerial )
	
		szPart = dw_misc.GetItemString ( 1, "part" )
		szOriginalUnit = dw_misc.GetItemString ( 1, "unit" )

		wf_get_unit_list ( szPart, szOriginalUnit )
	
		ddlb_unit.Text = szOriginalUnit
	
		dw_object.SetTransObject ( sqlca )
		dw_object.Retrieve ( lSerial )
	
		szTempPackaging = ""
		If ddlb_packaging.Text <> "" Then szTempPackaging = ddlb_packaging.Text
			
		If wf_packaging ( szPart, szTempPackaging ) Then
			ddlb_packaging.Text = szTempPackaging
		End if

		ddlb_packaging.SetFocus ( )
	
	Elseif stParm.Value1 = "Material Issue" Then
	
		bLoseFocus = True
	
		dw_misc.SetTransObject ( sqlca )
		dw_misc.Retrieve ( lSerial )

		szPart = f_get_string_value ( dw_misc.GetItemString ( 1, "part" ) )
		szOriginalUnit = f_get_string_value ( dw_misc.GetItemString ( 1, "unit" ) )

		If szPart = "" Then
			f_beep ( 10 )
			MessageBox ( "Error", "Object has an invalid part number or the part number has an error.", StopSign! )
			sle_serial.Text = ""
			sle_serial.SetFocus ( )
			Return			
		End if

		SELECT part_inventory.material_issue_type  
		  INTO :cIssueType  
		  FROM part_inventory  
		 WHERE part_inventory.part = :szPart   ;
	
		wf_get_unit_list ( szPart, szOriginalUnit )
	
		ddlb_unit.Text = szOriginalUnit

		dw_object.SetTransObject ( sqlca )
		dw_object.Retrieve ( lSerial )

		If cIssueType = "U" Then
			gb_qty.Text = "Quantity Used"
			sle_qty.Text = String ( dw_object.GetItemNumber ( 1, "quantity" ) )
		Else
			gb_qty.Text = "Quantity Remaining"
		End if

		sle_qty.SetFocus ( )

	Elseif stParm.Value1 = "Quality Control" Then

		If dw_misc.GetRow ( ) < 1 Or Not dw_misc.IsSelected ( dw_misc.GetRow ( ) ) Then
			f_beep ( 5 )
			MessageBox ( "Error", "Please select a new status before continuing!", StopSign! )
			sle_serial.Text = ""
			sle_serial.Setfocus ( )
			Return
		End if
		
		dw_object.SetTransObject ( sqlca )

		String cCurrentStatus

		Dec dPrice, dOnHand, dWeight, dQuantity

		lSerial = f_get_value ( Long ( sle_serial.Text ) )
	
		If lSerial < 1 Then Return

		If dw_object.Retrieve ( lSerial ) < 1 Then
			f_beep ( 5 )
			MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
			sle_serial.Text = ""
			sle_serial.Setfocus ( )
			Return
		End if
	
		ls_CurrentUserDefinedStatus = dw_object.GetItemString ( 1, "user_defined_status" )
		cCurrentStatus = dw_object.GetItemString ( 1, "status" )
		cNewStatus = cStatus //dw_misc.GetItemString ( 1, "status" )
	
		If ls_CurrentUserDefinedStatus = is_UserStatus then //cCurrentStatus = cNewStatus Then
			f_beep ( 5 )
			MessageBox ( "Error", "This object is already at the selected status!", StopSign! )
			sle_serial.Text = ""
			sle_serial.SetFocus ( )
			Return
		End if
	

		dw_object.SetItem ( 1, "status", cNewStatus )
		dw_object.SetItem ( 1, "last_date", dToday )
		dw_object.SetItem ( 1, "last_time", tNow )
		dw_object.SetItem ( 1, "operator", szOperator )
		dw_object.SetItem ( 1, "user_defined_status", is_UserStatus )

		If cCurrentStatus = "A" And cNewStatus <> "A" Then

			dOnHand = f_update_onhand ( dw_object.GetItemString ( 1, "part" ), &
									dw_object.GetItemNumber ( 1, "std_quantity" ), &
									"-*" )
		ElseIf cCurrentStatus <> "A" And cNewStatus = "A" Then

			dOnHand = f_update_onhand ( dw_object.GetItemString ( 1, "part" ), &
									dw_object.GetItemNumber ( 1, "std_quantity" ), &
									"+*" )
		End if

		If dw_object.Update ( ) = -1 Then
			RollBack ;
			sle_serial.Text = ""
			f_beep ( 5 )
			Return
		Else
		
			If Not f_create_audit_trail ( lSerial, "Q", cCurrentStatus, cNewStatus, mle_qc_notes.Text, "", "", "", "", "", "", "" ) Then
				RollBack ;
				f_beep ( 5 )
				Return
			End if

			If cNewStatus = 'S' Then
				
				If bDeleteScrap Then
					If Not f_create_audit_trail ( lSerial, "D", szOperator, String ( dOnHand ), "", "", "", "", "", "", "", "" ) Then
						RollBack ;
						f_beep ( 5 )
						Return
					End if
					
					DELETE FROM object  
					 WHERE serial = :lSerial   ;
	
					If SQLCA.SQLCode <> 0 Then
						RollBack ;
						f_beep ( 5 )
						Return
					Else
						Commit ;
					End if

				End if

				if MessageBox ( "Defects", "Report any defects?", Question!, YesNo!, 2 ) = 1 Then

					Open ( w_defects_entry_no_quantity )
	
					ls_DefectCode = Message.StringParm

					If ls_DefectCode > "" Then
	
						dQuantity = dw_object.GetItemNumber ( 1, "std_quantity" )
						ls_Machine = dw_object.GetItemString ( 1, "location" )
						dToday = Today ( )
						tNow = Now ( )
						ls_Part = dw_object.GetItemString ( 1, "part" )
	
						INSERT INTO "defects"  
	         					( "machine",   
	           					"part",   
	           					"reason",   
	           					"quantity",   
	           					"operator",   
	           					"shift",   
	           					"work_order",   
	           					"data_source",   
	           					"defect_date",   
	           					"defect_time" )  
	  						VALUES ( :ls_Machine,   
	           					:ls_Part,   
	           					:ls_DefectCode,   
	           					:dQuantity,   
	           					:sle_operator.Text,   
	           					null,   
	           					:szWorkOrder,   
	           					null,   
	           					:dToday,   
	           					:tNow )  ;
						If sqlca.sqlcode = 0 then
							Commit;
						else
							Rollback;
						end if	

					End if

				End if

			End if

			f_beep ( 1 )
			sle_serial.Text = ""
			wf_show_message ( )
	
			sle_serial.SetFocus ( )

		End if

	End if

Else

	If stParm.Value1 = "Transfer" Then

		ddlb_location_to.SetFocus ( )
	
	Elseif stParm.Value1 = "BreakOut" Then
	
		sle_operator.SetFocus ( )
	
	Elseif stParm.Value1 = "Material Issue" Then
	
		sle_operator.SetFocus ( )
	
	Elseif stParm.Value1 = "Quality Control" Then
	
		mle_qc_notes.SetFocus ( )
	
	End if

End if
end event

on getfocus;If Not bAction And bMessage And ( stParm.Value1 <> "Transfer" And stParm.Value1 <> "Quality Control" ) Then wf_hide_message ( )

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bAction And Not bButton And Not KeyDown ( keyTab! ) And sle_serial.PointerX ( ) <> -1 Then
	If stParm.Value1 <> "Transfer" And Not bSerialNumber Then 
		wf_set_focus ( )
	elseif stParm.Value1 <> "Transfer" then
		Return
	end if
End if

If Not bSerialNumber Then

	If Not bButton And Not wf_modified ( ) Then Return

	If bChars Then Disable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bSerialNumber Then wf_reset_indicators ( )
	bSerialNumber = True
	szField = "serial"
	bButton = False
	bBack = False
	wf_change_color_focus ( )

Else

	bButton = False

End if
end on

type cb_47 from commandbutton within w_touch_screen_generic_trans
int X=2450
int Y=800
int Width=475
int Height=160
boolean Enabled=false
int TextSize=-12
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type cb_46 from commandbutton within w_touch_screen_generic_trans
int X=2450
int Y=960
int Width=475
int Height=160
boolean Enabled=false
string Text="Notes"
int TextSize=-12
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;//wf_disable_screen ( )
//wf_notes_attrib ( True )
ib_Notes = TRUE
wf_disable_except_buttons ( )
Parent.OpenUserObjectWithParm ( u_generic_it_note, is_Notes, 550, 200 )
u_generic_it_note.BringToTop = TRUE
IF is_Notes <> "" THEN u_generic_it_note.mle_note.Text = is_Notes
end on

type cb_45 from commandbutton within w_touch_screen_generic_trans
int X=3365
int Y=192
int Width=475
int Height=160
boolean Visible=false
boolean Enabled=false
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type cb_44 from commandbutton within w_touch_screen_generic_trans
int X=2450
int Y=640
int Width=475
int Height=160
boolean Enabled=false
int TextSize=-12
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;st_generic_structure	str_Parm
Long	lNewSerial

If bMessage Then wf_hide_message ( )

If stParm.Value1 = "Combine" Then

	lNewSerial = dw_new_object.GetItemNumber ( 1, "serial" )
	If Not f_create_audit_trail ( lNewSerial, "C", "","","","","","","","","","Remaining" ) Then
		Return
	End if

	If bLabel Then
		str_Parm.Value1 = String ( lNewSerial )
		f_print_label ( str_Parm )
	End if

	If bLabelNeeded = True Then bLabelNeeded = False

	dw_new_object.Reset ( )
	dw_new_object.InsertRow ( 0 )

Elseif stParm.Value1 = "Transfer" Then

	wf_show_transfer_help ( )

End if
end on

type cb_42 from commandbutton within w_touch_screen_generic_trans
int X=2450
int Y=320
int Width=475
int Height=160
string Text="Audit Trail"
int TextSize=-12
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;str_audit_trail	str_Parm

If bMessage Then wf_hide_message ( )

SetPointer ( HourGlass! )

bAuditTrail = True

wf_disable_screen ( )

str_Parm.adt_Today = dtToday
CHOOSE CASE stParm.Value1
	CASE "Material Issue"
		str_Parm.as_TransactionType = "MI"
		enable_numbers ( )
		cb_37.Enabled = TRUE
		cb_57.Enabled = TRUE
	CASE "BreakOut"
		str_Parm.as_TransactionType = "BO"
	CASE "Combine"		
		str_Parm.as_TransactionType = "CB"
	CASE "Transfer"
		str_Parm.as_TransactionType = "TR"
	CASE "Quality Control"
		str_Parm.as_TransactionType = "QC"
END CHOOSE
str_Parm.as_Machine = ddlb_machines.Text

OpenUserObjectWithParm ( u_audit_trail, str_Parm, 55, 150 )
u_audit_trail.BringToTop = TRUE


//If bMessage Then wf_hide_message ( )
//
//SetPointer ( HourGlass! )
//String cObjectType
//
//bAuditTrail = True
//
//wf_disable_screen ( )


//cb_audit_popup.x 	= 37
//cb_audit_popup.y 	= 225
//dw_audit_trail.x 	= 74
//dw_audit_trail.y 	= 257
//
//cb_audit_popup.Visible 	= True
//dw_audit_trail.Reset ( )
//dw_audit_trail.Visible 	= True
//cb_49.Visible 				= True
//If stParm.Value1 = "JobComplete" Then
//	p_trash.x 				= 2100
//	p_trash.y 				= 1430
//	p_trash.Visible 		= True
//Elseif stParm.Value1	= "Material Issue" Then
//	em_1.x					= 1450
//	em_1.y					= 1450
//	em_1.Text				= ""
//	em_1.Visible 			= True
//	st_2.x					= 630
//	st_2.y					= 1430
//	st_2.Visible 			= True
//	p_trash.x 				= 2100
//	p_trash.y 				= 1430
//	p_trash.Visible 		= True
//	cb_52.Visible 			= True
//	cb_at_enter.Visible 	= True
//End if
//
//dw_audit_trail.SetTransObject ( sqlca )
//
//Choose Case stParm.Value1
//
//	Case "Transfer"
//		cObjectType = "T"
//
//	Case "JobComplete"
//		cObjectType = "J"
//
//	Case "BreakOut"
//		cObjectType = "B"
//
//	Case "Material Issue"
//		cObjectType = "M"
//
//	Case "Quality Control"
//		cObjectType = "Q"
//
//	Case "Combine"
//		cObjectType = "C"
//
//End Choose
//
//If stParm.Value1 = "JobComplete" Or stParm.Value1 = "Material Issue" Then
//	dw_audit_trail.Retrieve ( dtToday, cObjectType, ddlb_machines.Text )
//Else
//	dw_audit_trail.Retrieve ( dtToday, cObjectType )
//End if
end on

type dw_1 from datawindow within w_touch_screen_generic_trans
int X=3730
int Y=1312
int Width=2926
int Height=1152
boolean Visible=false
boolean LiveScroll=true
end type

type cb_41 from commandbutton within w_touch_screen_generic_trans
int X=1317
int Y=1728
int Width=256
int Height=192
string Text="_"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "_" )
end on

type cb_43 from commandbutton within w_touch_screen_generic_trans
int X=293
int Y=1728
int Width=256
int Height=192
string Text="."
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "." )
end on

type cb_40 from commandbutton within w_touch_screen_generic_trans
int X=549
int Y=1728
int Width=256
int Height=192
string Text="-"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "-" )
end on

type cb_39 from commandbutton within w_touch_screen_generic_trans
int X=37
int Y=1728
int Width=256
int Height=192
string Text="0"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "0" )
end on

type cb_38 from commandbutton within w_touch_screen_generic_trans
int X=2450
int Y=160
int Width=475
int Height=160
string Text="Exit"
int TextSize=-12
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;If stParm.Value1 = "Combine" And bLabelNeeded Then
	If MessageBox ( "Error", "A label has not been printed for this object!  Would you like to print one before you exit?", Question!, YesNo!, 1 ) = 1 Then
		bLabel = True
	Else
		bLabel = False
	End if
	cb_44.TriggerEvent ( clicked! )
End if

IF is_Transaction > '' THEN
	IF MessageBox ( "Exit", "Are you sure you want to exit?", Question!, YesNo!, 2 ) = 1 THEN
		Halt
	END IF
ELSE
	Close ( Parent )
END IF

end on

on getfocus;//bExit = True
end on

type cb_37 from commandbutton within w_touch_screen_generic_trans
int X=1883
int Y=1728
int Width=311
int Height=192
string Text="Clear"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;If bMessage Then wf_hide_message ( )

IF ib_Password THEN
	u_audit_trail.sle_operator_password.Text = ""
	u_audit_trail.sle_operator_code.Text = ""
ELSEIF ib_Notes THEN
	u_generic_it_note.mle_note.Text = ""
ELSE
	szRealityText = ""

	If bSerialNumber Then
		sle_serial.Text = ""
		sle_serial.Setfocus ( )
	Elseif bParts Then
		ddlb_parts.Text = ""
		ddlb_parts.SetFocus ( )
	Elseif bLocationTo Then
		ddlb_location_to.Text = ""
		ddlb_location_to.SetFocus ( )
	Elseif bMachines Then
		szSelectedText = ""
		ddlb_machines.Text = ""
		ddlb_machines.SetFocus ( )
	Elseif bQty Then
		sle_qty.Text = ""
		sle_qty.SetFocus ( )
	Elseif bNumberOf Then
		sle_numberof.Text = ""
		sle_numberof.SetFocus ( )
	Elseif bOperator Then
		sle_operator.Text = ""
		sle_operator.SetFocus ( )
	Elseif bSerialNumber Then
		sle_serial.Text = ""
		sle_serial.SetFocus ( )
	Elseif bPackaging Then
		ddlb_packaging.Text = ""
		ddlb_packaging.SetFocus ( )
	Elseif bLot Then
		sle_lot.Text = ""
		sle_lot.SetFocus ( )
	Elseif bQCNotes Then
		mle_qc_notes.Text = ""
		mle_qc_notes.SetFocus ( )
	Elseif bCombineSerial Then
		sle_combine_serial.Text = ""
		sle_combine_serial.SetFocus ( )
	End if
END IF
end on

type cb_36 from commandbutton within w_touch_screen_generic_trans
int X=549
int Y=1152
int Width=256
int Height=192
string Text="9"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "9" )
end on

type cb_35 from commandbutton within w_touch_screen_generic_trans
int X=293
int Y=1152
int Width=256
int Height=192
string Text="8"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "8" )
end on

type cb_34 from commandbutton within w_touch_screen_generic_trans
int X=37
int Y=1152
int Width=256
int Height=192
string Text="7"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "7" )
end on

type cb_33 from commandbutton within w_touch_screen_generic_trans
int X=549
int Y=1344
int Width=256
int Height=192
string Text="6"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "6" )
end on

type cb_32 from commandbutton within w_touch_screen_generic_trans
int X=805
int Y=1728
int Width=256
int Height=192
string Text="Y"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "Y" )
end on

type cb_31 from commandbutton within w_touch_screen_generic_trans
int X=1061
int Y=1728
int Width=256
int Height=192
string Text="Z"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "Z" )
end on

type cb_30 from commandbutton within w_touch_screen_generic_trans
int X=2505
int Y=1728
int Width=347
int Height=192
string Text="Enter"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;If bMessage Then wf_hide_message ( )

bButton = True
bBack = False

If bMachines Then
	ddlb_machines.TriggerEvent ( "button_clicked" )
Elseif bParts Then
	ddlb_parts.TriggerEvent ( "button_clicked" )
Elseif bPackaging Then
	ddlb_packaging.TriggerEvent ( "button_clicked" )
Elseif bLot Then
	sle_lot.TriggerEvent ( "button_clicked" )
Elseif bLocationTo Then
	ddlb_location_to.TriggerEvent ( "button_clicked" )
Elseif bOperator Then
	sle_operator.TriggerEvent ( "button_clicked" )
Elseif bNumberOf Then
	sle_numberof.TriggerEvent ( "button_clicked" )
Elseif bQty Then
	sle_qty.TriggerEvent ( "button_clicked" )
Elseif bUnits Then
	ddlb_unit.TriggerEvent ( "button_clicked" )
Elseif bSerialNumber Then
	sle_serial.TriggerEvent ( "button_clicked" )
Elseif bCombineSerial Then
	sle_combine_serial.TriggerEvent ( modified! )
Elseif bQCNotes Then
	mle_qc_notes.TriggerEvent ( modified! )
Elseif bCB48 Then
	cb_48.Enabled = False
	cb_48.TriggerEvent ( "button_clicked" )
	cb_48.Enabled = True
End if


end on

type cb_29 from commandbutton within w_touch_screen_generic_trans
int X=37
int Y=1536
int Width=256
int Height=192
string Text="1"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "1" )
end on

type cb_28 from commandbutton within w_touch_screen_generic_trans
int X=293
int Y=1536
int Width=256
int Height=192
string Text="2"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "2" )
end on

type cb_27 from commandbutton within w_touch_screen_generic_trans
int X=549
int Y=1536
int Width=256
int Height=192
string Text="3"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "3" )
end on

type cb_26 from commandbutton within w_touch_screen_generic_trans
int X=37
int Y=1344
int Width=256
int Height=192
string Text="4"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "4" )
end on

type cb_25 from commandbutton within w_touch_screen_generic_trans
int X=293
int Y=1344
int Width=256
int Height=192
string Text="5"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "5" )
end on

type cb_24 from commandbutton within w_touch_screen_generic_trans
int X=805
int Y=1536
int Width=256
int Height=192
string Text="Q"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "Q" )
end on

type cb_23 from commandbutton within w_touch_screen_generic_trans
int X=1061
int Y=1536
int Width=256
int Height=192
string Text="R"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "R" )
end on

type cb_22 from commandbutton within w_touch_screen_generic_trans
int X=1317
int Y=1536
int Width=256
int Height=192
string Text="S"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "S" )
end on

type cb_21 from commandbutton within w_touch_screen_generic_trans
int X=1573
int Y=1536
int Width=256
int Height=192
string Text="T"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "T" )
end on

type cb_20 from commandbutton within w_touch_screen_generic_trans
int X=1829
int Y=1536
int Width=256
int Height=192
string Text="U"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "U" )
end on

type cb_19 from commandbutton within w_touch_screen_generic_trans
int X=2085
int Y=1536
int Width=256
int Height=192
string Text="V"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "V" )
end on

type cb_18 from commandbutton within w_touch_screen_generic_trans
int X=2341
int Y=1536
int Width=256
int Height=192
string Text="W"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "W" )
end on

type cb_17 from commandbutton within w_touch_screen_generic_trans
int X=2597
int Y=1536
int Width=256
int Height=192
string Text="X"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "X" )
end on

type cb_16 from commandbutton within w_touch_screen_generic_trans
int X=805
int Y=1344
int Width=256
int Height=192
string Text="I"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "I" )
end on

type cb_15 from commandbutton within w_touch_screen_generic_trans
int X=1061
int Y=1344
int Width=256
int Height=192
string Text="J"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "J" )
end on

type cb_14 from commandbutton within w_touch_screen_generic_trans
int X=1317
int Y=1344
int Width=256
int Height=192
string Text="K"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "K" )
end on

type cb_13 from commandbutton within w_touch_screen_generic_trans
int X=1573
int Y=1344
int Width=256
int Height=192
string Text="L"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "L" )
end on

type cb_12 from commandbutton within w_touch_screen_generic_trans
int X=1829
int Y=1344
int Width=256
int Height=192
string Text="M"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "M" )
end on

type cb_11 from commandbutton within w_touch_screen_generic_trans
int X=2085
int Y=1344
int Width=256
int Height=192
string Text="N"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "N" )
end on

type cb_10 from commandbutton within w_touch_screen_generic_trans
int X=2341
int Y=1344
int Width=256
int Height=192
string Text="O"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "O" )
end on

type cb_9 from commandbutton within w_touch_screen_generic_trans
int X=2597
int Y=1344
int Width=256
int Height=192
string Text="P"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "P" )
end on

type cb_8 from commandbutton within w_touch_screen_generic_trans
int X=2597
int Y=1152
int Width=256
int Height=192
string Text="H"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "H" )
end on

type cb_7 from commandbutton within w_touch_screen_generic_trans
int X=2341
int Y=1152
int Width=256
int Height=192
string Text="G"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "G" )
end on

type cb_6 from commandbutton within w_touch_screen_generic_trans
int X=2085
int Y=1152
int Width=256
int Height=192
string Text="F"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "F" )
end on

type cb_5 from commandbutton within w_touch_screen_generic_trans
int X=1829
int Y=1152
int Width=256
int Height=192
string Text="E"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "E" )
end on

type cb_4 from commandbutton within w_touch_screen_generic_trans
int X=1573
int Y=1152
int Width=256
int Height=192
string Text="D"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "D" )
end on

type cb_3 from commandbutton within w_touch_screen_generic_trans
int X=1317
int Y=1152
int Width=256
int Height=192
string Text="C"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "C" )
end on

type cb_2 from commandbutton within w_touch_screen_generic_trans
int X=1061
int Y=1156
int Width=256
int Height=192
string Text="B"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "B" )
end on

type cb_1 from commandbutton within w_touch_screen_generic_trans
int X=805
int Y=1152
int Width=256
int Height=192
string Text="A"
int TextSize=-14
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_key_pressed ( "A" )
end on

type dw_audit_trail from datawindow within w_touch_screen_generic_trans
int X=73
int Y=1968
int Width=2194
int Height=1152
boolean Visible=false
string DragIcon="BOX.ICO"
string DataObject="d_generic_audit_trail"
boolean HScrollBar=true
boolean VScrollBar=true
boolean HSplitScroll=true
boolean LiveScroll=true
end type

on clicked;If stParm.Value1 = "JobComplete" Or stParm.Value1 = "Material Issue" Then

	il_AuditRow = dw_audit_trail.GetClickedRow ( )

	SelectRow ( dw_audit_trail, 0, False )

	If il_AuditRow < 1 Then Return

	SelectRow ( dw_audit_trail, il_AuditRow, True )

	dw_audit_trail.SetRow ( il_AuditRow )

	dw_audit_trail.Drag ( Begin! )

End if
end on

type sle_title from statictext within w_touch_screen_generic_trans
int Width=2926
int Height=160
boolean Enabled=false
boolean Border=true
BorderStyle BorderStyle=StyleLowered!
boolean FocusRectangle=false
long TextColor=33554432
long BackColor=77897888
int TextSize=-20
int Weight=700
string FaceName="MS Sans Serif"
boolean Italic=true
boolean Underline=true
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type cb_audit_popup from commandbutton within w_touch_screen_generic_trans
int X=37
int Y=1936
int Width=2267
int Height=1376
boolean Visible=false
boolean Enabled=false
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_qty from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=640
int Width=805
int Height=224
boolean Visible=false
string Text="Quantity"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_serial_number from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=576
int Width=805
int Height=224
boolean Visible=false
string Text="Serial Number"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_unit from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=512
int Width=439
int Height=224
boolean Visible=false
string Text="Unit"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_operator from groupbox within w_touch_screen_generic_trans
int X=37
int Y=192
int Width=805
int Height=224
boolean Visible=false
string Text="Operator - "
BorderStyle BorderStyle=StyleLowered!
long TextColor=33554432
long BackColor=77897888
int TextSize=-10
int Weight=400
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_machine from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=384
int Width=805
int Height=224
boolean Visible=false
string Text="Machine Number"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_numberof from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=320
int Width=805
int Height=224
boolean Visible=false
string Text="Number Of"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_parts from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=256
int Width=805
int Height=224
boolean Visible=false
string Text="Part Number"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_lot from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=192
int Width=805
int Height=224
boolean Visible=false
string Text="Material Lot Number"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_location_from from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=128
int Width=805
int Height=224
boolean Visible=false
string Text="Location From"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_location_to from groupbox within w_touch_screen_generic_trans
int X=2962
int Y=64
int Width=805
int Height=224
boolean Visible=false
string Text="Location To"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_packaging from groupbox within w_touch_screen_generic_trans
int X=2962
int Width=805
int Height=224
boolean Visible=false
string Text="Packaging"
BorderStyle BorderStyle=StyleLowered!
long TextColor=128
long BackColor=12632256
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type ddlb_machines from dropdownlistbox within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=110
int Y=288
int Width=731
int Height=544
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean VScrollBar=true
boolean AllowEdit=true
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;String 	ls_Temp, &
			ls_LimitLocs, &
			ls_Type, &
			ls_ShowInInventory, &
			s_ScaleAttached

Int iRtnCode


If bPopulateMachines Then ddlb_machines.Text = szSelectedText

If Not bBack Then

	ls_Temp = ddlb_machines.Text

	If dw_limit_locs.RowCount ( ) > 0 Then

	  SELECT code  
	    INTO :ls_Temp  
	    FROM location,   
	         location_limits  
	   WHERE ( code = "location_code" ) and  
	         ( ( location_code = :ls_Temp ) AND  
	         ( trans_code = Left ( :stParm.Value1, 1 ) ) AND  
	         ( type = 'MC' ) )   ;

	Else

	  SELECT code  
	    INTO :ls_Temp  
	    FROM location 
	   WHERE ( code = :ls_Temp ) AND  
	         ( type = 'MC' )   ;

	End if
	
	If SQLCA.SQLCode <> 0 Then
	
		f_beep ( 5 )
		
		If Not bPopulateMachines Then
			iRtnCode = MessageBox ( "Error", "A valid machine is required! Would you like to use drop down list?", Question!, YesNo!, 1 )
			If iRtnCode = 1 Then
				bPopulateMachines = True
				ddlb_machines.ShowList = True
				If ddlb_machines.TotalItems ( ) < 1 Then wf_get_machines ( )
			End if
		Else
			MessageBox ( "Error", "A valid machine is required!  Please select a valid one from list.", StopSign! )
		End if
		ddlb_machines.Text = ""
		ddlb_machines.SetFocus ( )
		
	Else
		
		ddlb_location_to.Text = ddlb_machines.Text

		If stParm.Value1 = "JobComplete" Then
			bNoKey = True

			SELECT machine_policy.scale_attached   
			  INTO :s_ScaleAttached   
			  FROM machine_policy  
			 WHERE machine_policy.machine = :ddlb_machines.Text   ;

			If SQLCA.SQLCode = 0 Then
				If s_ScaleAttached = 'Y' Then &
					ib_Scale = TRUE
			End if

			ddlb_parts.SetFocus ( )
		ElseIf stParm.Value1 = "Material Issue" Then
			bOpen = TRUE
			sle_operator.SetFocus ( )
		End if

	End if

Else

	ddlb_machines.SetFocus ( )

End if
end on

on getfocus;If Not bAction And bMessage Then wf_hide_message ( )

If bPopulateMachines Then ddlb_machines.ShowList = True

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not bOpen And Not bMachines And Not KeyDown ( keyTab! ) And ddlb_machines.PointerX ( ) <> -1 Then
	If Not bMachines Then wf_set_focus ( )
	Return
End if

If Not bMachines Then

	If Not bButton And Not wf_modified ( ) Then Return

	If bPopulateMachines Then ddlb_machines.ShowList = True
	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bMachines Then wf_reset_indicators ( )
	szField = "machine"
	bMachines = True
	bOpen = False
	bButton = False
	bBack = False
	wf_change_color_focus ( )
	szRealityText = ""
	If ddlb_machines.Text <> "" Then
		szSelectedText = ddlb_machines.Text
	Else
		szSelectedText = ""
	End if

	If bPopulateMachines And ddlb_machines.TotalItems ( ) < 1 Then &
		wf_get_machines ( )

Else

	bButton = False

End if
end on

on selectionchanged;If bPopulateMachines Then
	szSelectedText = ddlb_machines.Text
	This.TriggerEvent ( "button_clicked" )
End if
end on

on losefocus;ddlb_machines.ShowList = False

end on

type gb_new_object from groupbox within w_touch_screen_generic_trans
int X=37
int Y=768
int Width=2377
int Height=352
boolean Visible=false
string Text="New Object"
BorderStyle BorderStyle=StyleLowered!
long TextColor=33554432
long BackColor=77897888
int TextSize=-10
int Weight=400
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type sle_combine_serial from singlelineedit within w_touch_screen_generic_trans
int X=329
int Y=496
int Width=585
int Height=80
boolean Visible=false
boolean Border=false
boolean AutoHScroll=false
long TextColor=33554432
long BackColor=16777215
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

event modified;//	Declare Variables
Long	lSerial
Long	lNewSerial
Long	lTempShipper
Long	lTempSerial
Dec	dAddedQty
Dec	dTotalQty
Dec	dPrice
Dec	dOnHand
Dec	dWeight
Dec	dStdQuantity
Dec	dNewObjectQty
Dec	dStdQty
Dec	dAddedCost
Dec	dNewCost
Dec	dcost1
Dec	dcost2
dec	dcost
String	szAddedUnit
String	szNewUnit
String	s_TempStatus
DateTime dToday
Int	iLoop
String	szdimstr_1
String	szdimstr_2
Integer	i_len
Integer	i_currow
Integer	i_start
Integer	i_pos
String	ls_newdimstr
Dec	d_storedno[]
dec	ld_cobjwt

//	Initialize Variables
lSerial = f_get_value ( Long ( f_serial_validate(sle_combine_serial.Text )) )

//	If no serial was entered get out of this event
If lSerial < 1 Then
	f_beep ( 5 )
	MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
	sle_combine_serial.Text = ""
	Return
ElseIf szOperator = "" Then
	f_beep ( 5 )
	MessageBox ( "Error", "A valid operator is required to continue!", StopSign! )
	sle_operator.SetFocus ( )
	Return
End if

lNewSerial = f_get_value ( dw_new_object.GetItemNumber ( 1, "serial" ) )

If lSerial = lNewSerial Then 
	f_beep ( 5 )
	MessageBox ( "Error", "You cannot combine an object into itself!", StopSign! )
	sle_combine_serial.Text = ""
	Return
End if

dw_current_object.SetTransObject ( sqlca )
dw_new_object.SetTransObject ( sqlca )

//	Get data for old serial #
SELECT	object.serial,
	object.status,
	object.shipper,
	object.dimension_qty_string
INTO	:lTempSerial,
	:s_TempStatus,
	:lTempShipper,
	:szdimstr_1
FROM	object  
WHERE	object.serial = :lSerial   ;

If SQLCA.SQLCode <> 0 Then
	f_beep ( 5 )
	MessageBox ( "Error", "Invalid serial number!  Please enter a valid one.", StopSign! )
	sle_combine_serial.Text = ""
	bSetBack = True
	Return
Else
	IF s_TempStatus <> 'A' THEN
		f_beep ( 5 )
		MessageBox ( "Error", "You can only combine approved objects!", StopSign! )
		sle_combine_serial.Text = ""
		bSetBack = True
		Return
	END IF

	dw_current_object.Retrieve ( lSerial )

	If f_get_value ( lTempShipper ) > 0 Then
		f_beep ( 5 )
		MessageBox ( "Error", "You cannot perform this transaction on a staged object!", StopSign! )
		sle_combine_serial.Hide ( )
		sle_1.Visible = False
		dw_current_object.Reset ( )
		dw_current_object.InsertRow ( 1 )
		sle_combine_serial.Text = ""
		sle_1.Visible = True
		sle_combine_serial.Show ( )
		sle_combine_serial.SetFocus ( )
		Return	
	End if
	
	//	Grab current object's quantity and unit
	dAddedQty	= f_get_value ( dw_current_object.GetItemNumber ( 1, "quantity" ) )
	szAddedUnit	= f_get_string_value ( dw_current_object.GetItemString ( 1, "unit_measure" ) )
	dAddedCost	= f_get_value ( dw_current_object.GetItemNumber ( 1, "cost" ) )
	dcost1		= f_get_value ( dw_current_object.GetItemNumber ( 1, "std_quantity" ) ) * f_get_value ( dw_current_object.GetItemNumber ( 1, "cost" ) )

	If lNewSerial <= 0 Then
		//	Retrieve serial record in new window 
		dw_new_object.Retrieve ( lSerial )
	Else
//	07/14/05		
		If f_get_string_value ( dw_current_object.GetItemString ( 1, "custom3" ) ) <> &
			f_get_string_value ( dw_new_object.GetItemString ( 1, "custom3" ) ) and &
			f_get_string_value ( dw_current_object.GetItemString ( 1, "custom4" ) ) <> &
			f_get_string_value ( dw_new_object.GetItemString ( 1, "custom4" ) ) Then
			f_beep ( 5 )
			MessageBox ( "Error", "You cannot proceed with combine as custom3 and custom4 columns on both the objects does not match!", StopSign! )
			sle_combine_serial.Hide ( )
			sle_1.Hide ( )
			dw_current_object.Reset ( )
			dw_current_object.InsertRow ( 1 )
			sle_combine_serial.Text = ""
			sle_1.Visible = True
			sle_combine_serial.Show ( )
			sle_combine_serial.SetFocus ( )
			Return
		End if
		
		If f_get_string_value ( dw_current_object.GetItemString ( 1, "part" ) ) <> &
			f_get_string_value ( dw_new_object.GetItemString ( 1, "part" ) ) Then
			f_beep ( 5 )
			MessageBox ( "Error", "You cannot combine two objects with different part numbers!", StopSign! )
			sle_combine_serial.Hide ( )
			sle_1.Hide ( )
			dw_current_object.Reset ( )
			dw_current_object.InsertRow ( 1 )
			sle_combine_serial.Text = ""
			sle_1.Visible = True
			sle_combine_serial.Show ( )
			sle_combine_serial.SetFocus ( )
			Return
		End if

		If f_get_value ( dw_current_object.GetItemNumber ( 1, "suffix" ) ) <> &
			f_get_value ( dw_new_object.GetItemNumber ( 1, "suffix" ) ) Then
			f_beep ( 5 )
			MessageBox ( "Error", "You cannot combine two objects with a different suffix!", StopSign! )
			sle_combine_serial.Hide ( )
			sle_1.Hide ( )
			dw_current_object.Reset ( )
			dw_current_object.InsertRow ( 1 )
			sle_combine_serial.Text = ""
			sle_1.Visible = True
			sle_combine_serial.Show ( )
			sle_combine_serial.SetFocus ( )
			Return
		End if
				
		//	Grab New Object's quantity and unit
		dTotalQty	= f_get_value ( dw_new_object.GetItemNumber ( 1, "quantity" ) )
		szNewUnit	= f_get_string_value ( dw_new_object.GetItemString ( 1, "unit_measure" ) )
		dNewCost	= f_get_value ( dw_new_object.GetItemNumber ( 1, "cost" ) )
		szdimstr_1 	= dw_new_object.getitemstring(1,'dimension_qty_string')
		dcost2		= f_get_value ( dw_new_object.GetItemNumber ( 1, "std_quantity" ) ) * f_get_value ( dw_new_object.GetItemNumber ( 1, "cost" ) )

		//	DDA STUFF
		//	retrieving the data back from the string
		i_len = len(trim(szdimstr_1))
		If i_len > 0 then 
			i_currow = 0 
			i_start = 1
			Do
				i_pos = pos(szdimstr_1,',',i_start)
				If i_pos <= 0 then 
					Exit
				End if 
				i_pos -- 
				i_currow ++ 
				d_storedno[i_currow] = round(dec(mid(szdimstr_1,i_start,i_pos)),2)
				i_pos += 2
				i_start = i_pos 
			Loop While (true)
			i_pos = (i_len + 1) - i_start
			i_currow ++ 
			d_storedno[i_currow] = round(dec(mid(szdimstr_1,i_start,i_pos)),2)
		end if 
	
		SELECT	object.status,   
			object.lot,
			object.dimension_qty_string,
			object.varying_dimension_code,
			object.weight
		INTO	:szStatus,   
			:szLot,
			:szdimstr_2,
			:llnonconstantdim,
			:ld_cobjwt
		FROM	object  
		WHERE	object.serial = :lSerial;

		//	DDA STUFF
		//	retrieving the data back from the string
		ls_newdimstr=''
		i_len = len(trim(szdimstr_2))
		If i_len > 0 then 
			i_currow = 0 
			i_start = 1
			Do
				i_pos = pos(szdimstr_2,',',i_start)
				If i_pos <= 0 then 
					Exit
				End if 
				i_pos -- 
				i_currow ++ 
				if i_currow = llnonconstantdim  then 
					d_storedno[i_currow] += round(dec(mid(szdimstr_2,i_start,i_pos)),2)
				else	
					d_storedno[i_currow] = round(dec(mid(szdimstr_2,i_start,i_pos)),2)			
				end if 	
				ls_newdimstr += trim(string(d_storedno[i_currow]))+','
				i_pos += 2
				i_start = i_pos 
			Loop While (true)
			i_pos = (i_len + 1) - i_start
			i_currow ++ 
			if i_currow = llnonconstantdim then
				d_storedno[i_currow] += round(dec(mid(szdimstr_2,i_start,i_pos)),2)
			else
				d_storedno[i_currow] = round(dec(mid(szdimstr_2,i_start,i_pos)),2)		
			end if 	
			ls_newdimstr += trim(string(d_storedno[i_currow]))
		end if 
		
		szStatus = f_get_string_value ( szStatus )
		szLot = f_get_string_value ( szLot )
	
		If szStatus <> f_get_string_value ( dw_new_object.GetItemString ( 1, "status" ) ) Then
			f_beep ( 5 )
			MessageBox ( "Error", "You cannot combine two objects with different status'!", StopSign! )
			sle_combine_serial.Hide ( )
			sle_1.Visible = False
			dw_current_object.Reset ( )
			dw_current_object.InsertRow ( 1 )
			sle_combine_serial.Text = ""
			sle_1.Visible = True
			sle_combine_serial.Show ( )
			sle_combine_serial.SetFocus ( )
			Return
		End if
	
	
		//	Prime structure and convert quantity
		szPart = dw_current_object.GetItemString ( 1, "part" )
	
		dNewObjectQty = f_convert_units ( szAddedUnit, szNewUnit, szPart, dAddedQty )
	
		dTotalQty = dTotalQty + dNewObjectQty
	
		dStdQty = f_convert_units ( szNewUnit, "", szPart, dTotalQty )
		
		dcost = 0 
		if dstdqty > 0 then
			dcost = (dcost1 + dcost2 ) / dstdqty
		end if 	
		dweight = dw_new_object.object.weight[1]
		dweight = dweight + ld_cobjwt
		
		dw_new_object.SetItem ( 1, "quantity", dTotalQty )
		dw_new_object.SetItem ( 1, "last_date", Today ( ) )
		dw_new_object.SetItem ( 1, "last_time", Now ( ) ) 
		dw_new_object.SetItem ( 1, "std_quantity", dStdQty )
		dw_new_object.SetItem ( 1, "operator", szOperator )
		dw_new_object.SetItem ( 1, "cost", dcost )
		dw_new_object.setitem ( 1, "dimension_qty_string",ls_newdimstr)
		dw_new_object.SetItem ( 1, "weight", dweight )		
		
		If dw_new_object.Update ( ) = -1 Then
			f_beep ( 5 )
			RollBack ;
			sle_combine_serial.Text = ""
			sle_combine_serial.SetFocus ( )
			wf_enable_screen ( )
			Return
		Else
			SELECT	object.part,   
				object.cost,   
				object.weight  
			INTO	:szPart,   
				:dPrice,   
				:dWeight  
			FROM	object  
			WHERE	object.serial = :lNewSerial;

			szPart = f_get_string_value ( szPart )
			dPrice = f_get_value ( dPrice )
			dWeight = f_get_value ( dWeight )
			dToday = DateTime ( Today ( ), Now ( ) )

			If Not f_create_audit_trail ( lSerial, "C", String ( lSerial ), String ( lNewSerial ), String ( lSerial ), String ( dAddedQty ), szAddedUnit, szOperator, "", "", "", "" ) Then
				RollBack ;
				f_beep ( 5 )
				MessageBox ( "Error", "Unable to create audit trail!", StopSign! )
				sle_combine_serial.SetFocus ( )
				wf_enable_screen ( )
				Return
			End if
					
			dw_current_object.DeleteRow ( dw_current_object.GetRow ( ) )
			If dw_current_object.Update ( ) = -1 Then
				RollBack ;
				f_beep ( 5 )
				sle_combine_serial.Text = ""
				sle_combine_serial.Hide ( )
				sle_1.Visible = False
				dw_current_object.Reset ( )
				dw_current_object.InsertRow ( 0 )
				wf_enable_screen ( )
				sle_1.Visible = True
				sle_combine_serial.Show ( )
				For iLoop = 1 to 15000
				Next
				sle_combine_serial.SetFocus ( )
				Return
			End if
	
			Commit ;
	
			f_beep ( 1 )
			wf_show_message ( )

			bLabelNeeded = True
			bLabel = True
	
		End if	
	
	End if
	
	sle_combine_serial.Hide ( )
	sle_1.Visible = False
	dw_current_object.Reset ( )
	dw_current_object.InsertRow ( 0 )
	sle_combine_serial.Text = ""
	sle_1.Visible = True
	sle_combine_serial.Show ( )
	
End if

sle_combine_serial.SetFocus ( )

For iLoop = 1 to 15000
Next

end event

event getfocus;If Not bButton And Not KeyDown ( keyTab! ) And sle_combine_serial.PointerX ( ) <> -1 Then 
	If Not bCombineSerial Then wf_set_focus ( )
	Return
End if

If Not bCombineSerial Then

	If Not bButton And Not wf_modified ( ) Then Return

	If bChars Then Disable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bCombineSerial Then wf_reset_indicators ( )
	szField = "combineserial"
	bCombineSerial = True
	bButton = False
End if
end event

type cb_operator_ok from commandbutton within w_touch_screen_generic_trans
int X=1170
int Y=848
int Width=366
int Height=128
int TabOrder=60
boolean Visible=false
string Text="&Ok"
int TextSize=-10
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;If f_get_string_value ( sle_operator_code.Text ) = "" Then Return

wf_operator_attrib ( False )
Parent.TriggerEvent ( "undo" )
end on

type cb_operator_cancel from commandbutton within w_touch_screen_generic_trans
int X=1591
int Y=848
int Width=366
int Height=128
int TabOrder=70
boolean Visible=false
string Text="&Cancel"
int TextSize=-10
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on clicked;wf_operator_attrib ( False )
end on

type ddlb_packaging from dropdownlistbox within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=183
int Y=704
int Width=731
int Height=544
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean VScrollBar=true
boolean AllowEdit=true
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;String	cLotMode
String	szPartNumber
Dec 		dStdPack 
Int		iIndex

If Not bBack Then

	If ddlb_packaging.Text <> "" Then
	
		ddlb_packaging.Text = szSelectedText
		If stParm.Value1 <> "JobComplete" Then
			szPartNumber = dw_misc.GetItemString ( 1, "part" )
		Else
			szPartNumber = ddlb_parts.Text
		End if

		SELECT part_packaging.quantity  
		  INTO :dStdPack  
		  FROM part_packaging  
		 WHERE ( part_packaging.part = :szPartNumber ) AND  
		       ( part_packaging.code = :ddlb_packaging.Text )   ;
		
		If SQLCA.SQLCode <> 0 Then
		
			f_beep ( 5 )

			MessageBox ( "Error", "Invalid package type!", StopSign! )
			ddlb_packaging.Text = ""
			ddlb_packaging.SetFocus ( )
			Return
	
		Else
	
			If stParm.Value1 = "JobComplete" Then
				dw_misc.SetItem ( 1, "standard_pack", dStdPack )
				If f_get_string_value ( sle_qty.Text ) = "" Then &
					sle_qty.Text = String ( dStdPack )
				If ib_Scale Then wf_check_for_scale ( )
			Else
				If dw_object.GetItemNumber ( 1, "quantity" ) > dStdPack Then
					If f_get_string_value ( sle_qty.Text ) = "" Then &
						sle_qty.Text = String ( dStdPack )
				Else
					sle_qty.Text = String ( dw_object.GetItemNumber ( 1, "quantity" ) )
				End if
			End if
	
		End if
	
		If stParm.Value1 = "JobComplete" Then
			If bJCLotMode Then
				sle_lot.SetFocus ( )
			Else
				sle_lot.Text = ""
				ddlb_location_to.SetFocus ( )
			End if
		Else
			sle_numberof.SetFocus ( )
		End if

	Else

		If stParm.Value1 = "JobComplete" Then
			If bJCLotMode Then
				sle_lot.SetFocus ( )
			Else
				sle_lot.Text = ""
				ddlb_location_to.SetFocus ( )
			End if
		Else

			SELECT object.package_type  
			  INTO :ddlb_packaging.Text  
			  FROM object  
			 WHERE object.serial = :lSerial   ;

			sle_numberof.SetFocus ( )

		End if

	End if

Else

	If stParm.Value1 = "JobComplete" Then
		ddlb_parts.SetFocus ( )
	Else
		sle_serial.SetFocus ( )
	End if

End if
end on

on getfocus;If Not bAction And bMessage Then wf_hide_message ( )

ddlb_packaging.ShowList = True

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not bPackaging And Not KeyDown ( keyTab! ) And ddlb_packaging.PointerX ( ) <> -1 Then 
	If Not bPackaging Then wf_set_focus ( )
	Return
End if

If Not bPackaging Then

	If Not bButton And Not wf_modified ( ) Then Return

	ddlb_packaging.ShowList = True
	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bPackaging Then wf_reset_indicators ( )
	szField = "packaging"
	bPackaging = True
	bButton = False
	bBack = False
	wf_change_color_focus ( )
	szRealityText = ""
	If ddlb_packaging.Text <> "" Then
		szSelectedText = ddlb_packaging.Text
	Else
		szSelectedText = ""
	End if

Else

	bButton = False

End if
end on

on selectionchanged;If Not KeyDown ( keyTab! ) And Not KeyDown ( keyEnter! ) Then
	szSelectedText = ddlb_packaging.Text
	ddlb_packaging.ShowList = True
End if
end on

on losefocus;ddlb_packaging.ShowList = False

end on

type ddlb_location_to from dropdownlistbox within w_touch_screen_generic_trans
event button_clicked pbm_custom01
int X=110
int Y=608
int Width=731
int Height=544
boolean Visible=false
string Text="  "
BorderStyle BorderStyle=StyleLowered!
boolean VScrollBar=true
boolean AllowEdit=true
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on button_clicked;Boolean 	lb_CheckLocation
String 	ls_Temp
String	ls_LotMode
String	ls_LimitLocs

Int iRtnCode

If bPopulateLocations Then ddlb_location_to.Text = szSelectedText

If Not bBack Then

	If stParm.Value1 = "Transfer" Then
	
		If rb_2.Checked Then
	
			dw_misc.Retrieve ( Long ( ddlb_location_to.Text ) )
			sle_serial.SetFocus ( )
			Return
	
		Else
	
			lb_CheckLocation = True
	
		End if
	
	End if
	
	If stParm.Value1 <> "Transfer" Or lb_CheckLocation Then
	
		ls_Temp = ddlb_location_to.Text
	
		If dw_limit_locs.RowCount ( ) > 0 Then

		  SELECT location_code  
		    INTO :ls_Temp  
		    FROM location_limits  
		   WHERE ( trans_code = Left ( :stParm.Value1, 1 ) ) AND  
		         ( location_code = :ls_Temp )   ;

		Else

		  SELECT code  
		    INTO :ls_Temp  
		    FROM location  
		   WHERE code = :ls_Temp   ;

		End if			

		If SQLCA.SQLCode <> 0 Then
	
			f_beep ( 5 )
	
			If Not bPopulateLocations Then
				iRtnCode = MessageBox ( "Error", "Invalid location! Would you like to use drop down list?", Question!, YesNo!, 1 )
				If iRtnCode = 1 Then
					bPopulateLocations = True
					ddlb_location_to.ShowList = True
					wf_get_location_tos ( )
				End if
			Else
				MessageBox ( "Error", "Invalid location!  Please select a valid one from list.", StopSign! )
			End if
			ddlb_location_to.Text = ""
			ddlb_location_to.SetFocus ( )
			Return

		End if
	
	End if 

	If stParm.Value1 = "JobComplete" Then
		sle_operator.SetFocus ( )
	Elseif stParm.Value1 = "Transfer" Then
		sle_serial.SetFocus ( )
	End if

Else

	If stParm.Value1 = "JobComplete" Then

		If bJCLotMode Then
			sle_lot.SetFocus ( )
		Else
			ddlb_packaging.SetFocus ( )
		End if

		sle_lot.SetFocus ( )
	Elseif stParm.Value1 = "Transfer" Then
		sle_operator.SetFocus ( )
	End if

End if
	

end on

on selectionchanged;If bPopulateLocations And Not KeyDown ( keyTab! ) And Not KeyDown ( keyEnter! ) Then
	szSelectedText = ddlb_location_to.Text
	This.TriggerEvent ( "button_clicked" )
End if
end on

on getfocus;If ddlb_location_to.Text = " " Or ddlb_location_to.Text = "  " Then &
	ddlb_location_to.Text = ""

If bMessage Then wf_hide_message ( )

If bPopulateLocations Then ddlb_location_to.ShowList = True

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not KeyDown ( keyTab! ) And ddlb_location_to.PointerX ( ) <> -1 Then 
	If Not bLocationTo Then wf_set_focus ( )
	Return
End if

If Not bLocationTo Then

	If Not bButton And Not wf_modified ( ) Then Return

	If bPopulateLocations Then ddlb_location_to.ShowList = True
	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bLocationTo Then wf_reset_indicators ( )
	szField = "location"
	bLocationTo = True
	bButton = False
	bBack = False
	wf_change_color_focus ( )
	szRealityText = ""
	If ddlb_location_to.Text <> "" Then
		szSelectedText = ddlb_location_to.Text
	Else
		szSelectedText = ""
	End if

	If bPopulateLocations And ddlb_location_to.TotalItems ( ) < 1 Then &
		wf_get_location_tos ( )

Else

	bButton = False

End if
end on

on losefocus;ddlb_location_to.ShowList = False

end on

type mle_qc_notes from multilineedit within w_touch_screen_generic_trans
int X=110
int Y=768
int Width=731
int Height=320
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoVScroll=true
int Limit=50
long TextColor=33554432
long BackColor=16777215
int TextSize=-16
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on getfocus;If Not bAction And bMessage Then wf_hide_message ( )

If KeyDown ( keyShift! ) And KeyDown ( keyTab! ) Then bBack = True

If Not bButton And Not bOpen And Not bQCNotes And Not KeyDown ( keyTab! ) And mle_qc_notes.PointerX ( ) <> -1 Then
	If Not bQCNotes Then 
		wf_set_focus ( )
	else
		Return
	end if
End if

If Not bQCNotes Then

	If Not bButton And Not wf_modified ( ) Then Return

	If Not bChars Then Enable_chars ( )
	If Not bNumbers Then Enable_numbers ( )
	If Not bQCNotes Then wf_reset_indicators ( )
	szField = "qcnotes"
	bQCNotes = True
	bOpen = False
	bButton = False
	bBack = False
	wf_change_color_focus ( )

Else

	bButton = False

End if
end on

on modified;If bMandatoryQCNotes and f_get_string_value ( mle_qc_notes.Text ) = "" And cStatus <> 'A' Then
	mle_qc_notes.SetFocus ( )
	Return
Else
	sle_serial.Setfocus ( )
End if
end on

type sle_1 from singlelineedit within w_touch_screen_generic_trans
int X=329
int Y=496
int Width=585
int Height=80
int TabOrder=20
boolean Visible=false
boolean Border=false
boolean AutoHScroll=false
long TextColor=33554432
int TextSize=-12
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on getfocus;sle_combine_serial.Setfocus ( )
bSetBack = False
Return

end on

type gb_qc_notes from groupbox within w_touch_screen_generic_trans
int X=73
int Y=480
int Width=805
int Height=416
boolean Visible=false
string Text="Notes:"
BorderStyle BorderStyle=StyleLowered!
long TextColor=33554432
long BackColor=77897888
int TextSize=-10
int Weight=400
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type sle_operator_code from singlelineedit within w_touch_screen_generic_trans
int X=1463
int Y=704
int Width=530
int Height=96
int TabOrder=50
boolean Visible=false
boolean Enabled=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoHScroll=false
long TextColor=33554432
int TextSize=-10
int Weight=400
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type sle_operator_password from singlelineedit within w_touch_screen_generic_trans
int X=1134
int Y=704
int Width=293
int Height=96
int TabOrder=40
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
boolean AutoHScroll=false
boolean PassWord=true
int Limit=5
long TextColor=33554432
long BackColor=16777215
int TextSize=-10
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

on modified;SELECT employee.operator_code  
  INTO :sle_operator_code.Text  
  FROM employee  
 WHERE employee.password = :sle_operator_password.Text   ;

If SQLCA.SQLCode <> 0 Then
	MessageBox ( "Error", "Invalid Operator Password!", StopSign! )
	sle_operator_password.Text = ""
	sle_operator_password.SetFocus ( )	
End if
end on

type dw_limit_locs from datawindow within w_touch_screen_generic_trans
int X=987
int Y=400
int Width=494
int Height=364
int TabOrder=10
boolean Visible=false
string DataObject="d_limit_locs"
boolean LiveScroll=true
end type

type st_operator_title from statictext within w_touch_screen_generic_trans
int X=1079
int Y=608
int Width=1079
int Height=80
boolean Visible=false
boolean Enabled=false
string Text="Please Enter Operator Password:"
Alignment Alignment=Center!
boolean FocusRectangle=false
long TextColor=33554432
long BackColor=77897888
long BorderColor=128
int TextSize=-10
int Weight=700
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type cb_operator from commandbutton within w_touch_screen_generic_trans
int X=1061
int Y=592
int Width=1006
int Height=416
int TabOrder=30
boolean Visible=false
boolean Enabled=false
int TextSize=-10
int Weight=400
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type dw_current_object from datawindow within w_touch_screen_generic_trans
int X=73
int Y=480
int Width=2304
int Height=256
boolean Visible=false
string DataObject="dw_combine_object_info"
boolean Border=false
end type

on getfocus;If bChars Then Disable_chars ( )
If Not bNumbers Then Enable_numbers ( )
If Not bCurrentObject Then wf_reset_indicators ( )
bCurrentObject = True
end on

type gb_current_object from groupbox within w_touch_screen_generic_trans
int X=32
int Y=416
int Width=2377
int Height=352
boolean Visible=false
string Text="Current Object"
BorderStyle BorderStyle=StyleLowered!
long TextColor=33554432
long BackColor=77897888
int TextSize=-10
int Weight=400
string FaceName="MS Sans Serif"
FontCharSet FontCharSet=Ansi!
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type cb_50 from commandbutton within w_touch_screen_generic_trans
int X=274
int Y=192
int Width=1902
int Height=1536
boolean Visible=false
boolean Enabled=false
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type gb_dwbox from groupbox within w_touch_screen_generic_trans
int X=951
int Y=192
int Width=1426
int Height=928
boolean Visible=false
BorderStyle BorderStyle=StyleLowered!
long TextColor=33554432
long BackColor=77897888
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
end type

type lb_2 from listbox within w_touch_screen_generic_trans
int X=329
int Y=224
int Width=1829
int Height=1312
boolean Visible=false
boolean VScrollBar=true
boolean Sorted=false
long TextColor=33554432
int TextSize=-10
int Weight=700
string FaceName="Arial"
FontFamily FontFamily=Swiss!
FontPitch FontPitch=Variable!
string Item[]={"Help on functionality of Transfer",&
"===========================================",&
"1.  Input operator password.",&
"2.  See appropriate description below.",&
"3.  Input serial number to transfer.",&
"-----------------------------------------------------------------------------------",&
"Object -> Location",&
"  Choose location button and location.",&
"-----------------------------------------------------------------------------------",&
"Object -> Super Object",&
"  Choose super object button and serial number.",&
"-----------------------------------------------------------------------------------",&
"Object Attatched to Super Object -> Another Super Object",&
"  Choose super object button and serial number.",&
"-----------------------------------------------------------------------------------",&
"Object Attatched to Super Object -> Location",&
"  Choose location button and location.",&
"-----------------------------------------------------------------------------------",&
"Super Object -> Location",&
"  Choose location button and location."}
end type

type dw_misc from datawindow within w_touch_screen_generic_trans
event ue_set_focus pbm_custom01
int X=987
int Y=272
int Width=1353
int Height=832
boolean Visible=false
string DataObject="d_objects_within_super_object"
boolean Border=false
end type

on ue_set_focus;if szField = "operator" then
	sle_operator.SetFocus ( )
elseif szField = "qcnotes" then
	mle_qc_notes.SetFocus ( )
elseif szField = "serial" then
	sle_serial.Setfocus ( )
end if
end on

on clicked;If stParm.Value1 = "Quality Control" Then

	long	ll_row

	ll_row = GetClickedRow ( )

	IF ll_row < 1 then return

	SelectRow ( 0, FALSE )
	SelectRow ( ll_row, TRUE )

	cStatus = GetItemString ( ll_row, "type" )
	is_UserStatus = GetItemString ( ll_row, "display_name" )

	If f_get_string_value ( sle_operator.Text ) = "" Then
		wf_reset_indicators ( )
		szField = "operator"
		This.SetFocus ( )
		PostEvent ( "ue_set_focus" )
	ElseIf cStatus <> 'A' And f_get_string_value ( mle_qc_notes.Text ) = "" Then
		wf_reset_indicators ( )
		bOpen = True
		szField = "qcnotes"
		This.SetFocus ( )
		PostEvent ( "ue_set_focus" )
	Else
		wf_reset_indicators ( )
		bButton = True
		szField = "serial"
		This.SetFocus ( )
		PostEvent ( "ue_set_focus" )
	End if

End if
end on

on itemchanged;//If stParm.Value1 = "Quality Control" Then
//
//	cStatus = Left ( dw_misc.GetText ( ), 1 )
//
//	If f_get_string_value ( sle_operator.Text ) = "" Then
//		wf_reset_indicators ( )
//		szField = "operator"
//		wf_set_focus ( )
//	ElseIf cStatus <> 'A' And f_get_string_value ( mle_qc_notes.Text ) = "" Then
//		wf_reset_indicators ( )
//		bOpen = True
//		szField = "qcnotes"
//		wf_set_focus ( )
//	Else
//		wf_reset_indicators ( )
//		bButton = True
//		szField = "serial"
//		wf_set_focus ( )
//	End if
//
//End if
end on

on getfocus;If bMessage Then wf_hide_message ( )

//If stParm.Value1 = "Quality Control" Then
//
//	cStatus = Left ( dw_misc.GetItemString ( 1, "status" ), 1 )
//
//	If szOperator = "" Then
//		szField = "operator"
//		wf_set_focus ( )
//		Return
//	ElseIf cStatus <> 'A' And f_get_string_value ( mle_qc_notes.Text ) = "" Then
//		wf_reset_indicators ( )
//		szField = "qcnotes"
//		wf_set_focus ( )
//		//mle_qc_notes.SetFocus ( )
//	Else
//		szField = "serial"
//		wf_set_focus ( )
//		//sle_serial.SetFocus ( )
//	End if
//
//End if
end on

